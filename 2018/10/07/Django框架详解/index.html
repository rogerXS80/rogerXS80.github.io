<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="uW8bwgMGUwIA01nPfItoty1rmtmmuVkOVTeS9O0nAUg">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="初是瀑布模型，后来是敏捷开发，现在是DevOps，这是现代开发人员构建出色的产品的技术路线。随着DevOps的兴起，出现了持续集成（Continuous Integration）、持续交付（Continuous Delivery） 、持续部署（Continuous Deployment） 的新方法。传统的软件开发和交付方法正在迅...">
<meta property="og:type" content="article">
<meta property="og:title" content="[Django框架详解]">
<meta property="og:url" content="http://yoursite.com/2018/10/07/Django%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="Lupinus">
<meta property="og:description" content="初是瀑布模型，后来是敏捷开发，现在是DevOps，这是现代开发人员构建出色的产品的技术路线。随着DevOps的兴起，出现了持续集成（Continuous Integration）、持续交付（Continuous Delivery） 、持续部署（Continuous Deployment） 的新方法。传统的软件开发和交付方法正在迅...">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220601000305210.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220601000623436.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230121055833080.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230207140449963.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230207145254901.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230207144927020.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230207145838594.png">
<meta property="article:published_time" content="2018-10-07T07:09:55.000Z">
<meta property="article:modified_time" content="2018-10-07T08:11:38.000Z">
<meta property="article:author" content="Lupinus">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220601000305210.png">

<link rel="canonical" href="http://yoursite.com/2018/10/07/Django%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[Django框架详解] | Lupinus</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Lupinus" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lupinus</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Re：从零开始的go学习生活(｀・ω・´)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/rogerXS80" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/07/Django%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/20160715144434_fZCsF.jpeg">
      <meta itemprop="name" content="Lupinus">
      <meta itemprop="description" content="Re：从零开始的go学习生活(｀・ω・´)">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lupinus">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Django框架详解]
        </h1>

        <div class="post-meta">
          <!-- 置顶图标 -->
            <span class="post-meta-item">
              
              
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2018-10-07 15:09:55 / Modified: 16:11:38" itemprop="dateCreated datePublished" datetime="2018-10-07T15:09:55+08:00">2018-10-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <div class="post-description">初是瀑布模型，后来是敏捷开发，现在是DevOps，这是现代开发人员构建出色的产品的技术路线。随着DevOps的兴起，出现了持续集成（Continuous Integration）、持续交付（Continuous Delivery） 、持续部署（Continuous Deployment） 的新方法。传统的软件开发和交付方法正在迅...</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Django框架详解"><a href="#Django框架详解" class="headerlink" title="Django框架详解"></a>Django框架详解</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Django采用MVC架构设计的开源的WEB快速开发框架</p>
<p>优点：</p>
<ul>
<li><p>MVC设计模式</p>
<ul>
<li>Controler：处理不同的请求</li>
<li>View：网页，给人看的，json</li>
<li>Model ORM：数据库模型</li>
</ul>
</li>
<li><p>大而全的重框架，自带ORM、Template、Form、Auth核心组件，便于快速开发</p>
</li>
<li><p>简洁的url设计</p>
</li>
<li><p>实用的管理后台Admin</p>
</li>
<li><p>周边第三方插件丰富</p>
</li>
</ul>
<p>缺点：框架重、同步阻塞</p>
<p>Django的设计目标就是一款大而全，便于企业快速开发项目的框架，因此企业广泛采用</p>
<h2 id="项目构建"><a href="#项目构建" class="headerlink" title="项目构建"></a>项目构建</h2><p>启动Pycham，点击<code>Create New Project</code>。选择建立新的虚拟环境（每个项目独立开发，所以需要独立的虚拟环境），选择基于开发的解释器版本</p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220601000305210.png" alt="image-20220601000305210"></p>
<h3 id="安装Django"><a href="#安装Django" class="headerlink" title="安装Django"></a>安装Django</h3><p>Django的安装参考：<a href="https://www.djangoproject.com/download/" target="_blank" rel="noopener">https://www.djangoproject.com/download/</a></p>
<p>Python版本依赖，参考：<a href="https://docs.djangoproject.com/en/3.2/faq/install/#what-python-version-can-i-use-with-django" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/faq/install/#what-python-version-can-i-use-with-django</a></p>
<table>
<thead>
<tr>
<th align="center">Django version</th>
<th align="center">Python版本</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1.8</td>
<td align="center">2.7, 3.2 (until the end of 2016), 3.3, 3.4, 3.5</td>
</tr>
<tr>
<td align="center">1.9, 1.10</td>
<td align="center">2.7, 3.4, 3.5</td>
</tr>
<tr>
<td align="center">1.11(LTS)</td>
<td align="center">2.7, 3.4, 3.5, 3.6, 3.7 (added in 1.11.17)</td>
</tr>
<tr>
<td align="center">2.0</td>
<td align="center">3.4, 3.5, 3.6, 3.7</td>
</tr>
<tr>
<td align="center">2.1</td>
<td align="center">3.5, 3.6, 3.7</td>
</tr>
<tr>
<td align="center">2.2(LTS)</td>
<td align="center">3.5, 3.6, 3.7, 3.8(2.2.8), 3.9 (added in 2.2.17)</td>
</tr>
<tr>
<td align="center">3.0</td>
<td align="center">3.6, 3.7, 3.8, 3.9 (added in 3.0.11)</td>
</tr>
<tr>
<td align="center">3.1</td>
<td align="center">3.6, 3.7, 3.8, 3.9 (added in 3.1.3)</td>
</tr>
<tr>
<td align="center">3.2(LTS)</td>
<td align="center">3.6, 3.7, 3.8, 3.9</td>
</tr>
</tbody></table>
<p>长期支持版本是企业的选择，由于最新版是3.2是LTS，本次采用它</p>
<p>Django3.x兼容2.x版本。相比于2.x版本</p>
<ul>
<li><p>支持MariaDB 10.1+</p>
</li>
<li><p>开始支持ASGI，官方建议，但目前可以研究，暂时不要切换</p>
</li>
<li><p>对内建模块django.contrib.admin、django.contrib.auth一些改动</p>
</li>
<li><p>Model中一些增强</p>
</li>
</ul>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220601000623436.png" alt="image-20220601000623436"></p>
<p>菜单 <code>view/Tool Windows/Terminal</code> 打开命令行，其运行当前工作路径正好是项目根目录，而且(DjangoTest) <code>E:\ClassProjects\DjangoTest</code> 中 (DjangoTest) 说明使用了虚拟环境。就在这里安装Django</p>
<p><font color='red'><strong>注意：本文如若未特殊声明，所有的命令操作都在项目根目录下</strong></font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pip install django==<span class="number">3.2</span><span class="number">.7</span></span><br><span class="line">Installing collected packages: pytz, sqlparse, asgiref, django</span><br><span class="line">Successfully installed asgiref<span class="number">-3.5</span><span class="number">.2</span> django<span class="number">-3.2</span><span class="number">.7</span> pytz<span class="number">-2022.1</span> sqlparse<span class="number">-0.4</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<h3 id="脚手架构建"><a href="#脚手架构建" class="headerlink" title="脚手架构建"></a>脚手架构建</h3><p>Django安装完，提供了一个命令 <code>django-admin</code> ，它实际是虚拟环境路径中，<code>Lib/site-packages/django/bin</code> 下的 <code>django-admin.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ django-admin</span><br><span class="line"></span><br><span class="line">Type <span class="string">'django-admin help &lt;subcommand&gt;'</span> <span class="keyword">for</span> help on a specific subcommand.</span><br><span class="line"></span><br><span class="line">Available subcommands:</span><br><span class="line"></span><br><span class="line">[django] </span><br><span class="line">    makemigrations</span><br><span class="line">    migrate </span><br><span class="line">    runserver </span><br><span class="line">    startapp </span><br><span class="line">    startproject</span><br><span class="line">  </span><br><span class="line">$ django-admin help startproject</span><br></pre></td></tr></table></figure>

<p>上面这些都是最常用的命令，这里只需要使用 startproject 来构建一个Django项目目录结构和基础文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ django-admin startproject salary .</span><br></pre></td></tr></table></figure>

<p>构建一个项目叫做blog，注意最后有个<strong>点</strong>，表示在当前目录即项目根目录创建</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">项目根目录</span><br><span class="line">├─ manage.py</span><br><span class="line">└─ salary</span><br><span class="line">	├─ settings.py </span><br><span class="line">    ├─ urls.py </span><br><span class="line">    ├─ wsgi.py </span><br><span class="line">    └─ __init__.py</span><br></pre></td></tr></table></figure>

<p>重要文件说明</p>
<p>manage.py：本项目管理的命令行工具。应用创建、数据库迁移等都使用它完成</p>
<p><strong>salary/settings.py</strong>：本项目的全局核心配置文件</p>
<ul>
<li><p>应用、数据库配置</p>
</li>
<li><p>模板、静态文件</p>
</li>
<li><p>中间件、日志</p>
</li>
<li><p>第三方插件配置</p>
</li>
</ul>
<p><strong>blog/urls.py</strong>：URL路径映射配置。项目初始，只配置了/admin的路由</p>
<p>blog/wsgi：定义WSGI接口信息。部署用，一般无需改动</p>
<h3 id="MySQL数据库驱动"><a href="#MySQL数据库驱动" class="headerlink" title="MySQL数据库驱动"></a>MySQL数据库驱动</h3><p>Django支持MySQL 5.5+</p>
<p>Django官方推荐使用本地驱动mysqlclient 1.3.7 +</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install mysqlclient</span><br></pre></td></tr></table></figure>

<h3 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h3><p>创建应用 employee</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py startapp employee</span><br></pre></td></tr></table></figure>

<p>创建应用后，项目根目录下产生一个employee目录，有如下文件：</p>
<ul>
<li><p>admin.py：应用后台管理声明文件</p>
</li>
<li><p><strong>models.py</strong>：模型层Model类定义</p>
</li>
<li><p><strong>views.py</strong>：定义URL响应函数或类</p>
</li>
<li><p>migrations包：数据迁移文件生成目录</p>
</li>
<li><p>apps.py：应用的信息定义文件</p>
</li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>salary/settings.py是全局配置文件</p>
<h3 id="注册应用"><a href="#注册应用" class="headerlink" title="注册应用"></a>注册应用</h3><p>注册应用，可以做迁移migrate、做后台管理Admin等，一般建议注册</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [ </span><br><span class="line">    <span class="string">'django.contrib.admin'</span>, </span><br><span class="line">    <span class="string">'django.contrib.auth'</span>, </span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>, </span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>, </span><br><span class="line">    <span class="string">'django.contrib.messages'</span>, </span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>, </span><br><span class="line">    <span class="string">'employee'</span>, </span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h3><p>用数据库，需要修改默认的数据库配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'数据库名'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'用户'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'密码'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'test'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'wjxyzs@qq.com'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">配置项</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">HOST</td>
<td align="center">数据库主机。缺省是空字符串，代表localhost。如果是’/‘开头表示使用UnixSocket连接</td>
</tr>
<tr>
<td align="center">POST</td>
<td align="center">端口</td>
</tr>
<tr>
<td align="center">USER</td>
<td align="center">用户名</td>
</tr>
<tr>
<td align="center">PASSWORD</td>
<td align="center">密码</td>
</tr>
<tr>
<td align="center">NAME</td>
<td align="center">库名</td>
</tr>
<tr>
<td align="center">OPTIONS</td>
<td align="center">选项，字典类型，参考MySQL文档</td>
</tr>
</tbody></table>
<p>数据库引擎ENGINE</p>
<p>内建的引擎有</p>
<ul>
<li><p><code>&#39;django.db.backends.postgresql&#39;</code></p>
</li>
<li><p><code>&#39;django.db.backends.mysql&#39;</code></p>
</li>
<li><p><code>&#39;django.db.backends.sqlite3&#39;</code></p>
</li>
<li><p><code>&#39;django.db.backends.oracle&#39;</code></p>
</li>
</ul>
<h3 id="本地化和时区"><a href="#本地化和时区" class="headerlink" title="本地化和时区"></a>本地化和时区</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = <span class="string">'zh-Hans'</span>    <span class="comment"># 'en-us' -&gt; 'zh-Hans' 中文简体</span></span><br><span class="line">TIME_ZONE = <span class="string">'Asia/Shanghai'</span>  <span class="comment"># 'UTC' -&gt; 'Asia/Shanghai' 亚洲时区</span></span><br><span class="line">USE_TZ = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p>Django的日志配置在settings.py中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">'version'</span>: <span class="number">1</span>, </span><br><span class="line">    <span class="string">'disable_existing_loggers'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'handlers'</span>: &#123; </span><br><span class="line">        <span class="string">'console'</span>: &#123; </span><br><span class="line">            <span class="string">'class'</span>: <span class="string">'logging.StreamHandler'</span>, </span><br><span class="line">        &#125;, </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'loggers'</span>: &#123; </span><br><span class="line">        <span class="string">'django.db.backends'</span>: &#123;</span><br><span class="line">        	<span class="string">'handlers'</span>: [<span class="string">'console'</span>], </span><br><span class="line">        	<span class="string">'level'</span>: <span class="string">'DEBUG'</span>,</span><br><span class="line">        &#125;, </span><br><span class="line">    &#125;, </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置后，就可以在控制台看到执行的SQL语句</p>
<p><font color='red'>注意，settings.py中必须<strong>DEBUG=True</strong>，同时loggers的leve是DEBUG，否则从控制台看不到SQL语句</font></p>
<p>Django内建loggers可以参考：<a href="https://docs.djangoproject.com/en/3.2/topics/logging/#django-db-backends" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/topics/logging/#django-db-backends</a></p>
<h3 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h3><p>迁移：指的是把Django中定义的Model类和属性，转换成数据库中表和字段的过程</p>
<p>迁移一般需要两个过程：</p>
<ol>
<li><p>制作迁移文件</p>
</li>
<li><p>迁移</p>
</li>
</ol>
<p>Django内部也有应用，它们也需要表。这些表的迁移文件已经生成了，只需要迁移</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>迁移后，数据库中产生下面这些表：auth_group, auth_group_permissions, auth_permission,auth_user, auth_user_groups, auth_user_user_permissions, django_admin_log,django_content_type, django_migrations, django_session</p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py runserver</span><br></pre></td></tr></table></figure>

<p>访问 <a href="http://127.0.0.1:8000/" target="_blank" rel="noopener">http://127.0.0.1:8000/</a> 即可</p>
<p>这就是一个Django项目构建基本流程，之后项目构建方式、配置都大同小异</p>
<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><p>ORM，对象关系映射， 对象 和 关系 之间的映射。这样就可以使用面向对象的方式来操作数据库中的 表。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关系模型和Python对象之间的映射</span></span><br><span class="line">table  =&gt; class     # 表映射为类</span><br><span class="line">row    =&gt; object    # 行映射为实例</span><br><span class="line">column =&gt; property  # 字段映射为属性</span><br></pre></td></tr></table></figure>

<p>举例，有表student，字段为id int，name varchar，age int 映射到Python为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">id = ?某类型字段</span><br><span class="line">name = ?某类型字段 age = ?某类型字段</span><br><span class="line"></span><br><span class="line"><span class="comment">#最终得到实例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.id = ?</span><br><span class="line">        self.name = ?</span><br><span class="line">        self.age = ?</span><br></pre></td></tr></table></figure>

<h3 id="Django-ORM"><a href="#Django-ORM" class="headerlink" title="Django ORM"></a>Django ORM</h3><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230121055833080.png" alt="image-20230121055833080"></p>
<p>对模型对象的CRUD，被Django ORM转换成相应的SQL语句以操作不同的数据源。 </p>
<h3 id="Model模型"><a href="#Model模型" class="headerlink" title="Model模型"></a>Model模型</h3><h4 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h4><table>
<thead>
<tr>
<th align="center">字段类</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">AutoField(***)</td>
<td align="center">自增的整数字段。 如果不指定，django会为模型类自动增加主键字段</td>
</tr>
<tr>
<td align="center">BooleanField</td>
<td align="center">布尔值字段，True和False 对应表单控件CheckboxInput</td>
</tr>
<tr>
<td align="center">NullBooleanField</td>
<td align="center">比BooleanField多一个null值</td>
</tr>
<tr>
<td align="center">CharField(***)</td>
<td align="center">字符串，max_length设定字符长度 对应表单控件TextInput</td>
</tr>
<tr>
<td align="center">TextField</td>
<td align="center">大文本字段，一般超过4000个字符使用 对应表单控件Textarea</td>
</tr>
<tr>
<td align="center">IntegerField(***)</td>
<td align="center">整数字段</td>
</tr>
<tr>
<td align="center">BigIntegerField</td>
<td align="center">更大整数字段，8字节</td>
</tr>
<tr>
<td align="center">DecimalField</td>
<td align="center">使用Python的Decimal实例表示十进制浮点数。max_digits总位数， decimal_places小数点后的位数</td>
</tr>
<tr>
<td align="center">FloatField</td>
<td align="center">Python的Float实例表示的浮点数</td>
</tr>
<tr>
<td align="center"><br>DateField(***)</td>
<td align="center">使用Python的datetime.date实例表示的日期 auto_now=False每次修改对象自动设置为当前时间。 auto_now_add=False对象第一次创建时自动设置为当前时间。 auto_now_add、auto_now、default互斥 对应控件为TextInput，关联了一个Js编写的日历控件</td>
</tr>
<tr>
<td align="center">TimeField</td>
<td align="center">使用Python的datetime.time实例表示的时间，参数同上</td>
</tr>
<tr>
<td align="center">DateTimeField</td>
<td align="center">使用Python的datetime.datetime实例表示的时间，参数同上</td>
</tr>
<tr>
<td align="center">FileField</td>
<td align="center">一个上传文件的字段</td>
</tr>
<tr>
<td align="center">ImageField</td>
<td align="center">继承了FileField的所有属性和方法，但是对上传的文件进行校验，确保 是一个有效的图片</td>
</tr>
<tr>
<td align="center">EmailField(***)</td>
<td align="center">能做Email检验，基于CharField，默认max_length=254</td>
</tr>
<tr>
<td align="center">GenericIPAddressField</td>
<td align="center">支持IPv4、IPv6检验，缺省对应文本框输入</td>
</tr>
<tr>
<td align="center">URLField</td>
<td align="center">能做URL检验，基于基于CharField，默认max_length=200</td>
</tr>
</tbody></table>
<h4 id="缺省主键"><a href="#缺省主键" class="headerlink" title="缺省主键"></a>缺省主键</h4><p>缺省情况下，Django的每一个Model都有一个名为id的AutoField字段，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=models.AutoField(primary_key=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>如果显式定义了主键，这种缺省主键就不会被创建了。</p>
<p>Python之禅中说“显式优于隐式”，所以，如果有必要，还是尽量使用自己定义的主键，哪怕该字段名就 是id，也是一种不错的选择。</p>
<p>Django 3.2中增加了 DEFAULT_AUTO_FIELD 对缺省主键字段类型进行设置。</p>
<h4 id="字段选项"><a href="#字段选项" class="headerlink" title="字段选项"></a>字段选项</h4><p>参考 <a href="https://docs.djangoproject.com/en/3.2/ref/models/fields/#field-options" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/ref/models/fields/#field-options</a></p>
<table>
<thead>
<tr>
<th align="center">值</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">db_column</td>
<td align="center">表中字段的名称。如果未指定，则使用属性名</td>
</tr>
<tr>
<td align="center">primary_key</td>
<td align="center">是否主键</td>
</tr>
<tr>
<td align="center">unique</td>
<td align="center">是否是唯一键</td>
</tr>
<tr>
<td align="center">default</td>
<td align="center">缺省值。这个缺省值不是数据库字段的缺省值，而是新对象产生的时候被填入的 缺省值</td>
</tr>
<tr>
<td align="center">null</td>
<td align="center">表的字段是否可为null，默认为False</td>
</tr>
<tr>
<td align="center">blank</td>
<td align="center">Django表单验证中，是否可以不填写，默认为False</td>
</tr>
<tr>
<td align="center">db_index</td>
<td align="center">字段是否有索引</td>
</tr>
</tbody></table>
<h4 id="关系类型字段类"><a href="#关系类型字段类" class="headerlink" title="关系类型字段类"></a>关系类型字段类</h4><table>
<thead>
<tr>
<th align="center">类</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ForeignKey</td>
<td align="center">外键，表示一对多ForeignKey(‘production.Manufacturer’) 自关联ForeignKey(‘self’)</td>
</tr>
<tr>
<td align="center">ManyToManyField</td>
<td align="center">表示多对多</td>
</tr>
<tr>
<td align="center">OneToOneField</td>
<td align="center">表示一对一</td>
</tr>
</tbody></table>
<h4 id="Model类"><a href="#Model类" class="headerlink" title="Model类"></a>Model类</h4><ul>
<li><p>从基类 django.db.models.Model 派生出与表对应的Model类 </p>
</li>
<li><p>内部定义 class Meta ，在其类属性上定义</p>
<ul>
<li><code>db_table = &#39;employee&#39;</code>，如果不指定，表名为 <code>&lt;appname&gt;_&lt;model_name&gt;</code></li>
<li>unique_together定义联合唯一键，未来可能过期。建议使用UniqueConstraint </li>
<li>ordering=[‘-pk’]定义默认排序规则</li>
</ul>
</li>
<li><p>字段</p>
<ul>
<li>使用Model类的类属性定义来对应字段 </li>
<li>如果不迁移，可以和数据库字段定义的不一致 </li>
<li>字段属性<ul>
<li>primary_key 是否主键，默认False unique </li>
<li>是否唯一键，默认False</li>
<li>null 是否可以为null，默认False即必填 </li>
<li>verbose_name 可视化的名字</li>
<li>choices 提供枚举值，每一项枚举值是二元组(value, label)，值是存储用，label用来展 示。 p.gender 获取字段值value， p.get_gender_display() 获取label</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>项目目录DjangoTest下employee应用目录下的models.py，这里就是定义Model类的地方</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">CREATE TABLE `employees` (</span></span><br><span class="line"><span class="string">  `emp_no` int(11) NOT NULL,</span></span><br><span class="line"><span class="string">  `birth_date` date NOT NULL,</span></span><br><span class="line"><span class="string">  `first_name` varchar(14) NOT NULL,</span></span><br><span class="line"><span class="string">  `last_name` varchar(16) NOT NULL,</span></span><br><span class="line"><span class="string">  `gender` smallint(6) NOT NULL DEFAULT '1' COMMENT 'M=1, F=2',</span></span><br><span class="line"><span class="string">  `hire_date` date NOT NULL,</span></span><br><span class="line"><span class="string">  PRIMARY KEY (`emp_no`)</span></span><br><span class="line"><span class="string">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Gender</span><span class="params">(models.IntegerChoices)</span>:</span> <span class="comment"># 枚举类型，限定取值范围</span></span><br><span class="line">      MAN = <span class="number">1</span>, <span class="string">'男'</span></span><br><span class="line">      FEMALE = <span class="number">2</span>, <span class="string">'女'</span> </span><br><span class="line">      </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    	db_table = <span class="string">'employees'</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment">#由于不是自增id主键字段，所以要定义主键</span></span><br><span class="line">    emp_no = models.IntegerField(primary_key=<span class="literal">True</span>, verbose_name=<span class="string">'工号'</span>)  <span class="comment"># 主键</span></span><br><span class="line">    birth_date = models.DateField()  <span class="comment"># 默认null为False即必填 </span></span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">14</span>, verbose_name=<span class="string">'名'</span>) </span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">16</span>, verbose_name=<span class="string">'姓'</span>) </span><br><span class="line">    gender = models.SmallIntegerField(choices=Gender.choices, verbose_name=<span class="string">'性别'</span>)</span><br><span class="line">    hire_date = models.DateField()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span>:</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"&#123;&#125; &#123;&#125;"</span>.format(self.last_name, self.first_name)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"&lt;E &#123;&#125;, &#123;&#125;&gt;"</span>.format(self.emp_no, self.name)</span><br><span class="line">    </span><br><span class="line">    __str__ = __repr__</span><br></pre></td></tr></table></figure>

<p>在项目根目录编写一个test.py，内容如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line">os.environ.setdefault(<span class="string">'DJANGO_SETTINGS_MODULE'</span>, <span class="string">'salary.settings'</span>)</span><br><span class="line">django.setup(set_prefix=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#所有测试代码，都要在上面4行之下</span></span><br><span class="line"><span class="keyword">from</span> employee.models <span class="keyword">import</span> Employee</span><br><span class="line"></span><br><span class="line">emps = Employee.objects.all()  <span class="comment"># 结果集，本句不发起查询 </span></span><br><span class="line">print(type(emps))  <span class="comment"># QuerySet查询集</span></span><br><span class="line">print(*emps, sep=<span class="string">'\n'</span>)  <span class="comment"># __repr__ 所有员工 </span></span><br><span class="line">print(emps[<span class="number">0</span>].gender, emps[<span class="number">0</span>].get_gender_display())  <span class="comment"># 枚举类型</span></span><br></pre></td></tr></table></figure>

<p><a href="https://docs.djangoproject.com/en/3.2/ref/models/fields/#django.db.models.Field.choices" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/ref/models/fields/#django.db.models.Field.choices</a></p>
<h4 id="管理器"><a href="#管理器" class="headerlink" title="管理器"></a>管理器</h4><p>管理器非常重要，有了它才能操作数据库。 每一个非抽象的Model类必须有一个Manager实例。如果不指定，Django会默认指定一个Manager，就是属性objects。</p>
<p>参考：<a href="https://docs.djangoproject.com/en/3.2/topics/db/managers/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/topics/db/managers/</a></p>
<h2 id="Django查询"><a href="#Django查询" class="headerlink" title="Django查询"></a>Django查询</h2><p>和DML一样，增删改不难，最复杂的就是查询。</p>
<h3 id="查询集"><a href="#查询集" class="headerlink" title="查询集"></a>查询集</h3><p>如果查的是一批数据，那么返回的是一个结果的集合</p>
<p>它是django.db.models.query.QuerySet的实例 可迭代对象</p>
<p>1、惰性求值 </p>
<p>创建查询集不会带来任何对数据库的访问，直到调用方法使用数据时，才会访问数据库。</p>
<p>参考：<a href="https://docs.djangoproject.com/en/3.2/ref/models/querysets/#when-querysets-are-evaluated" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/ref/models/querysets/#when-querysets-are-evaluated</a></p>
<p>2、缓存</p>
<p>参考：<a href="https://docs.djangoproject.com/en/3.2/topics/db/queries/#caching-and-querysets" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/topics/db/queries/#caching-and-querysets</a></p>
<p>每一个查询集都包含一个缓存，来最小化对数据库的访问。</p>
<p>新建查询集，缓存为空。首次对查询集求值时，会发生数据库查询，Django会把查询的结果存在这个缓 存中，并返回请求的结果，接下来对查询集求值将使用缓存的结果。</p>
<p>通过日志，观察下面的2个例子是要看真正生成的语句了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> employee.models <span class="keyword">import</span> Employee</span><br><span class="line"></span><br><span class="line">emps = Employee.objects.all() <span class="comment"># 结果集，本句不发起查询 print(type(emps)) # QuerySet查询集</span></span><br><span class="line">print(<span class="number">1</span>, emps)</span><br><span class="line">print(<span class="number">2</span>, emps)</span><br><span class="line">print(<span class="number">3</span>, emps[<span class="number">0</span>])</span><br><span class="line">print(<span class="number">4</span>, emps[<span class="number">0</span>]) print(emps._result_cache) <span class="comment"># None # 上面需要查询4次数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> employee.models <span class="keyword">import</span> Employee</span><br><span class="line"></span><br><span class="line">emps = Employee.objects.all() <span class="comment"># 结果集，本句不发起查询 print(type(emps)) # QuerySet查询集 print(list(emps)) # print(*emps) 先遍历一遍，缓存住 print(1, emps)</span></span><br><span class="line">print(<span class="number">2</span>, emps)</span><br><span class="line">print(<span class="number">3</span>, emps[<span class="number">0</span>])</span><br><span class="line">print(<span class="number">4</span>, emps[:]) print(emps._result_cache) <span class="comment"># 结果集列表</span></span><br></pre></td></tr></table></figure>

<h3 id="限制查询集-切片"><a href="#限制查询集-切片" class="headerlink" title="限制查询集(切片)"></a>限制查询集(切片)</h3><p>分页功能实现，使用限制查询集。 查询集对象可以直接使用索引下标的方式(不支持负索引)，相当于SQL语句中的limit和offset子句。</p>
<p>注意:使用切片返回的新的结果集，依然是惰性求值，不会立即查询。但是使用了切片步长，会立即查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LIMIT 5 OFFSET 10</span></span><br><span class="line">qs = Employee.objects.all()[<span class="number">10</span>:<span class="number">15</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># LIMIT 10 OFFSET 20</span></span><br><span class="line">qs = Employee.objects.all()[<span class="number">20</span>:<span class="number">30</span>]</span><br></pre></td></tr></table></figure>

<p><font color="red"><strong>注意：在使用print函数打印结果集的时候，看到SQL语句有自动添加的LIMIT 21，这是怕打印的太长了。 使用for循环迭代就没了。</strong></font></p>
<h3 id="结果集方法"><a href="#结果集方法" class="headerlink" title="结果集方法"></a>结果集方法</h3><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">返回值类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">all()</td>
<td align="center">QuerySet</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">filter()</td>
<td align="center">QuerySet</td>
<td align="center">过滤，返回满足条件的数据</td>
</tr>
<tr>
<td align="center">exclude()</td>
<td align="center">QuerySet</td>
<td align="center">排除，排除满足条件的数据</td>
</tr>
<tr>
<td align="center">order_by()</td>
<td align="center">QuerySet</td>
<td align="center">排序，注意参数是字符串</td>
</tr>
<tr>
<td align="center">values()</td>
<td align="center">QuerySet</td>
<td align="center">返回集合内的元素是字典，字典内是字段和值的键值对</td>
</tr>
</tbody></table>
<p>返回值如果是QuerySet类型，可以链式调用。</p>
<p>filter(k1=v1).filter(k2=v2) 等价于 filter(k1=v1, k2=v2)</p>
<p>filter(pk=10)这里pk指的就是主键， 不用关心主键字段名，当然也可以使用使用主键名 filter(emp_no=10)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mgr = Employee.objects</span><br><span class="line">print(mgr.all())</span><br><span class="line">print(mgr.values())</span><br><span class="line">print(mgr.filter(pk=<span class="number">10010</span>).values())</span><br><span class="line">print(mgr.exclude(emp_no=<span class="number">10001</span>)) print(mgr.exclude(emp_no=<span class="number">10002</span>).order_by(<span class="string">'emp_no'</span>)) print(mgr.exclude(emp_no=<span class="number">10002</span>).order_by(<span class="string">'-pk'</span>)) print(mgr.exclude(emp_no=<span class="number">10002</span>).order_by(<span class="string">'gender'</span>, <span class="string">'-pk'</span>).values()) <span class="comment"># 返回依然是 QuerySet</span></span><br></pre></td></tr></table></figure>

<p>filter(pk=10010) 这是关键字传参，所以不能写成 filter(pk!=10010) 或 filter(pk&gt;=10010)</p>
<h3 id="返回单个值的方法"><a href="#返回单个值的方法" class="headerlink" title="返回单个值的方法"></a>返回单个值的方法</h3><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><br>get()</td>
<td align="center">严格返回满足条件的单个对象<br>如果未能返回对象则抛出DoesNotExist异常;如果能返回多条，抛出<br>MultipleObjectsReturned异常</td>
</tr>
<tr>
<td align="center">count()</td>
<td align="center">返回当前查询的总条数</td>
</tr>
<tr>
<td align="center">first()</td>
<td align="center">返回第一个对象</td>
</tr>
<tr>
<td align="center">last()</td>
<td align="center">返回最后一个对象</td>
</tr>
<tr>
<td align="center">exist()</td>
<td align="center">判断查询集中是否有数据，如果有则返回True</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mgr = Employee.objects print(mgr.filter(pk=<span class="number">10010</span>).get()) print(mgr.get(pk=<span class="number">10001</span>)) <span class="comment">#print(mgr.exclude(pk=10010).get()) # get严格一个</span></span><br><span class="line">print(mgr.first()) <span class="comment"># limit 1</span></span><br><span class="line">print(mgr.exclude(pk=<span class="number">10010</span>).last()) <span class="comment"># desc, limit 1 print(mgr.filter(pk=10010, gender=1).first()) # AND，找不到返回None print(mgr.count())</span></span><br><span class="line">print(mgr.exclude(pk=<span class="number">10010</span>).count())</span><br></pre></td></tr></table></figure>

<h3 id="字段查询-Field-Lookup-表达式"><a href="#字段查询-Field-Lookup-表达式" class="headerlink" title="字段查询(Field Lookup)表达式"></a>字段查询(Field Lookup)表达式</h3><p>参考：<a href="https://docs.djangoproject.com/en/3.2/ref/models/querysets/#field-lookups" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/ref/models/querysets/#field-lookups</a> 字段查询表达式可以作为filter()、exclude()、get()的参数，实现where子句。<br>语法：<code>属性名称__比较运算符=值</code>。注意:属性名和运算符之间使用双下划线</p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">举例</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">exact</td>
<td align="center">filter(isdeleted=False)<br>filter(isdeleted__exact=False)</td>
<td align="center">严格等于，可省略不写</td>
</tr>
<tr>
<td align="center"><br>contains</td>
<td align="center"><br/>exclude(title__contains=’天’)</td>
<td align="center">是否包含，大小写敏感，等价于 like binary ‘%天%’<br>模糊匹配效率很低</td>
</tr>
<tr>
<td align="center">startswith、endswith</td>
<td align="center">filter(title__startswith=’天’)</td>
<td align="center">以什么开头或结尾，大小写敏感</td>
</tr>
<tr>
<td align="center">isnull、 isnotnull</td>
<td align="center">filter(title__isnull=False)</td>
<td align="center">是否为null</td>
</tr>
<tr>
<td align="center">iexact、icontains、 istartswith、iendswith</td>
<td align="center"></td>
<td align="center">i的意思是忽略大小写</td>
</tr>
<tr>
<td align="center">in</td>
<td align="center">filter(pk__in=[1,2,3,100])</td>
<td align="center">是否在指定范围数据中</td>
</tr>
<tr>
<td align="center"><br>gt、gte、lt、lte</td>
<td align="center"><code>filter(id__gt=3)</code><br><code>filter(pk__lte=6)</code><br><code>filter(pub_date__gt=date(2000,1,1))</code></td>
<td align="center"><br>大于、小于等</td>
</tr>
<tr>
<td align="center">year、month、day、week_day、hour、minute、second</td>
<td align="center">filter(pub_date__year=2000)</td>
<td align="center">对日期类型属性处理</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mgr = Employee.objects</span><br><span class="line">print(mgr.filter(emp_no__exact=<span class="number">10010</span>))        <span class="comment"># 就是等于，所以很少用exact </span></span><br><span class="line">print(mgr.filter(pk__in=[<span class="number">10010</span>, <span class="number">10009</span>])) </span><br><span class="line">print(mgr.filter(last_name__startswith=<span class="string">'P'</span>))  <span class="comment"># 姓氏没建索引，不推荐</span></span><br><span class="line">print(mgr.filter(pk__in=[<span class="number">1000</span>,<span class="number">1001</span>,<span class="number">1002</span>])</span><br><span class="line">print(mgr.exclude(pk__gt=<span class="number">10003</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Q对象"><a href="#Q对象" class="headerlink" title="Q对象"></a>Q对象</h3><p>虽然Django提供传入条件的方式，但是不方便，它还提供了Q对象来解决。</p>
<p>Q对象是django.db.models.Q，可以使用&amp;、|操作符来组成逻辑表达式。 ~ 表示not。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"></span><br><span class="line">mgr = Employee.objects</span><br><span class="line">print(mgr.filter(Q(pk__lt=<span class="number">10006</span>)))  <span class="comment"># 不如直接写filter(pk__lt=10006) </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#下面几句一样</span></span><br><span class="line">print(mgr.filter(pk__gt=<span class="number">10003</span>).filter(pk__lt=<span class="number">10006</span>))  <span class="comment"># 与 </span></span><br><span class="line">print(mgr.filter(pk__gt=<span class="number">10003</span>, pk__lt=<span class="number">10006</span>))  <span class="comment"># 与 </span></span><br><span class="line">print(mgr.filter(Q(pk__gt=<span class="number">10003</span>), Q(pk__lt=<span class="number">10006</span>))) </span><br><span class="line">print(mgr.filter(Q(pk__gt=<span class="number">10003</span>) &amp; Q(pk__lt=<span class="number">10006</span>)))  <span class="comment"># 与 </span></span><br><span class="line">print(mgr.filter(pk__gt=<span class="number">10003</span>) &amp; mgr.filter(pk__lt=<span class="number">10006</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#下面几句等价</span></span><br><span class="line">print(mgr.filter(pk__in=[<span class="number">10003</span>, <span class="number">10006</span>]))  <span class="comment"># in </span></span><br><span class="line">print(mgr.filter(Q(pk=<span class="number">10003</span>) | Q(pk=<span class="number">10006</span>)))  <span class="comment"># 或 </span></span><br><span class="line">print(mgr.filter(pk=<span class="number">10003</span>) | mgr.filter(pk=<span class="number">10006</span>))</span><br><span class="line">print(mgr.filter(~Q(pk__gt=<span class="number">10003</span>)))  <span class="comment"># 非</span></span><br></pre></td></tr></table></figure>

<p>可使用&amp;|和Q对象来构造复杂的逻辑表达式，可以使用一个或多个Q对象。 </p>
<p>如果混用关键字参数和Q对象，那么Q对象必须位于关键字参数的前面。</p>
<h3 id="聚合、分组"><a href="#聚合、分组" class="headerlink" title="聚合、分组"></a>聚合、分组</h3><p>aggregate() 返回字典，方便使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> employee.models <span class="keyword">import</span> Employee</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q, Avg, Sum, Max, Min, Count</span><br><span class="line"></span><br><span class="line">mgr = Employee.objects</span><br><span class="line">print(mgr.filter(pk__gt=<span class="number">10010</span>).count())  <span class="comment"># 单值 </span></span><br><span class="line">print(mgr.filter(pk__gt=<span class="number">10010</span>).aggregate(Count(<span class="string">'pk'</span>), Max(<span class="string">'pk'</span>)))  <span class="comment"># 字典</span></span><br><span class="line">print(mgr.filter(pk__lte=<span class="number">10010</span>).aggregate(Avg(<span class="string">'pk'</span>))) </span><br><span class="line">print(mgr.aggregate(Max(<span class="string">'pk'</span>), min=Min(<span class="string">'pk'</span>)))  <span class="comment"># 别名</span></span><br></pre></td></tr></table></figure>

<p>annotate()方法用来分组聚合，返回查询集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mgr = Employee.objects print(mgr.filter(pk__gt=<span class="number">10010</span>).aggregate(Count(<span class="string">'pk'</span>))) <span class="comment"># 字典</span></span><br><span class="line">s = mgr.filter(pk__gt=<span class="number">10010</span>).annotate(Count(<span class="string">'pk'</span>)) <span class="comment"># 返回查询集，没指定分组字段，使用主键分组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">		print(x)</span><br><span class="line">		print(x.__dict__) <span class="comment"># 里面多了一个属性pk__count</span></span><br></pre></td></tr></table></figure>

<p>values()方法，放在annotate前就是指定分组字段，之后就是取结果中的字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">mgr = Employee.objects</span><br><span class="line">s = mgr.filter(pk__gt=<span class="number">10010</span>).values(<span class="string">'gender'</span>).annotate(Count(<span class="string">'pk'</span>)) <span class="comment"># 查询集 print(s)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">		print(x) <span class="comment"># 字典</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 运行结果如下</span></span><br><span class="line">&lt;QuerySet [&#123;<span class="string">'gender'</span>: <span class="number">2</span>, <span class="string">'pk__count'</span>: <span class="number">3</span>&#125;, &#123;<span class="string">'gender'</span>: <span class="number">1</span>, <span class="string">'pk__count'</span>: <span class="number">7</span>&#125;]&gt; &#123;<span class="string">'gender'</span>: <span class="number">2</span>, <span class="string">'pk__count'</span>: <span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="string">'gender'</span>: <span class="number">1</span>, <span class="string">'pk__count'</span>: <span class="number">7</span>&#125;</span><br><span class="line"></span><br><span class="line">mgr = Employee.objects</span><br><span class="line">s= mgr.filter(pk__gt=<span class="number">10010</span>).values(<span class="string">'gender'</span>).annotate(c=Count(<span class="string">'pk'</span>)).order_by(<span class="string">' -c'</span>) <span class="comment"># 查询集</span></span><br><span class="line">print(s)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">		print(x) <span class="comment"># 字典</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 运行结果如下</span></span><br><span class="line">&lt;QuerySet [&#123;<span class="string">'gender'</span>: <span class="number">1</span>, <span class="string">'c'</span>: <span class="number">7</span>&#125;, &#123;<span class="string">'gender'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;]&gt; &#123;<span class="string">'gender'</span>: <span class="number">1</span>, <span class="string">'c'</span>: <span class="number">7</span>&#125;</span><br><span class="line">&#123;<span class="string">'gender'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">mgr = Employee.objects</span><br><span class="line">s = mgr.filter(pk__gt=<span class="number">10010</span>).values(<span class="string">'gender'</span>).annotate(</span><br><span class="line">		Avg(<span class="string">'pk'</span>), c=Count(<span class="string">'pk'</span>)</span><br><span class="line">).order_by(<span class="string">'-c'</span>).values(<span class="string">'pk__avg'</span>, <span class="string">'c'</span>) <span class="comment"># 查询集,但后面的values过滤了每个对象字典 的key</span></span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">		print(x) <span class="comment"># 字典</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 运行结果如下</span></span><br><span class="line">&lt;QuerySet [&#123;<span class="string">'pk__avg'</span>: <span class="number">10015.5714</span>, <span class="string">'c'</span>: <span class="number">7</span>&#125;, &#123;<span class="string">'pk__avg'</span>: <span class="number">10015.3333</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;]&gt;</span><br><span class="line">&#123;<span class="string">'pk__avg'</span>: <span class="number">10015.5714</span>, <span class="string">'c'</span>: <span class="number">7</span>&#125;</span><br><span class="line">&#123;<span class="string">'pk__avg'</span>: <span class="number">10015.3333</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Django-ORM-1"><a href="#Django-ORM-1" class="headerlink" title="Django ORM"></a>Django ORM</h2><h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><p>员工和工资表是一对多关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">CREATE TABLE `salaries` (</span></span><br><span class="line"><span class="string">  `emp_no` int(11) NOT NULL,</span></span><br><span class="line"><span class="string">  `salary` int(11) NOT NULL,</span></span><br><span class="line"><span class="string">  `from_date` date NOT NULL,</span></span><br><span class="line"><span class="string">  `to_date` date NOT NULL,</span></span><br><span class="line"><span class="string">  PRIMARY KEY (`emp_no`,`from_date`),</span></span><br><span class="line"><span class="string">  CONSTRAINT `salaries_ibfk_1` FOREIGN KEY (`emp_no`) REFERENCES `employees`</span></span><br><span class="line"><span class="string">(`emp_no`) ON DELETE CASCADE</span></span><br><span class="line"><span class="string">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h4 id="联合主键问题"><a href="#联合主键问题" class="headerlink" title="联合主键问题"></a>联合主键问题</h4><p>SQLAlchemy提供了联合主键支持，但是Django至今都没有支持。 Django只支持单一主键，这也是我提倡的。但对于本次基于Django测试的表就只能增加一个单一主键了。</p>
<p>原因，请参看：<a href="https://code.djangoproject.com/wiki/MultipleColumnPrimaryKeys" target="_blank" rel="noopener">https://code.djangoproject.com/wiki/MultipleColumnPrimaryKeys</a> 。Django 到目前为止也没有提供这种Composite primary key Django不能直接添加自己的2个字段的联合主键，我们手动为表创建一个自增id主键。操作顺序如下:</p>
<ol>
<li><p>取消表所有联合主键，并删除所有外键约束后保存，成功再继续</p>
</li>
<li><p>为表增加一个id字段，自增、主键。保存，如果成功，它会自动填充数据 </p>
</li>
<li><p>重建原来的外键约束即可</p>
</li>
</ol>
<h4 id="模型构建"><a href="#模型构建" class="headerlink" title="模型构建"></a>模型构建</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Gender</span><span class="params">(models.IntegerChoices)</span>:</span>  <span class="comment"># 枚举类型，限定取值范围</span></span><br><span class="line">        MAN = <span class="number">1</span>, <span class="string">'男'</span></span><br><span class="line">        FEMALE = <span class="number">2</span>, <span class="string">'女'</span> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    		db_table = <span class="string">'employees'</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">#由于不是自增id主键字段，所以要定义主键</span></span><br><span class="line">    emp_no = models.IntegerField(primary_key=<span class="literal">True</span>, verbose_name=<span class="string">'工号'</span>) <span class="comment"># 主键</span></span><br><span class="line">    birth_date = models.DateField()  <span class="comment"># 默认null为False即必填 </span></span><br><span class="line">    first_name = models.CharField(max_length=<span class="number">14</span>, verbose_name=<span class="string">'名'</span>) </span><br><span class="line">    last_name = models.CharField(max_length=<span class="number">16</span>, verbose_name=<span class="string">'姓'</span>) </span><br><span class="line">    gender = models.SmallIntegerField(choices=Gender.choices, verbose_name=<span class="string">'性别'</span>)</span><br><span class="line">    hire_date = models.DateField()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&#123;&#125; &#123;&#125;"</span>.format(self.last_name, self.first_name)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;E &#123;&#125;, &#123;&#125;&gt;"</span>.format(self.emp_no, self.name)</span><br><span class="line">      </span><br><span class="line">    __str__ = __repr__</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Salary</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">				db_table = <span class="string">'salaries'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#id = models.AutoField(primary_key=True) # 额外增加的主键，Django不支持联合主键</span></span><br><span class="line">    emp_no = models.ForeignKey(<span class="string">'Employee'</span>, on_delete=models.CASCADE) </span><br><span class="line">    from_date = models.DateField()</span><br><span class="line">    salary = models.IntegerField(verbose_name=<span class="string">'工资'</span>)</span><br><span class="line">    to_date = models.DateField()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;S &#123;&#125;, &#123;&#125;, &#123;&#125;&gt;"</span>.format(self.pk, self.emp_no, self.salary)</span><br><span class="line">      </span><br><span class="line">    __str__ = __repr__</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#测试一下，没有问题再开始</span></span><br><span class="line"><span class="keyword">from</span> employee.models <span class="keyword">import</span> Employee, Salary</span><br><span class="line"></span><br><span class="line">mgr = Employee.objects</span><br><span class="line">print(mgr.filter(pk=<span class="number">10004</span>))</span><br><span class="line">print(Salary.objects.all())</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试的时候，使用 print(Salary.objects.all())</span></span><br><span class="line"><span class="comment">#报错"Unknown column 'salaries.emp_no_id' in 'field list'"</span></span><br><span class="line"><span class="comment">#Django习惯给外键默认起名为xxx_id</span></span><br><span class="line"><span class="comment">#修改Salary的emp_no，增加db_column来指定字段名称，如下</span></span><br><span class="line">emp_no = models.ForeignKey(<span class="string">'Employee'</span>, on_delete=models.CASCADE, db_column=<span class="string">'emp_no'</span>)</span><br></pre></td></tr></table></figure>

<p>ForeignKey还有一个选项to_field，表示关联到主表的哪个字段，默认使用主键，如果需要指定其它字 段，要求必须是唯一键字段。</p>
<h4 id="特殊属性"><a href="#特殊属性" class="headerlink" title="特殊属性"></a>特殊属性</h4><p>增加了外键ForeignKey后，Django会对一端和多端增加一些新的类属性，查看类属性就可以看到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(*Employee.__dict__.items(), sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#一端，Employee类中多了一个类属性</span></span><br><span class="line"><span class="comment">#('salary_set', &lt;django.db.models.fields.related_descriptors.ReverseManyToOneDescriptor object at 0x000001303FB09B38&gt;)</span></span><br><span class="line"></span><br><span class="line">print(*Salary.__dict__.items(), sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#多端，Salary类中也多了一个类属性</span></span><br><span class="line"><span class="comment">#('emp_no_id', &lt;django.db.models.query_utils.DeferredAttribute object at 0x000001303FB09828&gt;)</span></span><br><span class="line"><span class="comment">#('emp_no', &lt;django.db.models.fields.related_descriptors.ForwardManyToOneDescriptor object at 0x000001303FB09860&gt;) 指向Employee类的一个实例</span></span><br></pre></td></tr></table></figure>

<p>从一端往多端查 <Employee_instance>.salary_set </p>
<p>从多端往一端查 <Salary_instance>.emp_no</p>
<h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">empmgr = Employee.objects</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询10004员工所有工资</span></span><br><span class="line"><span class="comment">#方案一、从员工往工资查</span></span><br><span class="line"><span class="comment">#print(mgr.filter(pk=10004).salary_set) # 错误，filter返回查询集，应该是员工对象 上调用xxx_set</span></span><br><span class="line"></span><br><span class="line">print(empmgr.get(pk=<span class="number">10004</span>).salary_set.all())</span><br><span class="line"><span class="comment">#SELECT `salaries`.`id`, `salaries`.`emp_no`, `salaries`.`from_date`,</span></span><br><span class="line">`salaries`.`salary`, `salaries`.`to_date` FROM `salaries` WHERE</span><br><span class="line">`salaries`.`emp_no` = <span class="number">10004</span>  LIMIT <span class="number">21</span>; args=(<span class="number">10004</span>,)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 特别注意查询语句和返回的对象</span></span><br></pre></td></tr></table></figure>

<p>如果觉得salary_set不好用，可以使用<strong>related_name</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Salary</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    emp_no = models.ForeignKey(<span class="string">'Employee'</span>, on_delete=models.CASCADE,</span><br><span class="line">null=<span class="literal">False</span>, db_column=<span class="string">'emp_no'</span>, related_name=<span class="string">'salaries'</span>)</span><br><span class="line">    </span><br><span class="line">print(empmgr.get(pk=<span class="number">10004</span>).salaries.all())</span><br><span class="line"></span><br><span class="line">empmgr = Employee.objects</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询10004员工所有工资</span></span><br><span class="line"><span class="comment">#方案一、从员工表查</span></span><br><span class="line">emp = empmgr.get(pk=<span class="number">10004</span>) <span class="comment"># 单一员工对象</span></span><br><span class="line">print(emp.salaries.all())</span><br><span class="line">print(emp.salaries.values(<span class="string">'emp_no'</span>, <span class="string">'from_date'</span>, <span class="string">'salary'</span>)) <span class="comment"># 投影 # 工资大于55000</span></span><br><span class="line">print(emp.salaries.filter(salary__gt=<span class="number">55000</span>).all())</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询10004员工所有工资及姓名</span></span><br><span class="line"><span class="comment">#方案二、从工资往员工查</span></span><br><span class="line">slist = list(salmgr.filter(emp_no=<span class="number">10004</span>)).filter(salary__gt=<span class="number">55000</span>) <span class="keyword">for</span> s <span class="keyword">in</span> slist:</span><br><span class="line">print(s.emp_no.name, s.emp_no_id, s.salary) <span class="comment"># s.emp_no会引发填充对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############## 特别注意 ##############</span></span><br><span class="line">这种查询会导致列表中的n个Salary实例填充其中emp_no属性，会查n此数据库</span><br><span class="line">所以，从salaries表往employees表查不合适，虽然可以改进，但是还是别扭，用的少</span><br></pre></td></tr></table></figure>

<p><strong>distinct</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#所有发了工资的员工 </span></span><br><span class="line">print(salarymgr.values(<span class="string">'emp_no'</span>).distinct())</span><br><span class="line"></span><br><span class="line"><span class="comment">#工资大于55000的所有员工的姓名</span></span><br><span class="line">emps = salarymgr.filter(salary__gt=<span class="number">55000</span>).values(<span class="string">'emp_no'</span>).distinct() print(type(emps))</span><br><span class="line">print(emps)</span><br><span class="line"></span><br><span class="line"><span class="comment">#in操作</span></span><br><span class="line">print(empmgr.filter(emp_no__in=[d.get(<span class="string">'emp_no'</span>) <span class="keyword">for</span> d <span class="keyword">in</span> emps])) </span><br><span class="line"></span><br><span class="line"><span class="comment">#in列表 </span></span><br><span class="line">print(empmgr.filter(emp_no__in=map(<span class="keyword">lambda</span> x:x.get(<span class="string">'emp_no'</span>), emps))) <span class="comment"># 同上</span></span><br><span class="line">print(empmgr.filter(emp_no__in=emps)) <span class="comment"># in子查询</span></span><br></pre></td></tr></table></figure>

<h4 id="raw的使用"><a href="#raw的使用" class="headerlink" title="raw的使用"></a>raw的使用</h4><p>如果查询非常复杂，使用Django不方便，可以直接使用SQL语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">empmgr = Employee.objects</span><br><span class="line"></span><br><span class="line"><span class="comment">#工资大于55000的所有员工的姓名 </span></span><br><span class="line">sql = <span class="string">"""\</span></span><br><span class="line"><span class="string">SELECT DISTINCT e.emp_no, e.first_name, e.last_name</span></span><br><span class="line"><span class="string">FROM employees e JOIN salaries s</span></span><br><span class="line"><span class="string">ON e.emp_no=s.emp_no</span></span><br><span class="line"><span class="string">WHERE s.salary &gt; 55000</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DISTINCT 需要，结果会去重</span></span><br><span class="line">emps = empmgr.raw(sql) print(type(emps)) <span class="comment"># RawQuerySet print(list(emps))</span></span><br><span class="line">[&lt;Employee: <span class="number">10001</span> Georgi Facello&gt;, &lt;Employee: <span class="number">10002</span> Bezalel Simmel&gt;,&lt;Employee: <span class="number">10004</span> Chirstian Koblick&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment">#员工工资记录里超过70000的人的工资和姓名</span></span><br><span class="line">sql = <span class="string">"""\</span></span><br><span class="line"><span class="string">select e.emp_no, e.first_name, e.last_name, s.salary from employees e join salaries s</span></span><br><span class="line"><span class="string">on e.emp_no = s.emp_no</span></span><br><span class="line"><span class="string">where s.salary &gt; 70000</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> empmgr.raw(sql):</span><br><span class="line">		print(x.__dict__) <span class="comment"># 将salary属性注入到当前Employee实例中 </span></span><br><span class="line">    print(x.name, x.salary)</span><br><span class="line">		<span class="comment">#print(x.gender) # 因为sql中没有投影gender，这条语句会触发查询</span></span><br></pre></td></tr></table></figure>

<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `departments` (</span><br><span class="line">  `dept_no` char(<span class="number">4</span>) NOT NULL,</span><br><span class="line">  `dept_name` varchar(<span class="number">40</span>) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`dept_no`),</span><br><span class="line">  UNIQUE KEY `dept_name` (`dept_name`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `dept_emp` (</span><br><span class="line">  `emp_no` int(<span class="number">11</span>) NOT NULL,</span><br><span class="line">  `dept_no` char(<span class="number">4</span>) NOT NULL,</span><br><span class="line">  `from_date` date NOT NULL,</span><br><span class="line">  `to_date` date NOT NULL,</span><br><span class="line">  PRIMARY KEY (`emp_no`,`dept_no`),</span><br><span class="line">  KEY `dept_no` (`dept_no`),</span><br><span class="line">  CONSTRAINT `dept_emp_ibfk_1` FOREIGN KEY (`emp_no`) REFERENCES `employees`</span><br><span class="line">(`emp_no`) ON DELETE CASCADE,</span><br><span class="line">  CONSTRAINT `dept_emp_ibfk_2` FOREIGN KEY (`dept_no`) REFERENCES</span><br><span class="line">`departments` (`dept_no`) ON DELETE CASCADE</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>

<p>联合主键问题依然存在，所以做法同上。修改dept_emp表，增加id自增主键。 </p>
<p><font color="red"><strong>注意:这种主键的修改在设计表的阶段就应该考虑好，而不是事后修改。我们这里是故意造成这种现象来说明问题。</strong></font></p>
<h4 id="构建模型"><a href="#构建模型" class="headerlink" title="构建模型"></a>构建模型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment">#Employee同上</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'departments'</span></span><br><span class="line">        </span><br><span class="line">    dept_no = models.CharField(primary_key=<span class="literal">True</span>, max_length=<span class="number">4</span>)</span><br><span class="line">    dept_name = models.CharField(max_length=<span class="number">40</span>, null=<span class="literal">False</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;Department: &#123;&#125; &#123;&#125;&gt;"</span>.format(</span><br><span class="line">            self.dept_no, self.dept_name)</span><br><span class="line">        </span><br><span class="line">    __str__ = __repr__</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dept_emp</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.AutoField(primary_key=<span class="literal">True</span>) <span class="comment"># 新增自增主键，解决不支持联合主键问题 </span></span><br><span class="line">    emp_no = models.ForeignKey(</span><br><span class="line">      	to=<span class="string">'Employee'</span>, </span><br><span class="line">      	on_delete=models.CASCADE,</span><br><span class="line">    		db_column=<span class="string">'emp_no'</span></span><br><span class="line">    ) </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#写模块.类名，当前模块写类名 </span></span><br><span class="line">    dept_no = models.ForeignKey(to=<span class="string">'Department'</span>, </span><br><span class="line">                                on_delete=models.CASCADE,</span><br><span class="line">    														max_length=<span class="number">4</span>,</span><br><span class="line">    														db_column=<span class="string">'dept_no'</span></span><br><span class="line">                               )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#django会给外键字段自动加后缀_id，如果不需要加这个后缀，用db_column指定</span></span><br><span class="line">    from_date = models.DateField(null=<span class="literal">False</span>)</span><br><span class="line">    to_date = models.DateField(null=<span class="literal">False</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'dept_emp'</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;DeptEmp: &#123;&#125; &#123;&#125;&gt;"</span>.format(self.emp_no, self.dept_no)</span><br><span class="line">      </span><br><span class="line">    __str__ = __repr__</span><br><span class="line">    </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line">os.environ.setdefault(<span class="string">'DJANGO_SETTINGS_MODULE'</span>, <span class="string">'salary.settings'</span>)</span><br><span class="line">django.setup()</span><br><span class="line"><span class="keyword">from</span> employee.models <span class="keyword">import</span> Employee, Department</span><br><span class="line"></span><br><span class="line">empmgr = Employee.objects</span><br><span class="line">deptmgr = Department.objects</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询10010员工的所在的部门编号及员工信息</span></span><br><span class="line">emp = empmgr.filter(pk=<span class="number">10010</span>).get() <span class="comment"># 只查employees print('-' * 30)</span></span><br><span class="line">depts = emp.dept_emp_set.all() <span class="comment"># 懒查</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> depts: <span class="comment"># 查dept_emp中的2个部门，然后再查departments 2次</span></span><br><span class="line">    print(type(x), x) <span class="comment">#</span></span><br><span class="line">    e = x.emp_no <span class="comment">#</span></span><br><span class="line">    print(type(e), e)</span><br><span class="line">    d = x.dept_no <span class="comment">#</span></span><br><span class="line">    print(type(d), d)</span><br><span class="line">    print(e.emp_no, e.name, d.dept_no, d.dept_name)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Q：如何通过员工直接查部门信息呢?</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">     db_table = <span class="string">"departments"</span></span><br><span class="line"></span><br><span class="line"> dept_no = models.CharField(max_length=<span class="number">4</span>, primary_key=<span class="literal">True</span>)</span><br><span class="line"> dept_name = models.CharField(max_length=<span class="number">40</span>, unique=<span class="literal">True</span>)</span><br><span class="line"> emps = models.ManyToManyField(Employee, through=<span class="string">"Dept_emp"</span>)</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"&lt;D &#123;&#125;, &#123;&#125;&gt;"</span>.format(self.pk, self.dept_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line">os.environ.setdefault(<span class="string">'DJANGO_SETTINGS_MODULE'</span>, <span class="string">'salary.settings'</span>)</span><br><span class="line">django.setup(set_prefix=<span class="literal">False</span>)</span><br><span class="line"><span class="comment">#####################################</span></span><br><span class="line"><span class="keyword">from</span> employee.models <span class="keyword">import</span> Employee, Salary, Department, Dept_emp</span><br><span class="line"></span><br><span class="line">emgr = Employee.objects</span><br><span class="line">dmgr = Department.objects</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10010员工所在部门和员工信息</span></span><br><span class="line">emp = emgr.get(pk=<span class="number">10010</span>)</span><br><span class="line"><span class="comment"># print(Employee.__dict__.items(), sep='\n') emp = emgr.get(pk=10010)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> emp.department_set.all():</span><br><span class="line">		print(d)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="迁移-1"><a href="#迁移-1" class="headerlink" title="迁移"></a>迁移</h3><p>如果建立好模型类，想从这些类来生成数据库的表，使用下面语句。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为未迁移的生成迁移文件</span></span><br><span class="line">$ python manage.py makemigrations  <span class="comment">#为未迁移的迁移</span></span><br><span class="line">$ python manage.py migrate</span><br><span class="line"></span><br><span class="line"><span class="comment">#为指定应用employee做迁移</span></span><br><span class="line">$ python manage.py migrate employee</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>在开发中，一般都会采用ORM框架，这样就可以使用对象操作表了。 Django中，定义表映射的类，继承自Model类。Model类使用了元编程，改变了元类。 使用Field实例作为类属性来描述字段。<br> 使用ForeignKey来定义外键约束。</p>
<p>是否使用外键约束?</p>
<ol>
<li>力挺派 能使数据保证完整性一致性</li>
<li>弃用派 开发难度增加，大量数据的时候影响插入、修改、删除的效率。 在业务层保证数据的一致性。</li>
</ol>
<h2 id="后台管理"><a href="#后台管理" class="headerlink" title="后台管理"></a>后台管理</h2><h3 id="站点管理"><a href="#站点管理" class="headerlink" title="站点管理"></a>站点管理</h3><p>如果要使用Django，必须提供一个管理员用户，目前用户表auth_user表没有记录。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py createsuperuser</span><br><span class="line">$ python manage.py runserver</span><br></pre></td></tr></table></figure>

<p>浏览器中访问 <a href="http://127.0.0.1:8000/admin/" target="_blank" rel="noopener">http://127.0.0.1:8000/admin/</a> 即可看到登录界面。</p>
<p>登录后，并没有看到自己建立的Model类对应的表。这是因为有2步必须做 </p>
<h3 id="1-注册应用"><a href="#1-注册应用" class="headerlink" title="1.注册应用"></a>1.注册应用</h3><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230207140449963.png" alt="image-20230207140449963"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'employee'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="2-注册Model类"><a href="#2-注册Model类" class="headerlink" title="2.注册Model类"></a>2.注册Model类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Employee, Department</span><br><span class="line"></span><br><span class="line">admin.site.register(Employee)</span><br><span class="line">admin.site.register(Department)</span><br></pre></td></tr></table></figure>

<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>按照WSGI原理代码，所有请求都交给一个app处理，如何做到不同请求对应不同的处理? 最简单的方式就是，进入app后，不同的URL做不同的处理。也就是，建立URL和处理函数之间的映射。 </p>
<p><strong>路由</strong>：根据访问的路径Path不同调度不同的处理函数。可以对路径Path采用模式匹配。</p>
<p>Django 3.x使用path、re_path定义，这和2.x略有区别。</p>
<h3 id="主路由"><a href="#主路由" class="headerlink" title="主路由"></a>主路由</h3><p>path参考：<a href="https://docs.djangoproject.com/en/3.2/topics/http/urls/#example" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/topics/http/urls/#example</a> 主目录中的urls.py是路径匹配的入口，它定义在 settings.py 中 ROOT_URLCONF = ‘salary.urls’ 。 约定，称主目录中的路由配置文件urls.py为 主路由 或 一级路由</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了测试方便，写了这个path_test视图函数，以后不要写在这里 def path_test(request, *args, **kwargs):</span></span><br><span class="line">    print(<span class="string">'='</span> * <span class="number">30</span>)</span><br><span class="line">    print(request)</span><br><span class="line">    print(<span class="string">'args'</span>, [(type(x), x) <span class="keyword">for</span> x <span class="keyword">in</span> args])</span><br><span class="line">    print(<span class="string">'kwargs'</span>, [(type(k),k, type(v),v) <span class="keyword">for</span> k,v <span class="keyword">in</span> kwargs.items()])</span><br><span class="line">    print(<span class="string">'='</span> * <span class="number">30</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse()</span><br><span class="line">  </span><br><span class="line"><span class="comment"># urlpatterns是一个列表，匹配从上往下，匹配上了就不会继续向下匹配 </span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">'test/&lt;course&gt;/&lt;year&gt;/'</span>, path_test), <span class="comment"># 使用缺省转换器 </span></span><br><span class="line">  	path(<span class="string">'test/&lt;str:course&gt;/&lt;int:year&gt;/'</span>, path_test), <span class="comment"># 指定转换器类型</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>路径转换器</p>
<ul>
<li><p>str：匹配任一非空字符串，但不能匹配路径分隔符 / ，这是缺省转换器 </p>
</li>
<li><p>int：匹配0或任一正整数，并转换为ints</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">URL</th>
<th align="center">path模式</th>
<th align="center">参数解析</th>
</tr>
</thead>
<tbody><tr>
<td align="center">/test/python/2008<br>/test/python/2008/</td>
<td align="center">test/<course>/<year>/</td>
<td align="center">默认转换器类型为str [‘course’, &lt;class ‘str’&gt;, ‘python’]<br> [‘year’, &lt;class ‘str’&gt;, ‘2008’]</td>
</tr>
<tr>
<td align="center">/test/python/2008<br>/test/python/2008/</td>
<td align="center">test/<a href="str:course">str:course</a>/<a href="int:year">int:year</a>/</td>
<td align="center">[‘course’, &lt;class ‘str’&gt;, ‘python’]<br> [‘year’, &lt;class ‘int’&gt;, 2008]</td>
</tr>
</tbody></table>
<p>从测试结果看，如果和匹配上了，采用的是<strong>关键字传参</strong>。</p>
<table>
<thead>
<tr>
<th align="center">URL</th>
<th align="center">path模式</th>
<th align="center"></th>
</tr>
</thead>
<tbody><tr>
<td align="center">/test/python/2008</td>
<td align="center">test/<course>/<year></td>
<td align="center">匹配</td>
</tr>
<tr>
<td align="center">/test/python/2008</td>
<td align="center">test/<course>/<year></td>
<td align="center">失败</td>
</tr>
<tr>
<td align="center">/test/python/2008</td>
<td align="center">test/<course>/<year></td>
<td align="center">301跳转到/test/python/2008/</td>
</tr>
<tr>
<td align="center">/test/python/2008</td>
<td align="center">test/<course>/<year></td>
<td align="center">匹配</td>
</tr>
</tbody></table>
<p>由于之后所有的链接都是程序中提取写好的，所以，一定可以保证程序员写的URL是正确的。建议，定 义path模式时，使用 xxx/ ，以斜杠 “/“ 结尾。在Django官网例子中就是这样定义的。</p>
<p>re_path 支持正则表达式，参考 <a href="https://docs.djangoproject.com/en/3.2/topics/http/urls/#using-regular-expressions" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/topics/http/urls/#using-regular-expressions</a></p>
<h3 id="二级路由"><a href="#二级路由" class="headerlink" title="二级路由"></a>二级路由</h3><p>如果所有路由都定义在主路由文件中，太乱太臃肿，解决的办法就是二级路由，即路由到应用的路有文 件。但是脚手架建立的应用文件中缺少urls.py，手动在应用目录建立一个。</p>
<p>1.主路由文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">'emp/'</span>, include(<span class="string">'employee.urls'</span>)), <span class="comment"># 指向应用路由文件</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>2.应用路由文件 在employee目录下新建urls.py。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> .views <span class="keyword">import</span> test_index</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, test_index), <span class="comment"># 二级路由包含前缀emp/，对应URL是/emp/</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>在employee/view.py中增加index视图函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpRequest, HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_index</span><span class="params">(request:HttpRequest)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">b'magedu.com'</span>)</span><br></pre></td></tr></table></figure>

<p>访问 <a href="http://127.0.0.1:8000/emp/" target="_blank" rel="noopener">http://127.0.0.1:8000/emp/</a> 即可。</p>
<h2 id="Django模板"><a href="#Django模板" class="headerlink" title="Django模板"></a>Django模板</h2><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>用户通过浏览器访问的目的是为了看到数据嵌在网页中，也就是说给浏览器提供一个网页HTML即可。 网页内容分为:</p>
<ul>
<li><p>静态内容:存储在服务器端文件系统里，这些文件持久不变。例如，HTML、CSS、JS文件 </p>
</li>
<li><p>动态内容:通过 URL 映射到函数，动态生成内容</p>
<ul>
<li>所有内容字符串，完全由代码生成。由于全部是代码生成，包括其中的 HTML 部分，实际上就 是在做字符串拼接，如果修改HTML，将非常痛苦。显示和数据代码耦合在一起，非常不好 </li>
<li>读取一个 HTML 文件的内容，替换其中部分字符串。管显示的 HTML 是一个单独的文件(模 板)，生成数据的代码是一个独立的函数，写在单独的py文件中，只是将HTML内容发给用户 前做字符串替换即可。好处是，显示和数据代码分离</li>
</ul>
</li>
</ul>
<p>生成环境中，会对静态、动态的内容的访问进行区别对待，这就是 <strong>动静分离</strong> 。</p>
<h3 id="模板配置"><a href="#模板配置" class="headerlink" title="模板配置"></a>模板配置</h3><p>参考：<a href="https://docs.djangoproject.com/en/3.2/topics/templates/#configuration" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/topics/templates/#configuration</a> 在主配置文件 settings.py 中 TEMPLATES</p>
<ul>
<li>DIRS：依次搜索模板的目录列表</li>
<li><code>BASE_DIR / &#39;templates&#39;</code> 表示项目根目录下templates目录</li>
</ul>
<p>APP_DIRS：布尔值。告诉引擎是否在 INSTALLED_APPS 中应用目录中搜索模板。 </p>
<ul>
<li>True表示 <strong>DjangoTemplates</strong> 引擎会在每一个应用目录下的templates目录中搜索模板</li>
</ul>
<p>公共模板路径可以配置在DIRS列表中，应用自己使用的模板定义在应用目录下的templates目录中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="comment">#Build paths inside the project like this: BASE_DIR / 'subdir'.</span></span><br><span class="line">BASE_DIR = Path(__file__).resolve().parent.parent</span><br><span class="line"></span><br><span class="line">TEMPLATES = [</span><br><span class="line">		&#123;</span><br><span class="line">				<span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.django.DjangoTemplates'</span>,</span><br><span class="line">        <span class="string">'DIRS'</span>: [BASE_DIR / <span class="string">'templates'</span>],</span><br><span class="line">        <span class="string">'APP_DIRS'</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">        		<span class="string">'context_processors'</span>: [</span><br><span class="line">                <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">                <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">                <span class="string">'django.contrib.auth.context_processors.auth'</span>,</span><br><span class="line">                <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line">						 ],</span><br><span class="line">        &#125;,</span><br><span class="line">		&#125;, </span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>在项目根目录下创建 templates 目录，存放模板文件。</p>
<h3 id="模板渲染"><a href="#模板渲染" class="headerlink" title="模板渲染"></a>模板渲染</h3><h4 id="模板页"><a href="#模板页" class="headerlink" title="模板页"></a>模板页</h4><p>templates/index.html</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="selector-tag">DOCTYPE</span> <span class="selector-tag">html</span>&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;<span class="selector-tag">head</span>&gt;</span><br><span class="line">    &lt;meta charset="UTF-8"&gt;</span><br><span class="line">		&lt;title&gt;马哥教育Django首页&lt;/title&gt; </span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">		我是模板页，数据&#123;&#123;content&#125;&#125; </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="模板处理"><a href="#模板处理" class="headerlink" title="模板处理"></a>模板处理</h4><p>模板处理的2个步骤</p>
<ol>
<li><p>加载模板文件，读取文件内容</p>
</li>
<li><p>渲染，替换内容中占位符，返回最终的字符串 </p>
</li>
</ol>
<h4 id="render-函数"><a href="#render-函数" class="headerlink" title="render 函数"></a>render 函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render(request, template_name, context=<span class="literal">None</span>, content_type=<span class="literal">None</span>, status=<span class="literal">None</span>,using=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>template_name模板名 </li>
<li>context渲染用上下文字典 </li>
<li>status响应报文的状态码 </li>
<li>返回HttpResponse对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpRequest, HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_index</span><span class="params">(request:HttpRequest)</span>:</span></span><br><span class="line">    context = &#123;<span class="string">'test'</span>:<span class="string">'测试字符串'</span>&#125;</span><br><span class="line">    content = render(request, <span class="string">'index.html'</span>, context) </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> HttpResponse(content)</span><br></pre></td></tr></table></figure>

<h3 id="DTL语法"><a href="#DTL语法" class="headerlink" title="DTL语法"></a>DTL语法</h3><p>Django的模板引擎默认使用Django template language (DTL)构建。</p>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>变量名由字母、数字、下划线、点号组成。 </p>
<p>点号使用的时候，例如foo.bar，遵循以下顺序:</p>
<ol>
<li>字典查找，例如 foo[“bar”]，把 foo 当做字典，bar 当做 key</li>
<li>属性或方法的查找，例如 foo.bar，把 foo 当做对象，bar 当做属性或方法 </li>
<li>数字索引查找，例如 foo[bar]，把 foo 当做列表一样，使用索引访问</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request:HttpRequest)</span>:</span> </span><br><span class="line">  <span class="string">"""视图函数:请求进来返回响应"""</span> </span><br><span class="line">  mydict = &#123;</span><br><span class="line">        <span class="string">'a'</span>:<span class="number">100</span>,</span><br><span class="line">        <span class="string">'b'</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="string">'c'</span>:list(range(<span class="number">10</span>,<span class="number">20</span>)),</span><br><span class="line">        <span class="string">'d'</span>:<span class="string">'abc'</span>,</span><br><span class="line">        <span class="string">'date'</span>:datetime.datetime.now()</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    context = &#123;<span class="string">'content'</span>:<span class="string">'www.magedu.com'</span>, <span class="string">'mydict'</span>:mydict&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, context)</span><br></pre></td></tr></table></figure>

<p>如果<strong>变量未能找到，则缺省插入空字符串</strong><br>在模板中调用方法，<strong>不能加小括号</strong>，自然也不能传递参数。</p>
 

{{ mydict.a }}符合第一条，当做字典的key就可以访问到了
{{ mydict.keys }} 这样是对的，不能写成{{ mydict.keys() }}。符合第二条，当做mydict对象的属性或方法。
{{ mydict.c.0 }} 符合第三条。



<h4 id="模板标签"><a href="#模板标签" class="headerlink" title="模板标签"></a>模板标签</h4> 

标签采用{% tag %}语法。

 

<p>if/else 标签 基本语法格式如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> condition %&#125;</span><br><span class="line">		... display</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">if</span> condition1 %&#125;</span><br><span class="line">   ... display <span class="number">1</span></span><br><span class="line">&#123;% <span class="keyword">elif</span> condition2 %&#125;</span><br><span class="line">   ... display <span class="number">2</span></span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">   ... display <span class="number">3</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>条件也支持and、or、not 注意，因为这些标签是断开的，所以不能像Python一样使用缩进就可以表示出来，必须有个结束标签， 例如endif、endfor。</p>
<p>for 标签：<a href="https://docs.djangoproject.com/en/2.0/ref/templates/builtins/#for" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.0/ref/templates/builtins/#for</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> athlete <span class="keyword">in</span> athlete_list %&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123; athlete.name &#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&#123;%  <span class="keyword">for</span> person  <span class="keyword">in</span>  person_list %&#125;</span><br><span class="line">&lt;li&gt;&#123;&#123;  person.name &#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;%  endfor  %&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">变量</th>
<th align="center"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">forloop.counter</td>
<td align="center">当前循环从1开始的计数</td>
</tr>
<tr>
<td align="center">forloop.counter0</td>
<td align="center">当前循环从0开始的计数</td>
</tr>
<tr>
<td align="center">forloop.revcounter</td>
<td align="center">从循环的末尾开始倒计数到1</td>
</tr>
<tr>
<td align="center">forloop.revcounter0</td>
<td align="center">从循环的末尾开始到计数到0</td>
</tr>
<tr>
<td align="center">forloop.first</td>
<td align="center">第一次进入循环</td>
</tr>
<tr>
<td align="center">forloop.last</td>
<td align="center">最后一次进入循环</td>
</tr>
<tr>
<td align="center">forloop.parentloop</td>
<td align="center">循环嵌套时，内层当前循环的外层循环</td>
</tr>
</tbody></table>
<p>给标签增加一个 reversed 使得该列表被反向迭代:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> athlete <span class="keyword">in</span> athlete_list reversed %&#125; </span><br><span class="line">...</span><br><span class="line">&#123;% empty %&#125;</span><br><span class="line"><span class="meta">... </span>如果被迭代的列表是空的或者不存在，执行empty </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

 

可以嵌套使用 {% for %} 标签:

 

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> athlete <span class="keyword">in</span> athlete_list %&#125;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; athlete.name &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> sport <span class="keyword">in</span> athlete.sports_played %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; sport &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>Pycharm模板定义</p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230207145254901.png" alt="image-20230207145254901"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230207144927020.png" alt="image-20230207144927020"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230207145838594.png" alt="image-20230207145838594"></p>
<p>按照上述方法可以定义诸多Django模板标签。 </p>
<p>testfor.html模板</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">		&lt;title&gt;测试for&lt;/title&gt; </span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">字典是dict(zip(<span class="string">'abced'</span>, range(<span class="number">1</span>,<span class="number">6</span>))) </span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> k,v <span class="keyword">in</span> dct.items %&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123;forloop.counter&#125;&#125; &#123;&#123;k&#125;&#125; &#123;&#123;v&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt; </span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> k,v <span class="keyword">in</span> dct.items %&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123;forloop.counter0&#125;&#125; &#123;&#123;k&#125;&#125; &#123;&#123;v&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt; </span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> k,v <span class="keyword">in</span> dct.items %&#125;</span><br><span class="line">    &#123;&#123; forloop.first &#125;&#125;</span><br><span class="line">    &#123;&#123; forloop.last &#125;&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123;forloop.revcounter0&#125;&#125; &#123;&#123;k&#125;&#125; &#123;&#123;v&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt; </span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> k,v <span class="keyword">in</span> dct.items %&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123;forloop.revcounter&#125;&#125; &#123;&#123;k&#125;&#125; &#123;&#123;v&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt; </span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



ifequal/ifnotequal 标签
{% ifequal %} 标签比较两个值，当他们相等时，显示在 {% ifequal %} 和 {% endifequal %} 之中所有的 值。
下面的例子比较两个模板变量 user 和 currentuser :



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ifequal user currentuser %&#125;</span><br><span class="line">    &lt;h1&gt;Welcome!&lt;/h1&gt;</span><br><span class="line">&#123;% endifequal %&#125;</span><br></pre></td></tr></table></figure>



和 {% if %} 类似， {% ifequal %} 支持可选的 {% else%} 标签:



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ifequal section <span class="string">'sitenews'</span> %&#125;</span><br><span class="line">    &lt;h1&gt;Site News&lt;/h1&gt;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">    &lt;h1&gt;No News Here&lt;/h1&gt;</span><br><span class="line">&#123;% endifequal %&#125;</span><br></pre></td></tr></table></figure>



其他标签
csrf_token 用于跨站请求伪造保护，防止跨站攻击的。

{% csrf_token %}

#### 注释标签

单行注释 {# #}。

多行注释 {% comment %} ... {% endcomment %}.



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment"># 这是一个注释 #&#125;</span></span><br><span class="line">  </span><br><span class="line">&#123;% comment %&#125; 这是多行注释</span><br><span class="line">&#123;% endcomment %&#125;.</span><br></pre></td></tr></table></figure>

<h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><p>模板过滤器可以在变量被显示前修改它。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line">&#123;&#123; 变量|过滤器 &#125;&#125;</span><br><span class="line">过滤器使用管道字符 | ，例如 &#123;&#123; name|lower &#125;&#125;， &#123;&#123; name &#125;&#125; 变量被过滤器 lower 处理后，文档大写转换文本为小写。</span><br><span class="line">过滤管道可以被套接，一个过滤器管道的输出又可以作为下一个管道的输入。例如 &#123;&#123; my_list|first|upper &#125;&#125;，将列表第一个元素并将其转化为大写。</span><br></pre></td></tr></table></figure>



**过滤器传参**

有些过滤器可以传递参数，过滤器的参数跟随冒号之后并且总是以双引号包含。

例如：{{ bio|truncatwords:"30" }}，截取显示变量 bio 的前30个词。 {{ my_list|join:"," }}，将my_list的所有元素使用,逗号连接起来





其他过滤器

|     过滤器      |                             说明                             |                             举例                             |
| :-------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|       cut       |                    切掉字符串中的指定字符                    |                         {{ value }}                          |
|      lower      |                          转换为小写                          |                                                              |
|      upper      |                          转换为大写                          |                                                              |
|  truncatewords  |                    保留指定个数的**单词**                    |                {{ bio \| truncatwords:"30" }}                |
|      join       |                          对序列拼接                          |                    {{ d.e \| join:"//" }}                    |
|      first      |                       取序列第一个元素                       |                                                              |
|      last       |                        取序列最后元素                        |                                                              |
|  <br><br>yesno  | 变量可以是True、False、None yesno的参数给定逗号分隔的三个值，返回3个值中的一个。<br> True对应第一个<br> False对应第二个<br> None对应第三个 如果参数只有2个，None等效False处理 |            {{ value \|  yesno:"yeah,no,maybe" }}             |
|       add       |                   加法。参数是负数就是减法                   | 数字加{{ value \| add:"100" }}<br>列表合并{{ mylist \| add:newlist }} |
|   divisibleby   |                          能否被整除                          |      {{ value \| divisibleby:"3" }} 能被3整 除返回True       |
|   addslashes    |           在反斜杠、单引号或者双引号前面加上反斜杠           |                  {{ value \| addslashes }}                   |
|     length      |                        返回变量的长度                        |                {% if my_list \| ength > 1 %}                 |
|     default     |                  变量等价False则使用缺省值                   |               {{ value \| default:"nothing" }}               |
| default_if_none |                     变量为None使用缺省值                     |           {{ value \| default_if_none:"nothing" }}           |
|  <br><br>date   |            <br><br>格式化 date 或者 datetime 对象            | Y 2000 年<br> m 01~12 月<br> d 01~31 日<br> y 20年<br> n 1~12 月<br> j 1~31 日 |



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; mydict.d.upper &#125;&#125; 调用字符串对象upper函数</span><br><span class="line">&#123;&#123; mydict.d|upper &#125;&#125; 字符串通过过滤器upper转成大写</span><br><span class="line">&#123;&#123; mydict.d<span class="number">.0</span> &#125;&#125; &#123;&#123; mydict.d|first &#125;&#125; <span class="number">0</span>表示[<span class="number">0</span>]，first是过滤器 &#123;&#123; mydict.d|join:<span class="string">','</span> &#125;&#125;</span><br><span class="line">&#123;&#123; mydict.b|yesno:<span class="string">'nonzero,zero'</span> &#125;&#125;</span><br><span class="line">&#123;&#123; mydict.a|add:<span class="string">'11'</span> &#125;&#125;</span><br><span class="line">&#123;&#123; mydict.a|add:mydict.a &#125;&#125;</span><br><span class="line">&#123;&#123; mydict.a|add:<span class="string">'11'</span>|divisibleby:<span class="number">3</span> &#125;&#125;</span><br><span class="line">&#123;&#123; mydict.a|divisibleby:<span class="number">3</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; mydict.c|length &#125;&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> mydict.c|length &gt; <span class="number">50</span> %&#125;</span><br><span class="line">&#123;&#123; mydict.c &#125;&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;&#123; mydict.date|date:<span class="string">'Y-n-j Y-m-d'</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>时间的格式字符查看：<a href="https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#date" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#date</a></p>
<p>过滤器参考：<a href="https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#</a></p>
<h3 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h3><p>使用模板不免用到静态文件，如何引入静态文件呢?<br>首先看看静态配置是什么?提供一个视图函数，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_index</span><span class="params">(request)</span>:</span></span><br><span class="line">    print(<span class="string">'~'</span> * <span class="number">30</span>)</span><br><span class="line">    </span><br><span class="line">    static_info = list(filter(<span class="keyword">lambda</span> x: x.find(<span class="string">'STATIC'</span>)!=<span class="number">-1</span>, dir(settings)))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> static_info:</span><br><span class="line">        print(x, getattr(settings, x))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'~'</span> * <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'users'</span>:[<span class="number">1</span>, <span class="number">2</span>, <span class="string">'a'</span>, <span class="string">'b'</span>]&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">STATICFILES_DIRS []</span><br><span class="line">STATICFILES_FINDERS [<span class="string">'django.contrib.staticfiles.finders.FileSystemFinder'</span>,</span><br><span class="line"><span class="string">'django.contrib.staticfiles.finders.AppDirectoriesFinder'</span>]</span><br><span class="line">STATICFILES_STORAGE django.contrib.staticfiles.storage.StaticFilesStorage</span><br><span class="line">STATIC_ROOT <span class="literal">None</span></span><br><span class="line">STATIC_URL /static/</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br></pre></td></tr></table></figure>

<p>官方参考：<a href="https://docs.djangoproject.com/en/3.2/ref/settings/#settings-staticfiles" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/ref/settings/#settings-staticfiles</a> </p>
<p>Django 的静态需要在 settings.py 中配置</p>
<ul>
<li>settings 中 INSTALLED_APPS 确保有 django.contrib.staticfiles </li>
<li>STATIC_URL = ‘/static/‘，URL访问的逻辑路径前缀 </li>
<li>STATICFILES_DIRS = []，静态文件搜索路径 </li>
<li>STATICFILES_FINDERS，搜索器</li>
</ul>
<p>django.contrib.staticfiles.finders.FileSystemFinder搜索STATICFILES_DIRS的目录 django.contrib.staticfiles.finders.AppDirectoriesFinder搜索每一个app下面的static子目录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    BASE_DIR / <span class="string">'static'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>模板中使用如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset="UTF-8"&gt; &lt;title&gt;马哥教育Django首页&lt;/title&gt; </span><br><span class="line">  	&#123;% load static %&#125;</span><br><span class="line">    &lt;!--  &lt;script src="/static/js/jquery-3.6.0.min.js"&gt;&lt;/script&gt;--&gt;</span><br><span class="line">    &lt;script src="&#123;% static 'js/jquery-3.6.0.min.js' %&#125;"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id="app"&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.djangoproject.com/en/3.2/ref/templates/builtins/#static" target="_blank" rel="noopener">https://docs.djangoproject.com/en/3.2/ref/templates/builtins/#static</a></p>
<p>js/jquery-3.6.0.min.js可以</p>
<ol>
<li><p>BASE_DIR 下 static 下的 js/jquery-3.6.0.min.js</p>
</li>
<li><p>BASE_DIR 下 employee 下 static 下的 js/jquery-3.6.0.min.js </p>
</li>
</ol>
<p>它们逻辑路径都是/static/js/jquery-3.6.0.min.js，搜索到匹配文件就立即返回，不在继续寻找。</p>
<h2 id="模板习题"><a href="#模板习题" class="headerlink" title="模板习题"></a>模板习题</h2><h3 id="奇偶行列表输出"><a href="#奇偶行列表输出" class="headerlink" title="奇偶行列表输出"></a>奇偶行列表输出</h3><p>使用下面字典my_dict的c的列表，在模板网页中列表ul输出多行数据</p>
<p>要求奇偶行颜色不同 每行有行号(从1开始) 列表中所有数据都增大100</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpRequest</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request:HttpRequest)</span>:</span> <span class="string">"""视图函数:请求进来返回响应"""</span> </span><br><span class="line">		my_dict = &#123;</span><br><span class="line">        <span class="string">'a'</span>:<span class="number">100</span>,</span><br><span class="line">        <span class="string">'b'</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="string">'c'</span>:list(range(<span class="number">10</span>,<span class="number">20</span>)),</span><br><span class="line">        <span class="string">'d'</span>:<span class="string">'abc'</span>, <span class="string">'date'</span>:datetime.datetime.now()</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    context = &#123;<span class="string">'content'</span>:<span class="string">'www.magedu.com'</span>, <span class="string">'my_dict'</span>:my_dict&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, context)</span><br></pre></td></tr></table></figure>

<p>模板代码如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;%<span class="keyword">for</span> line <span class="keyword">in</span> my_dict.c %&#125;</span><br><span class="line">    &lt;li style=<span class="string">'color:&#123;&#123;forloop.counter|divisibleby:"2"|yesno:"red,blue"&#125;&#125;'</span>&gt;</span><br><span class="line">        &#123;&#123;forloop.counter&#125;&#125; &#123;&#123;line|add:<span class="string">"100"</span>&#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">&#123;%endfor%&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<h3 id="打印九九方阵"><a href="#打印九九方阵" class="headerlink" title="打印九九方阵"></a>打印九九方阵</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>*<span class="number">1</span>=<span class="number">1</span> <span class="number">1</span>*<span class="number">2</span>=<span class="number">2</span> ... <span class="number">1</span>*<span class="number">9</span>=<span class="number">9</span></span><br><span class="line">...</span><br><span class="line"><span class="number">9</span>*<span class="number">1</span>=<span class="number">1</span> <span class="number">9</span>*<span class="number">2</span>=<span class="number">18.</span>.. <span class="number">9</span>*<span class="number">9</span>=<span class="number">81</span></span><br></pre></td></tr></table></figure>

<p>使用把上面所有的数学表达式放到HTML表格对应的格子中</p>
<p>方法一：由视图函数提供数据<br>为了简单，直接准备一个排好输出顺序的列表</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpRequest</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request:HttpRequest)</span>:</span></span><br><span class="line">    data = [<span class="string">'&#123;&#125;*&#123;&#125;=&#123;&#125;'</span>.format(j, i, j*i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10</span>) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10</span>)]</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'matrix.html'</span>, &#123;<span class="string">'data'</span>:data&#125;)</span><br><span class="line">  </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;九九方阵&lt;/title&gt; &lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> x <span class="keyword">in</span> data %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> forloop.counter0|divisibleby:<span class="number">9</span> %&#125;&lt;tr&gt;&#123;% endif %&#125;</span><br><span class="line">        &lt;td&gt;&#123;&#123;x&#125;&#125;&lt;/td&gt;</span><br><span class="line">    &#123;% if forloop.counter|divisibleby:9 %&#125;&lt;/tr&gt;&#123;% endif %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



方法二：内建标签 widthratio
 widthratio 本意是计算宽度比率的。
 widthratio 用法: {% widthratio value max_value max_width %}

举例

{% widthratio 175 200 100 %}

value是175，max_value是200，max_width是100。 因此，175/200=0.875得到数值比值，再利用比率计算出宽度0.875*100=87.5，四舍五入到88

{% widthratio i 1 j as product %} 别名就可以在后面引用这个变量product



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpRequest</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request:HttpRequest)</span>:</span></span><br><span class="line">    context = &#123;<span class="string">'loop'</span>:list(range(<span class="number">1</span>,<span class="number">10</span>))&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'matrix.html'</span>, context)</span><br></pre></td></tr></table></figure>

<p>matrix.html模板如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;九九方阵&lt;/title&gt; </span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">九九方阵表格打印--widthratio &lt;hr&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> i <span class="keyword">in</span> loop %&#125;</span><br><span class="line">    &lt;tr style=<span class="string">"background-color:</span></span><br><span class="line"><span class="string">&#123;&#123;forloop.counter|divisibleby:2|yesno:'#F0F0F0,#CCC'&#125;&#125;"</span>&gt;</span><br><span class="line">        &#123;% <span class="keyword">for</span> j <span class="keyword">in</span> loop %&#125;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">            &#123;&#123;forloop.counter&#125;&#125;*&#123;&#123;forloop.parentloop.counter&#125;&#125;=&#123;% widthratio</span><br><span class="line">i 1 j %&#125; &lt;/td&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>使用cycle标签来替换奇偶行变色代码。cycle标签，就是轮询所有其后给出的所有参数。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;九九方阵&lt;/title&gt; </span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">九九方阵表格打印--widthratio</span><br><span class="line">&lt;hr&gt; &lt;table&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> i <span class="keyword">in</span> loop %&#125;</span><br><span class="line">    &lt;tr style=<span class="string">"background-color:&#123;% cycle '#CCC' '#F0F0F0' '#FFF' %&#125;"</span>&gt;</span><br><span class="line">        &#123;% <span class="keyword">for</span> j <span class="keyword">in</span> loop %&#125;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">            &#123;&#123;forloop.counter&#125;&#125;*&#123;&#123;forloop.parentloop.counter&#125;&#125;=&#123;% widthratio forloop.counter <span class="number">1</span> forloop.parentloop.counter %&#125;</span><br><span class="line">				&lt;/td&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>方法三：自定义filter<br> 参考 <a href="https://docs.djangoproject.com/en/2.2/howto/custom-template-tags/#writing-custom-template-filters" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.2/howto/custom-template-tags/#writing-custom-template-filters</a></p>
<ol>
<li>构建自定义的模板的包和模块 在INSTALLED_APPS注册的应用user下构建templatetags包，一定要有 <strong>init</strong>.py 文件。</li>
</ol>
<p>templatetags下构建自己的filter的模块，这里起名为 。其中代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Library</span><br><span class="line"></span><br><span class="line">register = Library()</span><br><span class="line"><span class="meta">@register.filter('multiply') # 使用装饰器注册 def multiply(a, b):# 只能1到2个参数</span></span><br><span class="line">    <span class="keyword">return</span> int(a)*int(b)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>定义模板</p>
<p>matrix.html模板中要 <strong>load myfilters</strong>模块，使用已经注册的filter multiply，模板内容如下</p>
</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;九九方阵&lt;/title&gt; </span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">九九方阵表格打印</span><br><span class="line">&#123;% load myfilters %&#125;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> i <span class="keyword">in</span> loop %&#125;</span><br><span class="line">    &lt;tr style=<span class="string">"background-color:</span></span><br><span class="line"><span class="string">&#123;&#123;forloop.counter|divisibleby:2|yesno:'#F0F0F0,#CCC'&#125;&#125;"</span>&gt;</span><br><span class="line">        &#123;% <span class="keyword">for</span> j <span class="keyword">in</span> loop %&#125;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">            &#123;&#123;forloop.counter&#125;&#125;*&#123;&#123;forloop.parentloop.counter&#125;&#125;=</span><br><span class="line">&#123;&#123;forloop.counter|multiply:forloop.parentloop.counter&#125;&#125;</span><br><span class="line">&lt;/td&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用模板</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpRequest</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request:HttpRequest)</span>:</span></span><br><span class="line">    context = &#123;<span class="string">'loop'</span>:list(range(<span class="number">1</span>,<span class="number">10</span>))&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'matrix.html'</span>, context)</span><br></pre></td></tr></table></figure>

<p>注意加载自定义标签，需要重启Django服务。 模板文件可以放在应用的templates目录中，例如user/templates/multiply.html。</p>
<ol start="4">
<li>链接处理<br>可以通过模板url标签计算动态的url，应用在模板中。</li>
</ol>
<p><a href="https://docs.djangoproject.com/en/2.2/topics/http/urls/#reverse-resolution-of-urls" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.2/topics/http/urls/#reverse-resolution-of-urls</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># user/urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'login'</span>, userlogin, name=<span class="string">'user-login'</span>), <span class="comment"># /users/login</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># user/templates/multiply.html</span></span><br><span class="line">&lt;a href="&#123;% url 'user-login' %&#125;"&gt;登录&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>在Django代码中可以使用reverse函数通过name获得url</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fromdjango.urlsimportpath,reverse </span><br><span class="line">print(reverse(<span class="string">'user-login'</span>))</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Lupinus
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="http://yoursite.com/2018/10/07/Django%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3/" title="[Django框架详解]">http://yoursite.com/2018/10/07/Django框架详解/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Django/" rel="tag"># Django</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/09/01/Django%E6%A1%86%E6%9E%B6/" rel="prev" title="[Django框架]">
      <i class="fa fa-chevron-left"></i> [Django框架]
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/10/09/DRF%E6%8F%92%E4%BB%B6/" rel="next" title="[DRF插件]">
      [DRF插件] <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Django框架详解"><span class="nav-number">1.</span> <span class="nav-text">Django框架详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">1.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目构建"><span class="nav-number">1.2.</span> <span class="nav-text">项目构建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Django"><span class="nav-number">1.2.1.</span> <span class="nav-text">安装Django</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#脚手架构建"><span class="nav-number">1.2.2.</span> <span class="nav-text">脚手架构建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL数据库驱动"><span class="nav-number">1.2.3.</span> <span class="nav-text">MySQL数据库驱动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建应用"><span class="nav-number">1.2.4.</span> <span class="nav-text">创建应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置"><span class="nav-number">1.2.5.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册应用"><span class="nav-number">1.2.6.</span> <span class="nav-text">注册应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库配置"><span class="nav-number">1.2.7.</span> <span class="nav-text">数据库配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#本地化和时区"><span class="nav-number">1.2.8.</span> <span class="nav-text">本地化和时区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日志"><span class="nav-number">1.2.9.</span> <span class="nav-text">日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迁移"><span class="nav-number">1.2.10.</span> <span class="nav-text">迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行"><span class="nav-number">1.2.11.</span> <span class="nav-text">运行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ORM"><span class="nav-number">1.3.</span> <span class="nav-text">ORM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Django-ORM"><span class="nav-number">1.3.1.</span> <span class="nav-text">Django ORM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Model模型"><span class="nav-number">1.3.2.</span> <span class="nav-text">Model模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#字段类型"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">字段类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#缺省主键"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">缺省主键</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字段选项"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">字段选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关系类型字段类"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">关系类型字段类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Model类"><span class="nav-number">1.3.2.5.</span> <span class="nav-text">Model类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#管理器"><span class="nav-number">1.3.2.6.</span> <span class="nav-text">管理器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Django查询"><span class="nav-number">1.4.</span> <span class="nav-text">Django查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查询集"><span class="nav-number">1.4.1.</span> <span class="nav-text">查询集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#限制查询集-切片"><span class="nav-number">1.4.2.</span> <span class="nav-text">限制查询集(切片)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结果集方法"><span class="nav-number">1.4.3.</span> <span class="nav-text">结果集方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#返回单个值的方法"><span class="nav-number">1.4.4.</span> <span class="nav-text">返回单个值的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字段查询-Field-Lookup-表达式"><span class="nav-number">1.4.5.</span> <span class="nav-text">字段查询(Field Lookup)表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Q对象"><span class="nav-number">1.4.6.</span> <span class="nav-text">Q对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#聚合、分组"><span class="nav-number">1.4.7.</span> <span class="nav-text">聚合、分组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Django-ORM-1"><span class="nav-number">1.5.</span> <span class="nav-text">Django ORM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一对多"><span class="nav-number">1.5.1.</span> <span class="nav-text">一对多</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#联合主键问题"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">联合主键问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模型构建"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">模型构建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特殊属性"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">特殊属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询"><span class="nav-number">1.5.1.4.</span> <span class="nav-text">查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#raw的使用"><span class="nav-number">1.5.1.5.</span> <span class="nav-text">raw的使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多对多"><span class="nav-number">1.5.2.</span> <span class="nav-text">多对多</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#构建模型"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">构建模型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迁移-1"><span class="nav-number">1.5.3.</span> <span class="nav-text">迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">1.5.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#后台管理"><span class="nav-number">1.6.</span> <span class="nav-text">后台管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#站点管理"><span class="nav-number">1.6.1.</span> <span class="nav-text">站点管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-注册应用"><span class="nav-number">1.6.2.</span> <span class="nav-text">1.注册应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-注册Model类"><span class="nav-number">1.6.3.</span> <span class="nav-text">2.注册Model类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由"><span class="nav-number">1.7.</span> <span class="nav-text">路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#主路由"><span class="nav-number">1.7.1.</span> <span class="nav-text">主路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二级路由"><span class="nav-number">1.7.2.</span> <span class="nav-text">二级路由</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Django模板"><span class="nav-number">1.8.</span> <span class="nav-text">Django模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#模板"><span class="nav-number">1.8.1.</span> <span class="nav-text">模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板配置"><span class="nav-number">1.8.2.</span> <span class="nav-text">模板配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板渲染"><span class="nav-number">1.8.3.</span> <span class="nav-text">模板渲染</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模板页"><span class="nav-number">1.8.3.1.</span> <span class="nav-text">模板页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模板处理"><span class="nav-number">1.8.3.2.</span> <span class="nav-text">模板处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#render-函数"><span class="nav-number">1.8.3.3.</span> <span class="nav-text">render 函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DTL语法"><span class="nav-number">1.8.4.</span> <span class="nav-text">DTL语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#变量"><span class="nav-number">1.8.4.1.</span> <span class="nav-text">变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模板标签"><span class="nav-number">1.8.4.2.</span> <span class="nav-text">模板标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#过滤器"><span class="nav-number">1.8.4.3.</span> <span class="nav-text">过滤器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#静态文件"><span class="nav-number">1.8.5.</span> <span class="nav-text">静态文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模板习题"><span class="nav-number">1.9.</span> <span class="nav-text">模板习题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#奇偶行列表输出"><span class="nav-number">1.9.1.</span> <span class="nav-text">奇偶行列表输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打印九九方阵"><span class="nav-number">1.9.2.</span> <span class="nav-text">打印九九方阵</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lupinus"
      src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/20160715144434_fZCsF.jpeg">
  <p class="site-author-name" itemprop="name">Lupinus</p>
  <div class="site-description" itemprop="description">Re：从零开始的go学习生活(｀・ω・´)</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/rogerXS80/roger" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rogerXS80&#x2F;roger" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/fastsword66@gmail.com" title="E-Mail → fastsword66@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5896791111/home?wvr=5&sudaref=graph.qq.com" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5896791111&#x2F;home?wvr&#x3D;5&amp;sudaref&#x3D;graph.qq.com" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

      
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <!-- 选择合适的icon -->
              <i class="fa fa-history fa-" aria-hidden="true"></i>
          <!-- 这里对应下文主题配置文件的recent_posts_title值 -->
              最近文章
            </div>
            <ul class="links-of-blogroll-list"> 
              <!-- 设置排序规格，此处我采用按照文章更新时间排序 -->
              
              <!-- 显示三条近期文章，请自信合理配置 -->
              
                <li>
                  <a href="/2017/06/22/Git%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" title="[Git命令大全]" target="_blank">[Git命令大全]</a>
                </li>
              
                <li>
                  <a href="/2022/02/27/Vue%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" title="[Vue客户端项目搭建]" target="_blank">[Vue客户端项目搭建]</a>
                </li>
              
                <li>
                  <a href="/2022/02/26/Vue%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%EF%BC%88Vue-cli%EF%BC%89/" title="[Vue自动化工具（Vue-cli）]" target="_blank">[Vue自动化工具（Vue-cli）]</a>
                </li>
              
            </ul>
          </div>
      

      
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>




      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Roger</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div><!-- 文件位置：~/sourse/_data/footer.swig -->

<div class="weixin-box">
  <div class="weixin-menu">
    <div class="weixin-hover">
      <div class="weixin-description">微信扫一扫，订阅本博客</div>
    </div>
  </div>
</div>


        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="100" alpha="0.4" zIndex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

    </div>

<!-- 鼠标点击特效 -->
<script type="text/javascript" src="/js/fireworks.js"></script>

<!-- 点击爱心 
<script type="text/javascript" src="/js/clicklove.js"></script>
-->

</body>
</html>
