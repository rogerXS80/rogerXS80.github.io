<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="uW8bwgMGUwIA01nPfItoty1rmtmmuVkOVTeS9O0nAUg">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="序列化器 作用：1. 序列化,序列化器会把模型对象转换成字典,将来提供给视图经过response以后变成json字符串2. 反序列化,把客户端发送过来的数据,经过视图调用request以后变成python字典,序列化器可以把字典转成...">
<meta property="og:type" content="article">
<meta property="og:title" content="[序列化器-Serializer]">
<meta property="og:url" content="http://yoursite.com/2020/04/22/%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8-Serializer/index.html">
<meta property="og:site_name" content="Lupinus">
<meta property="og:description" content="序列化器 作用：1. 序列化,序列化器会把模型对象转换成字典,将来提供给视图经过response以后变成json字符串2. 反序列化,把客户端发送过来的数据,经过视图调用request以后变成python字典,序列化器可以把字典转成...">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/images/1582086563954.png">
<meta property="article:published_time" content="2020-04-22T10:11:52.000Z">
<meta property="article:modified_time" content="2020-04-23T10:53:33.000Z">
<meta property="article:author" content="Lupinus">
<meta property="article:tag" content="Django Rest_Framework">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/1582086563954.png">

<link rel="canonical" href="http://yoursite.com/2020/04/22/%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8-Serializer/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[序列化器-Serializer] | Lupinus</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Lupinus" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lupinus</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Re：从零开始的go学习生活(｀・ω・´)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/rogerXS80" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/22/%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8-Serializer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/20160715144434_fZCsF.jpeg">
      <meta itemprop="name" content="Lupinus">
      <meta itemprop="description" content="Re：从零开始的go学习生活(｀・ω・´)">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lupinus">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [序列化器-Serializer]
        </h1>

        <div class="post-meta">
          <!-- 置顶图标 -->
            <span class="post-meta-item">
              
              
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-22 18:11:52" itemprop="dateCreated datePublished" datetime="2020-04-22T18:11:52+08:00">2020-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-23 18:53:33" itemprop="dateModified" datetime="2020-04-23T18:53:33+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <div class="post-description">序列化器 作用：1. 序列化,序列化器会把模型对象转换成字典,将来提供给视图经过response以后变成json字符串2. 反序列化,把客户端发送过来的数据,经过视图调用request以后变成python字典,序列化器可以把字典转成...</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="7-序列化器-Serializer"><a href="#7-序列化器-Serializer" class="headerlink" title="7. 序列化器-Serializer"></a>7. 序列化器-Serializer</h1><p>作用：</p>
<ol>
<li>序列化,序列化器会把模型对象转换成字典,将来提供给视图经过response以后变成json字符串</li>
<li>反序列化,把客户端发送过来的数据,经过视图调用request以后变成python字典,序列化器可以把字典转成模型</li>
<li>反序列化,完成数据校验功能和操作数据库</li>
</ol>
<h2 id="7-1-定义序列化器"><a href="#7-1-定义序列化器" class="headerlink" title="7.1 定义序列化器"></a>7.1 定义序列化器</h2><p>Django REST framework中的Serializer使用类来定义，须继承自rest_framework.serializers.Serializer。</p>
<p>接下来，为了方便演示序列化器的使用，我们另外创建一个新的子应用sers</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp sers</span><br></pre></td></tr></table></figure>

<p>先注册子应用到项目中，settings.py，代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'rest_framework'</span>, <span class="comment"># 把drf框架注册到django项目中</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'students'</span>, <span class="comment"># 注册子应用</span></span><br><span class="line">    <span class="string">'sers'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>因为我们已有了一个数据库模型类students/Student，我们直接在接下来的演示中使用这个模型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 模型字段</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>,verbose_name=<span class="string">"姓名"</span>)</span><br><span class="line">    sex = models.BooleanField(default=<span class="number">1</span>,verbose_name=<span class="string">"性别"</span>)</span><br><span class="line">    age = models.IntegerField(verbose_name=<span class="string">"年龄"</span>)</span><br><span class="line">    class_number = models.CharField(max_length=<span class="number">5</span>,verbose_name=<span class="string">"班级编号"</span>)</span><br><span class="line">    description = models.TextField(max_length=<span class="number">1000</span>,verbose_name=<span class="string">"个性签名"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table=<span class="string">"tb_student"</span></span><br><span class="line">        verbose_name = <span class="string">"学生"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure>

<p>我们想为这个模型类提供一个序列化器，可以命名为<code>StudentSerializer</code>，</p>
<p>我们都会把序列化器代码保存到当前子应用下的serializers.py模块中，</p>
<p>可以定义如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明序列化器，所有的序列化器都要直接或者间接继承于 Serializer</span></span><br><span class="line"><span class="comment"># 其中，ModelSerializer是Serializer的子类，ModelSerializer在Serializer的基础上进行了代码简化</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    <span class="string">"""学生信息序列化器"""</span></span><br><span class="line">    <span class="comment"># 1. 需要进行数据转换的字段</span></span><br><span class="line">    id = serializers.IntegerField()</span><br><span class="line">    name = serializers.CharField()</span><br><span class="line">    age = serializers.IntegerField()</span><br><span class="line">    sex = serializers.BooleanField()</span><br><span class="line">    description = serializers.CharField()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 如果序列化器集成的是ModelSerializer，则需要声明调用的模型信息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 验证代码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. 编写添加和更新模型的代码</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：serializer不是只能为数据库模型类定义，也可以为非数据库模型类的数据定义。</strong>serializer是独立于数据库之外的存在。</p>
<p><strong>常用字段类型</strong>：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>字段构造方式</th>
</tr>
</thead>
<tbody><tr>
<td><strong>BooleanField</strong></td>
<td>BooleanField()</td>
</tr>
<tr>
<td><strong>NullBooleanField</strong></td>
<td>NullBooleanField()</td>
</tr>
<tr>
<td><strong>CharField</strong></td>
<td>CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)</td>
</tr>
<tr>
<td><strong>EmailField</strong></td>
<td>EmailField(max_length=None, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>RegexField</strong></td>
<td>RegexField(regex, max_length=None, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>SlugField</strong></td>
<td>SlugField(max<em>length=50, min_length=None, allow_blank=False) 正则字段，验证正则模式 [a-zA-Z0-9</em>-]+</td>
</tr>
<tr>
<td><strong>URLField</strong></td>
<td>URLField(max_length=200, min_length=None, allow_blank=False)</td>
</tr>
<tr>
<td><strong>UUIDField</strong></td>
<td>UUIDField(format=’hex_verbose’)  format:  1) <code>&#39;hex_verbose&#39;</code> 如<code>&quot;5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code>  2） <code>&#39;hex&#39;</code> 如 <code>&quot;5ce0e9a55ffa654bcee01238041fb31a&quot;</code>  3）<code>&#39;int&#39;</code> - 如: <code>&quot;123456789012312313134124512351145145114&quot;</code>  4）<code>&#39;urn&#39;</code> 如: <code>&quot;urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code></td>
</tr>
<tr>
<td><strong>IPAddressField</strong></td>
<td>IPAddressField(protocol=’both’, unpack_ipv4=False, **options)</td>
</tr>
<tr>
<td><strong>IntegerField</strong></td>
<td>IntegerField(max_value=None, min_value=None)</td>
</tr>
<tr>
<td><strong>FloatField</strong></td>
<td>FloatField(max_value=None, min_value=None)</td>
</tr>
<tr>
<td><strong>DecimalField</strong></td>
<td>DecimalField(max_digits, decimal_places, coerce_to_string=None, max_value=None, min_value=None) max_digits: 最多位数 decimal_palces: 小数点位置</td>
</tr>
<tr>
<td><strong>DateTimeField</strong></td>
<td>DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>DateField</strong></td>
<td>DateField(format=api_settings.DATE_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>TimeField</strong></td>
<td>TimeField(format=api_settings.TIME_FORMAT, input_formats=None)</td>
</tr>
<tr>
<td><strong>DurationField</strong></td>
<td>DurationField()</td>
</tr>
<tr>
<td><strong>ChoiceField</strong></td>
<td>ChoiceField(choices) choices与Django的用法相同</td>
</tr>
<tr>
<td><strong>MultipleChoiceField</strong></td>
<td>MultipleChoiceField(choices)</td>
</tr>
<tr>
<td><strong>FileField</strong></td>
<td>FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ImageField</strong></td>
<td>ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ListField</strong></td>
<td>ListField(child=, min_length=None, max_length=None)</td>
</tr>
<tr>
<td><strong>DictField</strong></td>
<td>DictField(child=)</td>
</tr>
</tbody></table>
<p><strong>选项参数：</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>max_length</strong></td>
<td>最大长度[适用于字符串，列表，文件]</td>
</tr>
<tr>
<td><strong>min_lenght</strong></td>
<td>最小长度[适用于字符串，列表，文件]</td>
</tr>
<tr>
<td><strong>allow_blank</strong></td>
<td>是否允许数据的值为空，如果使用这个选项，则前端传递过来的数据必须有这个属性。</td>
</tr>
<tr>
<td><strong>trim_whitespace</strong></td>
<td>是否截断空白字符</td>
</tr>
<tr>
<td><strong>max_value</strong></td>
<td>【数值】最小值</td>
</tr>
<tr>
<td><strong>min_value</strong></td>
<td>【数值】最大值</td>
</tr>
</tbody></table>
<p>通用参数：</p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>read_only</strong></td>
<td>表明该字段仅用于序列化输出，默认False</td>
</tr>
<tr>
<td><strong>write_only</strong></td>
<td>表明该字段仅用于反序列化输入，默认False</td>
</tr>
<tr>
<td><strong>required</strong></td>
<td>表明该字段在反序列化时必须输入，默认True</td>
</tr>
<tr>
<td><strong>default</strong></td>
<td>反序列化时使用的默认值</td>
</tr>
<tr>
<td><strong>allow_null</strong></td>
<td>表明该字段是否允许传入None，默认False</td>
</tr>
<tr>
<td><strong>validators</strong></td>
<td>该字段使用的验证器</td>
</tr>
<tr>
<td><strong>error_messages</strong></td>
<td>包含错误编号与错误信息的字典</td>
</tr>
<tr>
<td><strong>label</strong></td>
<td>用于HTML展示API页面时，显示的字段名称</td>
</tr>
<tr>
<td><strong>help_text</strong></td>
<td>用于HTML展示API页面时，显示的字段帮助提示信息</td>
</tr>
</tbody></table>
<h2 id="7-2-创建Serializer对象"><a href="#7-2-创建Serializer对象" class="headerlink" title="7.2 创建Serializer对象"></a>7.2 创建Serializer对象</h2><p>定义好Serializer类后，就可以创建Serializer对象了。</p>
<p>Serializer的构造方法为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Serializer(instance=<span class="literal">None</span>, data=empty, **kwarg)</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>1）用于序列化时，将模型类对象传入<strong>instance</strong>参数</p>
<p>2）用于反序列化时，将要被反序列化的数据传入<strong>data</strong>参数</p>
<p>3）除了instance和data参数外，在构造Serializer对象时，还可通过<strong>context</strong>参数额外添加数据，如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serializer = StudentSerializer(student, context=&#123;<span class="string">'request'</span>: request&#125;,many=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p><strong>通过context参数附加的数据，可以通过Serializer对象的self.context属性获取。</strong></p>
<ol>
<li>使用序列化器的时候一定要注意，序列化器声明了以后，不会自动执行，需要我们在视图中进行调用才可以。</li>
<li>序列化器无法直接接收客户端的请求数据，需要我们在视图中创建序列化器对象时把使用的数据传递过来。</li>
<li>序列化器的字段声明类似于我们前面使用过的表单系统。</li>
<li>开发restful api时，序列化器会帮我们把模型数据转换成字典.</li>
<li>drf提供的视图会帮我们把字典转换成json,或者把客户端发送过来的数据转换字典.</li>
</ol>
<h2 id="7-3-序列化器的使用"><a href="#7-3-序列化器的使用" class="headerlink" title="7.3 序列化器的使用"></a>7.3 序列化器的使用</h2><p>序列化器的使用分两个阶段：</p>
<ol>
<li>在客户端请求时，使用序列化器可以完成对数据的反序列化。</li>
<li>在服务器响应时，使用序列化器可以完成对数据的序列化。</li>
</ol>
<h3 id="7-3-1-序列化"><a href="#7-3-1-序列化" class="headerlink" title="7.3.1 序列化"></a>7.3.1 序列化</h3><h3 id="7-3-1-1-基本使用"><a href="#7-3-1-1-基本使用" class="headerlink" title="7.3.1.1 基本使用"></a>7.3.1.1 基本使用</h3><p>1） 先查询出一个学生对象</p>
<p>视图中获取模型对象，代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line"></span><br><span class="line">student = Student.objects.get(pk=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>2） 构造序列化器对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> StudentSerializer</span><br><span class="line"></span><br><span class="line">serializer = StudentSerializer(instance=student)</span><br></pre></td></tr></table></figure>

<p>3）获取序列化数据</p>
<p>通过data属性可以获取序列化后的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">serializer.data</span><br><span class="line"><span class="comment"># &#123;'id': 4, 'name': '小张', 'age': 18, 'sex': True, 'description': '猴赛雷'&#125;</span></span><br></pre></td></tr></table></figure>

<p>完整视图代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student2APIView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="string">"""返回一个学生信息"""</span></span><br><span class="line">        <span class="comment"># 读取模型对象</span></span><br><span class="line">        student = Student.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 实例化序列化器</span></span><br><span class="line">        serializer = StudentSerializer(instance=student)</span><br><span class="line">        print( serializer.data )</span><br><span class="line">        <span class="string">"""打印效果：</span></span><br><span class="line"><span class="string">        &#123;'id': 1, 'name': '张三', 'sex': True, 'age': 18&#125;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data)</span><br></pre></td></tr></table></figure>

<p>4）如果要被序列化的是包含多条数据的查询集QuerySet，可以通过添加<strong>many=True</strong>参数补充说明</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">目前我们先学习序列化器，所以我们还是使用原来django内置的视图类和路由。</span></span><br><span class="line"><span class="string">使用序列化器对数据进行序列化器，一般用于返回数据给客户端。</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> StudentSerializer</span><br><span class="line"><span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student1APIView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="string">"""返回所有学生给客户端"""</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        序列化器对象初始化有３个参数:</span></span><br><span class="line"><span class="string">        1. instance，模型对象或者模型对象组成的列表，用于对数据进行序列化，把模型转换成字典</span></span><br><span class="line"><span class="string">        2. data，字典，用于对数据进行反序列化，把数据进行验证和保存到数据库</span></span><br><span class="line"><span class="string">        3. context，字典，用于把路由或者视图的自定义参数传递到序列化器里面使用</span></span><br><span class="line"><span class="string">                 context将来作为序列化器对象的子属性</span></span><br><span class="line"><span class="string">        4. many，当序列化器进行序列化时，如果模型有多个，则many必须为True</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        student_list = Student.objects.all()</span><br><span class="line">        serializer = StudentSerializer(instance=student_list, many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">'student_list===&gt;'</span>,student_list)</span><br><span class="line">        print(<span class="string">'serializer===&gt;'</span>, serializer)</span><br><span class="line">        print(<span class="string">'转换的结果===&gt;'</span>, serializer.data)</span><br><span class="line">        <span class="string">"""打印效果：</span></span><br><span class="line"><span class="string">        [</span></span><br><span class="line"><span class="string">            OrderedDict([('name', '张三'), ('sex', True), ('age', 18), ('class_null', '3011')]), </span></span><br><span class="line"><span class="string">            OrderedDict([('name', '张三'), ('sex', True), ('age', 18), ('class_null', '309')]), </span></span><br><span class="line"><span class="string">            OrderedDict([('name', '张三'), ('sex', True), ('age', 18), ('class_null', '309')]), </span></span><br><span class="line"><span class="string">            ....    </span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        说明：</span></span><br><span class="line"><span class="string">        OrderedDict是python内置的高级数据类型，表示有序字典，因为普通数据类型中的字典是无序的.</span></span><br><span class="line"><span class="string">        有序字典的成员读取方式，和无序字典一样</span></span><br><span class="line"><span class="string">        导入路径：</span></span><br><span class="line"><span class="string">        from collections import OrderedDict</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># jsonResponse的第一个参数如果是列表则必须声明safe=False，否则报错如下：</span></span><br><span class="line">        <span class="comment"># In order to allow non-dict objects to be serialized set the safe parameter to False.</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(serializer.data, safe=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-2-反序列化"><a href="#7-3-2-反序列化" class="headerlink" title="7.3.2 反序列化"></a>7.3.2 反序列化</h3><h3 id="7-3-2-1-数据验证"><a href="#7-3-2-1-数据验证" class="headerlink" title="7.3.2.1 数据验证"></a>7.3.2.1 数据验证</h3><p>开发中，用户的数据都是不可信任的。</p>
<p>使用序列化器进行反序列化时，需要对数据进行验证后，才能获取验证成功的数据或保存成模型类对象。</p>
<p>在获取反序列化的客户端数据前，必须在视图中调用序列化对象的<strong>is_valid()</strong>方法，序列化器内部是在<strong>is_valid</strong>方法内部调用验证选项和验证方法进行验证，验证成功返回True，否则返回False。</p>
<p>验证失败，可以通过序列化器对象的<strong>errors</strong>属性获取错误信息，返回字典，包含了字段和字段的错误提示。如果是非字段错误，可以通过修改REST framework配置中的<strong>NON_FIELD_ERRORS_KEY</strong>来控制错误字典中的键名。</p>
<p>验证成功，可以通过序列化器对象的<strong>validated_data</strong>属性获取数据。</p>
<p>在定义序列化器时，指明每个字段的序列化类型和选项参数，本身就是一种验证行为。</p>
<p>为了方便演示，我们这里采用另一个图书模型来完成反序列化的学习。当然也创建一个新的子应用unsers。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp unsers</span><br></pre></td></tr></table></figure>

<p>注册子应用，setting.py注册子应用，代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'rest_framework'</span>, <span class="comment"># 把drf框架注册到django项目中</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'students'</span>, <span class="comment"># 注册子应用</span></span><br><span class="line">    <span class="string">'sers'</span>,     <span class="comment"># 演示序列化</span></span><br><span class="line">    <span class="string">'unsers'</span>,     <span class="comment"># 演示反序列化</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">接下来的内容涉及到postman post提交数据，所以在此时我们没有学习到drf视图方法时，我i们把settings.py中的中间件的csrf关闭.</span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="comment"># 'django.middleware.csrf.CsrfViewMiddleware',</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>模型代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">"""图书信息"""</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">'标题'</span>)</span><br><span class="line">    pub_date = models.DateField(verbose_name=<span class="string">'发布日期'</span>)</span><br><span class="line">    image = models.ImageField(verbose_name=<span class="string">'图书封面'</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">8</span>, decimal_places=<span class="number">2</span>, verbose_name=<span class="string">"价格"</span>)</span><br><span class="line">    read = models.IntegerField(verbose_name=<span class="string">'阅读量'</span>)</span><br><span class="line">    comment = models.IntegerField(verbose_name=<span class="string">'评论量'</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># db_table = "表名"</span></span><br><span class="line">        db_table = <span class="string">"tb_book_info"</span></span><br><span class="line">        verbose_name = <span class="string">"图书"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure>

<p>注意：因为当前模型中， 设置到图片上传处理，所以我们需要安装<code>PIL</code>库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Pillow</span><br></pre></td></tr></table></figure>

<p>数据迁移</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrationspython manage.py migrate</span><br></pre></td></tr></table></figure>

<p>经过上面的准备工作，我们接下来就可以给图书信息增加图书的功能，那么我们需要对来自客户端的数据进行处理，例如，验证和保存到数据库中，此时，我们就可以使用序列化器的反序列化器，接下来，我们就可以参考之前定义学生信息的序列化器那样，定义一个图书的序列化器，当然，不同的是，接下来的序列化器主要用于反序列化器阶段，在unsers子应用，创建serializers.py，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    <span class="comment"># 这里声明的字段用于进行反序列化器</span></span><br><span class="line">    <span class="comment"># 字段名 = serializers.字段类型(验证选项)</span></span><br><span class="line">    title = serializers.CharField(max_length=<span class="number">20</span>, label=<span class="string">"标题"</span>, help_text=<span class="string">"标题"</span>)</span><br><span class="line">    <span class="comment"># required=True 当前字段必填</span></span><br><span class="line">    pub_date = serializers.DateField(required=<span class="literal">True</span>,label=<span class="string">"发布日期"</span>, help_text=<span class="string">"发布日期"</span>)</span><br><span class="line">    image = serializers.ImageField(max_length=<span class="number">3</span>*<span class="number">1024</span>*<span class="number">1024</span>, label=<span class="string">"图书封面"</span>, help_text=<span class="string">"图书封面"</span>)</span><br><span class="line">    price = serializers.DecimalField(max_digits=<span class="number">8</span>, decimal_places=<span class="number">2</span>, required=<span class="literal">True</span>, label=<span class="string">"价格"</span>, help_text=<span class="string">"价格"</span>)</span><br><span class="line">    read  = serializers.IntegerField(min_value=<span class="number">0</span>, default=<span class="number">0</span>, label=<span class="string">"阅读量"</span>, help_text=<span class="string">"阅读量"</span>)</span><br><span class="line">    comment = serializers.IntegerField(min_value=<span class="number">0</span>, default=<span class="number">0</span>, label=<span class="string">"评论量"</span>, help_text=<span class="string">"评论量"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关于继承数据库选项</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 验证部分的代码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据库</span></span><br></pre></td></tr></table></figure>

<p>通过构造序列化器对象，并将要反序列化的数据传递给data构造参数，进而进行验证</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookInfoSerializer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="string">"""模拟客户端发送过来的数据"""</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"title"</span>:<span class="string">"西厢记"</span>,</span><br><span class="line">            <span class="string">"pub_date"</span>:<span class="string">"1980-10-10"</span>,</span><br><span class="line">            <span class="string">"price"</span>: <span class="number">19.80</span>,</span><br><span class="line">            <span class="string">"read"</span>: <span class="number">100</span>,</span><br><span class="line">            <span class="string">"comment"</span>: <span class="number">-1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 对上面的数据进行反序列化器处理</span></span><br><span class="line">        <span class="comment"># 1. 初始化，填写data属性</span></span><br><span class="line">        serializer = BookInfoSerializer(data=data)</span><br><span class="line">        <span class="comment"># 2. 调用序列化器提供的is_valid方法进行验证</span></span><br><span class="line">        <span class="comment"># raise_exception=True 表示终断程序，直接抛出错误</span></span><br><span class="line">        ret = serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        print(ret) <span class="comment"># is_valid的方法值就是验证结果，只会是True/False</span></span><br><span class="line">        <span class="keyword">if</span> ret:</span><br><span class="line">            <span class="comment"># 3.1 验证通过后，可以通过validated_data得到数据</span></span><br><span class="line">            print(<span class="string">"验证成功，ret=%s"</span> % ret)</span><br><span class="line">            print(serializer.validated_data)  <span class="comment"># 验证处理后的数据</span></span><br><span class="line">            <span class="string">"""打印结果：</span></span><br><span class="line"><span class="string">            OrderedDict([('title', '西厢记'), ('pub_date', datetime.date(1980, 10, 10)), ('price', Decimal('19.80')), ('read', 100), ('comment', 15)])</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"验证失败，ret=%s"</span> % ret)</span><br><span class="line">            <span class="comment"># 3.1 验证没通过，可以通过</span></span><br><span class="line">            print( serializer.errors )</span><br><span class="line">            <span class="string">"""打印结果：</span></span><br><span class="line"><span class="string">            &#123;'comment': [ErrorDetail(string='Ensure this value is greater than or equal to 0.', code='min_value')]&#125;</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"ok"</span>)</span><br></pre></td></tr></table></figure>

<p>is_valid()方法还可以在验证失败时抛出异常serializers.ValidationError，可以通过传递<strong>raise_exception=True</strong>参数开启，REST framework接收到此异常，会向前端返回HTTP 400 Bad Request响应。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Return a 400 response if the data was invalid.</span></span><br><span class="line">serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>如果觉得这些还不够，需要再补充定义验证行为，可以使用以下三种方法：</p>
<h3 id="1-validate-字段名"><a href="#1-validate-字段名" class="headerlink" title="1) validate_字段名"></a>1) validate_字段名</h3><p>对<code>&lt;field_name&gt;</code>字段进行验证，如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    <span class="string">"""图书数据序列化器"""</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 单个字段的验证，方法名必须： validate_&lt;字段名&gt;(self,data)    # data 就是当前字段中客户端提交的数据</span></span><br><span class="line">    <span class="comment"># validate_price 会被is_valid调用</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_price</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">""""""</span></span><br><span class="line">        <span class="keyword">if</span> data &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"对不起，价格不能低于0元"</span>)</span><br><span class="line">        <span class="comment"># 验证通过以后，必须要返回验证的结果数据，否则序列化器的validated_data无法得到当前字段的结果</span></span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>把前面的例子的price改为-19.80，运行就可以测试了。</p>
<h3 id="2-validate"><a href="#2-validate" class="headerlink" title="2) validate"></a>2) validate</h3><p>在序列化器中需要同时对多个字段进行比较验证时，可以定义validate方法来验证，如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    <span class="string">"""图书数据序列化器"""</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 多个字段的验证，必须方法名叫 "validate"</span></span><br><span class="line">    <span class="comment"># data 表示客户端发送过来的所有数据，字典格式</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="comment"># 判断图书的阅读量不能低于评论量</span></span><br><span class="line">        read = data.get(<span class="string">"read"</span>)</span><br><span class="line">        comment = data.get(<span class="string">"comment"</span>)</span><br><span class="line">        <span class="keyword">if</span> read &lt; comment:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"对不起，阅读量不能低于评论量"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>运行之前的例子，把read改为1，comment改为100，访问测试。</p>
<h3 id="3-validators验证器"><a href="#3-validators验证器" class="headerlink" title="3) validators验证器"></a>3) validators验证器</h3><p>验证器类似于验证方法，但是验证方法只属于当前序列化器，如果有多个序列化器共用同样的验证功能，则可以把验证代码分离到序列化器外部，作为一个普通函数，由validators加载到序列化器中使用。</p>
<p>在字段中添加validators选项参数，也可以补充验证行为，如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以把验证函数进行多次使用，提供不用的字段或者不同的序列化器里面使用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">about_django</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"django"</span> <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"对不起，图书标题不能出现关键字django"</span>)</span><br><span class="line">    <span class="comment"># 返回验证以后的数据</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    <span class="comment"># 这里声明的字段用于进行反序列化器</span></span><br><span class="line">    <span class="comment"># 字段名 = serializers.字段类型(验证选项)</span></span><br><span class="line">    title = serializers.CharField(max_length=<span class="number">20</span>,validators=[about_django], label=<span class="string">"标题"</span>, help_text=<span class="string">"标题"</span>)</span><br><span class="line">    <span class="comment"># required=True 当前字段必填</span></span><br><span class="line">    pub_date = serializers.DateField(required=<span class="literal">True</span>, label=<span class="string">"发布日期"</span>, help_text=<span class="string">"发布日期"</span>)</span><br><span class="line">    <span class="comment"># max_length 文件的大小</span></span><br><span class="line">    <span class="comment"># allow_null=True 允许传递的image数据为None</span></span><br><span class="line">    image = serializers.ImageField(required=<span class="literal">False</span>, allow_null=<span class="literal">True</span>, max_length=<span class="number">3</span>*<span class="number">1024</span>*<span class="number">1024</span>, label=<span class="string">"图书封面"</span>, help_text=<span class="string">"图书封面"</span>)</span><br><span class="line">    price = serializers.DecimalField(max_digits=<span class="number">8</span>, decimal_places=<span class="number">2</span>, required=<span class="literal">True</span>, label=<span class="string">"价格"</span>, help_text=<span class="string">"价格"</span>)</span><br><span class="line">    <span class="comment"># min_value 数值大小</span></span><br><span class="line">    <span class="comment"># default 设置默认值</span></span><br><span class="line">    read  = serializers.IntegerField(min_value=<span class="number">0</span>, default=<span class="number">0</span>, label=<span class="string">"阅读量"</span>, help_text=<span class="string">"阅读量"</span>)</span><br><span class="line">    comment = serializers.IntegerField(min_value=<span class="number">0</span>, default=<span class="number">0</span>, label=<span class="string">"评论量"</span>, help_text=<span class="string">"评论量"</span>)</span><br></pre></td></tr></table></figure>

<p>把前面的例子修改成title=“西厢记django版本”，然后运行测试</p>
<p>视图代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookInfoSerializer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="string">"""模拟客户端发送过来的数据"""</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"title"</span>:<span class="string">"西厢记django版本"</span>,</span><br><span class="line">            <span class="string">"pub_date"</span>:<span class="string">"1980-10-10"</span>,</span><br><span class="line">            <span class="string">"price"</span>: <span class="number">19.80</span>,</span><br><span class="line">            <span class="string">"read"</span>: <span class="number">10000</span>,</span><br><span class="line">            <span class="string">"comment"</span>: <span class="number">100</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 对上面的数据进行反序列化器处理</span></span><br><span class="line">        <span class="comment"># 1. 初始化，填写data属性</span></span><br><span class="line">        serializer = BookInfoSerializer(data=data)</span><br><span class="line">        <span class="comment"># 2. 调用序列化器提供的is_valid方法进行验证</span></span><br><span class="line">        <span class="comment"># raise_exception=True 表示终断程序，直接抛出错误</span></span><br><span class="line">        ret = serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        print(ret) <span class="comment"># is_valid的方法值就是验证结果，只会是True/False</span></span><br><span class="line">        <span class="keyword">if</span> ret:</span><br><span class="line">            <span class="comment"># 3.1 验证通过后，可以通过validated_data得到数据</span></span><br><span class="line">            print(<span class="string">"验证成功，ret=%s"</span> % ret)</span><br><span class="line">            print(serializer.validated_data)  <span class="comment"># 验证处理后的数据</span></span><br><span class="line">            <span class="string">"""打印结果：</span></span><br><span class="line"><span class="string">            OrderedDict([('title', '西厢记'), ('pub_date', datetime.date(1980, 10, 10)), ('price', Decimal('19.80')), ('read', 100), ('comment', 15)])</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"验证失败，ret=%s"</span> % ret)</span><br><span class="line">            <span class="comment"># 3.1 验证没通过，可以通过</span></span><br><span class="line">            print( serializer.errors )</span><br><span class="line">            <span class="string">"""打印结果：</span></span><br><span class="line"><span class="string">            &#123;'comment': [ErrorDetail(string='Ensure this value is greater than or equal to 0.', code='min_value')]&#125;</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"ok"</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">is_valid实际上内部执行了三种不同的验证方式：</span><br><span class="line"><span class="number">1.</span> 先执行了字段内置的验证选项</span><br><span class="line"><span class="number">2.</span> 在执行了validators自定义选项</span><br><span class="line"><span class="number">3.</span> 最后执行了validate自定义验证方法[包含了validate_&lt;字段&gt;, validate]</span><br></pre></td></tr></table></figure>

<h3 id="7-3-2-2-数据保存"><a href="#7-3-2-2-数据保存" class="headerlink" title="7.3.2.2 数据保存"></a>7.3.2.2 数据保存</h3><p>通过序列化器来完成数据的更新或者添加，把视图中对于模型中的操作代码移出视图中，放入到序列化器。</p>
<p>前面的验证数据成功后,我们可以使用序列化器来完成数据反序列化的过程.这个过程可以把数据转成模型类对象.</p>
<p>可以通过实现create()和update()两个方法来实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以把验证函数进行多次使用，提供不用的字段或者不同的序列化器里面使用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">about_django</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"django"</span> <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"对不起，图书标题不能出现关键字django"</span>)</span><br><span class="line">    <span class="comment"># 返回验证以后的数据</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.Serializer)</span>:</span></span><br><span class="line">    <span class="comment"># 这里声明的字段用于进行反序列化器</span></span><br><span class="line">    <span class="comment"># 字段名 = serializers.字段类型(验证选项)</span></span><br><span class="line">    title = serializers.CharField(max_length=<span class="number">20</span>,validators=[about_django], label=<span class="string">"标题"</span>, help_text=<span class="string">"标题"</span>)</span><br><span class="line">    <span class="comment"># required=True 当前字段必填</span></span><br><span class="line">    pub_date = serializers.DateField(required=<span class="literal">True</span>, label=<span class="string">"发布日期"</span>, help_text=<span class="string">"发布日期"</span>)</span><br><span class="line">    <span class="comment"># max_length 文件的大小</span></span><br><span class="line">    <span class="comment"># allow_null=True 允许传递的image数据为None</span></span><br><span class="line">    image = serializers.ImageField(required=<span class="literal">False</span>, allow_null=<span class="literal">True</span>, max_length=<span class="number">3</span>*<span class="number">1024</span>*<span class="number">1024</span>, label=<span class="string">"图书封面"</span>, help_text=<span class="string">"图书封面"</span>)</span><br><span class="line">    price = serializers.DecimalField(max_digits=<span class="number">8</span>, decimal_places=<span class="number">2</span>, required=<span class="literal">True</span>, label=<span class="string">"价格"</span>, help_text=<span class="string">"价格"</span>)</span><br><span class="line">    <span class="comment"># min_value 数值大小</span></span><br><span class="line">    <span class="comment"># default 设置默认值</span></span><br><span class="line">    read  = serializers.IntegerField(min_value=<span class="number">0</span>, default=<span class="number">0</span>, label=<span class="string">"阅读量"</span>, help_text=<span class="string">"阅读量"</span>)</span><br><span class="line">    comment = serializers.IntegerField(min_value=<span class="number">0</span>, default=<span class="number">0</span>, label=<span class="string">"评论量"</span>, help_text=<span class="string">"评论量"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关于继承数据库选项</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义验证的代码</span></span><br><span class="line">    <span class="comment"># 单个字段的验证，方法名必须： validate_&lt;字段名&gt;(self,data)    # data 就是当前字段中客户端提交的数据</span></span><br><span class="line">    <span class="comment"># validate_price 会被is_valid调用</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_price</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">""""""</span></span><br><span class="line">        <span class="keyword">if</span> data &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"对不起，价格不能低于0元"</span>)</span><br><span class="line">        <span class="comment"># 验证通过以后，必须要返回验证的结果数据，否则序列化器的validated_data无法得到当前字段的结果</span></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 多个字段的验证，必须方法名叫 "validate"</span></span><br><span class="line">    <span class="comment"># data 表示客户端发送过来的所有数据，字典格式</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="comment"># 判断图书的阅读量不能低于评论量</span></span><br><span class="line">        read = data.get(<span class="string">"read"</span>)</span><br><span class="line">        comment = data.get(<span class="string">"comment"</span>)</span><br><span class="line">        <span class="keyword">if</span> read &lt; comment:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"对不起，阅读量不能低于评论量"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据库操作</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, validated_data)</span>:</span> <span class="comment"># 这里会在调用时，由序列化器补充验证成功以后的数据进来</span></span><br><span class="line">        <span class="string">"""完成添加操作"""</span></span><br><span class="line">        print(validated_data) <span class="comment"># 字典</span></span><br><span class="line">        <span class="comment"># 导入模型</span></span><br><span class="line">        <span class="keyword">from</span> .models <span class="keyword">import</span> BookInfo</span><br><span class="line">        <span class="comment"># 添加数据</span></span><br><span class="line">        book = BookInfo.objects.create(</span><br><span class="line">            title=validated_data.get(<span class="string">"title"</span>),</span><br><span class="line">            price=validated_data.get(<span class="string">"price"</span>),</span><br><span class="line">            pub_date=validated_data.get(<span class="string">"pub_date"</span>),</span><br><span class="line">            read=validated_data.get(<span class="string">"read"</span>),</span><br><span class="line">            comment=validated_data.get(<span class="string">"comment"</span>),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> book</span><br><span class="line"></span><br><span class="line">    <span class="comment"># instance就是要修改的模型，系统会自动从对象初始化时的instance提取过来</span></span><br><span class="line">    <span class="comment"># validated_data 就是经过验证以后的客户端提交的数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, instance, validated_data)</span>:</span></span><br><span class="line">        <span class="string">"""更新操作"""</span></span><br><span class="line">        instance.title = validated_data.get(<span class="string">'title'</span>)</span><br><span class="line">        instance.pub_date = validated_data.get(<span class="string">'pub_date'</span>)</span><br><span class="line">        instance.comment = validated_data.get(<span class="string">'comment'</span>)</span><br><span class="line">        instance.price = validated_data.get(<span class="string">'price'</span>)</span><br><span class="line">        instance.read = validated_data.get(<span class="string">'read'</span>)</span><br><span class="line">        instance.save()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编写的create和update方法都是对于数据库的操作，所以不能保证百分百的操作成功,那么此时我们应该在数据库操作中进行容错处理</span></span><br><span class="line"><span class="comment"># try...except...，当然自然也需要抛出异常提供给视图,由视图转发给客户端,抛出异常则使用raise serializers.ValidationError</span></span><br></pre></td></tr></table></figure>

<p>视图代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookInfoSerializer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="string">"""保存数据[更新]"""</span></span><br><span class="line">        <span class="comment"># 客户端提交数据过来</span></span><br><span class="line">        id = <span class="number">2</span></span><br><span class="line">        data = &#123; <span class="comment"># 模拟客户端发送过来的数据</span></span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"东游记"</span>,</span><br><span class="line">            <span class="string">"pub_date"</span>: <span class="string">"1998-10-01"</span>,</span><br><span class="line">            <span class="string">"price"</span>: <span class="number">19.98</span>,</span><br><span class="line">            <span class="string">"read"</span>: <span class="number">330</span>,</span><br><span class="line">            <span class="string">"comment"</span>: <span class="number">100</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">from</span> .models <span class="keyword">import</span> BookInfo</span><br><span class="line">        book = BookInfo.objects.get(pk=id)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用序列化器验证数据[如果是更新操作，需要传入2个参数，分别是instance和data]</span></span><br><span class="line">        serializer = BookInfoSerializer(instance=book,data=data)</span><br><span class="line">        serializer.is_valid()</span><br><span class="line">        book = serializer.save() <span class="comment"># 此时，我们必须在序列化器中预先声明update方法</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        serailzier对象调用的save方法是什么？怎么做到自动调用update和create?</span></span><br><span class="line"><span class="string">        1. 这里的save不是数据库ORM模型对象的save，是BaseSerializer定义的。</span></span><br><span class="line"><span class="string">        2. save方法中根据实例化serializer时是否传入instance参数来判断执行update还是create的</span></span><br><span class="line"><span class="string">           当传入instance时，则instance.save调用的就是update方法</span></span><br><span class="line"><span class="string">           没有传入instance，则instance.save调用的就是create方法</span></span><br><span class="line"><span class="string">        3. serializer.save使用前提是必须在序列化器中声明create或者update方法，否则报错！！！</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        print(book)</span><br><span class="line">        <span class="string">"""打印结果：</span></span><br><span class="line"><span class="string">        BookInfo object (2)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"ok"</span>)</span><br></pre></td></tr></table></figure>

<p>在序列化器实现了create和update两个方法后，在反序列化数据的时候，就可以通过save()方法返回一个数据对象实例了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book = serializer.save()</span><br></pre></td></tr></table></figure>

<p>如果创建序列化器对象的时候，没有传递instance实例，则调用save()方法的时候，create()被调用，相反，如果传递了instance实例，则调用save()方法的时候，update()被调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">serailzier对象调用的save方法是什么？怎么做到自动调用update和create?</span><br><span class="line"><span class="number">1.</span> 这里的save不是数据库ORM模型对象的save，是BaseSerializer定义的。</span><br><span class="line"><span class="number">2.</span> save方法中根据实例化serializer时是否传入instance参数来判断执行update还是create的</span><br><span class="line">当传入instance时，则instance.save调用的就是update方法</span><br><span class="line">没有传入instance，则instance.save调用的就是create方法</span><br><span class="line"><span class="number">3.</span> serializer.save使用前提是必须在序列化器中声明create或者update方法，否则报错！！！</span><br></pre></td></tr></table></figure>

<p>BaseSerializer中定义的save方法源码：</p>
<p><img src="/images/1582086563954.png" alt=""></p>
<h3 id="7-3-2-3-附加参数说明"><a href="#7-3-2-3-附加参数说明" class="headerlink" title="7.3.2.3 附加参数说明"></a>7.3.2.3 附加参数说明</h3><p>1） 在对序列化器进行save()保存时，可以额外传递数据，这些数据可以在create()和update()中的validated_data参数获取到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以传递任意参数到数据保存方法中</span></span><br><span class="line"><span class="comment"># 例如：request.user 是django中记录当前登录用户的模型对象</span></span><br><span class="line">serializer.save(owner=request.user)</span><br></pre></td></tr></table></figure>

<p>2）默认序列化器必须传递所有必填字段[required=True]，否则会抛出验证异常。但是我们可以使用partial参数来允许部分字段更新</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Update `BookInfo` with partial data</span></span><br><span class="line"><span class="comment"># partial=True 设置序列化器只是针对客户端提交的字段进行验证，没有提交的字段，即便有验证选项或方法也不进行验证。</span></span><br><span class="line">serializer = BookInfoSerializer(book, data=data, partial=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-3-模型类序列化器"><a href="#7-3-3-模型类序列化器" class="headerlink" title="7.3.3 模型类序列化器"></a>7.3.3 模型类序列化器</h3><p>如果我们想要使用序列化器对应的是Django的模型类，DRF为我们提供了ModelSerializer模型类序列化器来帮助我们快速创建一个Serializer类。</p>
<p>ModelSerializer与常规的Serializer相同，但提供了：</p>
<ul>
<li>基于模型类自动生成一系列序列化器字段</li>
<li>基于模型类自动为Serializer生成validators，比如unique_together</li>
<li>包含默认的create()和update()的实现</li>
</ul>
<h3 id="7-3-3-1-定义"><a href="#7-3-3-1-定义" class="headerlink" title="7.3.3.1 定义"></a>7.3.3.1 定义</h3><p>比如我们创建一个BookInfoSerializer</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="string">"""图书数据序列化器"""</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = <span class="string">'__all__'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>model 指明参照哪个模型类</li>
<li>fields 指明为模型类的哪些字段生成</li>
</ul>
<p>我们可以在python manage.py shell中查看自动生成的BookInfoSerializer的具体实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> booktest.serializers <span class="keyword">import</span> BookInfoSerializer</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>serializer = BookInfoSerializer()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>serializer</span><br><span class="line">BookInfoSerializer():</span><br><span class="line">    id = IntegerField(label=<span class="string">'ID'</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    btitle = CharField(label=<span class="string">'名称'</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    bpub_date = DateField(allow_null=<span class="literal">True</span>, label=<span class="string">'发布日期'</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bread = IntegerField(label=<span class="string">'阅读量'</span>, max_value=<span class="number">2147483647</span>, min_value=<span class="number">-2147483648</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bcomment = IntegerField(label=<span class="string">'评论量'</span>, max_value=<span class="number">2147483647</span>, min_value=<span class="number">-2147483648</span>, required=<span class="literal">False</span>)</span><br><span class="line">    image = ImageField(allow_null=<span class="literal">True</span>, label=<span class="string">'图片'</span>, max_length=<span class="number">100</span>, required=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-3-2-指定字段"><a href="#7-3-3-2-指定字段" class="headerlink" title="7.3.3.2 指定字段"></a>7.3.3.2 指定字段</h3><ul>
<li>使用<strong>fields</strong>来明确字段，<code>__all__</code>表名包含所有字段，也可以写明具体哪些字段，如</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="string">"""图书数据序列化器"""</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'btitle'</span>, <span class="string">'bpub_date'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<strong>exclude</strong>可以明确排除掉哪些字段</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="string">"""图书数据序列化器"""</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = BookInfo</span><br><span class="line">        exclude = (<span class="string">'image'</span>,)</span><br></pre></td></tr></table></figure>

<ul>
<li>显示指明字段，如：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroInfoSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    hbook = BookInfoSerializer()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = HeroInfo</span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'hname'</span>, <span class="string">'hgender'</span>, <span class="string">'hcomment'</span>, <span class="string">'hbook'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>指明只读字段</li>
</ul>
<p>可以通过<strong>read_only_fields</strong>指明只读字段，即仅用于序列化输出的字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="string">"""图书数据序列化器"""</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'title'</span>, <span class="string">'pub_date'</span>， <span class="string">'read'</span>, <span class="string">'comment'</span>)</span><br><span class="line">        read_only_fields = (<span class="string">'id'</span>, <span class="string">'read'</span>, <span class="string">'comment'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-3-3-添加额外参数"><a href="#7-3-3-3-添加额外参数" class="headerlink" title="7.3.3.3 添加额外参数"></a>7.3.3.3 添加额外参数</h3><p>我们可以使用<strong>extra_kwargs</strong>参数为ModelSerializer添加或修改原有的选项参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="string">"""图书数据序列化器"""</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'btitle'</span>, <span class="string">'bpub_date'</span>, <span class="string">'bread'</span>, <span class="string">'bcomment'</span>)</span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">'bread'</span>: &#123;<span class="string">'min_value'</span>: <span class="number">0</span>, <span class="string">'required'</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">            <span class="string">'bcomment'</span>: &#123;<span class="string">'min_value'</span>: <span class="number">0</span>, <span class="string">'required'</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># BookInfoSerializer():</span></span><br><span class="line"><span class="comment">#    id = IntegerField(label='ID', read_only=True)</span></span><br><span class="line"><span class="comment">#    btitle = CharField(label='名称', max_length=20)</span></span><br><span class="line"><span class="comment">#    bpub_date = DateField(allow_null=True, label='发布日期', required=False)</span></span><br><span class="line"><span class="comment">#    bread = IntegerField(label='阅读量', max_value=2147483647, min_value=0, required=True)</span></span><br><span class="line"><span class="comment">#    bcomment = IntegerField(label='评论量', max_value=2147483647, min_value=0, required=True)</span></span><br></pre></td></tr></table></figure>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Lupinus
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="http://yoursite.com/2020/04/22/%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8-Serializer/" title="[序列化器-Serializer]">http://yoursite.com/2020/04/22/序列化器-Serializer/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Django-Rest-Framework/" rel="tag"># Django Rest_Framework</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/04/22/API%E8%A7%84%E8%8C%83%E4%B8%8Edrf%E5%AE%89%E8%A3%85/" rel="prev" title="[restful API规范与DRF安装]">
      <i class="fa fa-chevron-left"></i> [restful API规范与DRF安装]
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/04/22/HTTP%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86/" rel="next" title="[HTTP请求处理]">
      [HTTP请求处理] <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#7-序列化器-Serializer"><span class="nav-number">1.</span> <span class="nav-text">7. 序列化器-Serializer</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-定义序列化器"><span class="nav-number">1.1.</span> <span class="nav-text">7.1 定义序列化器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-创建Serializer对象"><span class="nav-number">1.2.</span> <span class="nav-text">7.2 创建Serializer对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-序列化器的使用"><span class="nav-number">1.3.</span> <span class="nav-text">7.3 序列化器的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-1-序列化"><span class="nav-number">1.3.1.</span> <span class="nav-text">7.3.1 序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-1-1-基本使用"><span class="nav-number">1.3.2.</span> <span class="nav-text">7.3.1.1 基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-2-反序列化"><span class="nav-number">1.3.3.</span> <span class="nav-text">7.3.2 反序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-2-1-数据验证"><span class="nav-number">1.3.4.</span> <span class="nav-text">7.3.2.1 数据验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-validate-字段名"><span class="nav-number">1.3.5.</span> <span class="nav-text">1) validate_字段名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-validate"><span class="nav-number">1.3.6.</span> <span class="nav-text">2) validate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-validators验证器"><span class="nav-number">1.3.7.</span> <span class="nav-text">3) validators验证器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-2-2-数据保存"><span class="nav-number">1.3.8.</span> <span class="nav-text">7.3.2.2 数据保存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-2-3-附加参数说明"><span class="nav-number">1.3.9.</span> <span class="nav-text">7.3.2.3 附加参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-3-模型类序列化器"><span class="nav-number">1.3.10.</span> <span class="nav-text">7.3.3 模型类序列化器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-3-1-定义"><span class="nav-number">1.3.11.</span> <span class="nav-text">7.3.3.1 定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-3-2-指定字段"><span class="nav-number">1.3.12.</span> <span class="nav-text">7.3.3.2 指定字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-3-3-添加额外参数"><span class="nav-number">1.3.13.</span> <span class="nav-text">7.3.3.3 添加额外参数</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lupinus"
      src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/20160715144434_fZCsF.jpeg">
  <p class="site-author-name" itemprop="name">Lupinus</p>
  <div class="site-description" itemprop="description">Re：从零开始的go学习生活(｀・ω・´)</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/rogerXS80/roger" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rogerXS80&#x2F;roger" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/fastsword66@gmail.com" title="E-Mail → fastsword66@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5896791111/home?wvr=5&sudaref=graph.qq.com" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5896791111&#x2F;home?wvr&#x3D;5&amp;sudaref&#x3D;graph.qq.com" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

      
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <!-- 选择合适的icon -->
              <i class="fa fa-history fa-" aria-hidden="true"></i>
          <!-- 这里对应下文主题配置文件的recent_posts_title值 -->
              最近文章
            </div>
            <ul class="links-of-blogroll-list"> 
              <!-- 设置排序规格，此处我采用按照文章更新时间排序 -->
              
              <!-- 显示三条近期文章，请自信合理配置 -->
              
                <li>
                  <a href="/2021/01/21/Docker%E9%80%9A%E5%85%B3%E6%89%8B%E5%86%8C/" title="Docker通关手册" target="_blank">Docker通关手册</a>
                </li>
              
                <li>
                  <a href="/2020/07/27/IDEA%E6%80%BB%E7%BB%93/" title="[IDEA总结]" target="_blank">[IDEA总结]</a>
                </li>
              
                <li>
                  <a href="/2020/07/08/%E7%94%A8Hexo-Github%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" title="[用Hexo+Github搭建个人博客]" target="_blank">[用Hexo+Github搭建个人博客]</a>
                </li>
              
            </ul>
          </div>
      

      
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>




      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Roger</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div><!-- 文件位置：~/sourse/_data/footer.swig -->

<div class="weixin-box">
  <div class="weixin-menu">
    <div class="weixin-hover">
      <div class="weixin-description">微信扫一扫，订阅本博客</div>
    </div>
  </div>
</div>


        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="100" alpha="0.4" zIndex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

    </div>

<!-- 鼠标点击特效 -->
<script type="text/javascript" src="/js/fireworks.js"></script>

<!-- 点击爱心 
<script type="text/javascript" src="/js/clicklove.js"></script>
-->

</body>
</html>
