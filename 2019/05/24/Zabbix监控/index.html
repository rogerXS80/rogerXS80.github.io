<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="uW8bwgMGUwIA01nPfItoty1rmtmmuVkOVTeS9O0nAUg">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="监控系统是整个运维环节，乃至整个产品生命周期中最重要的一环，事前及时预警发现故障，事后提供翔实的数据用于追查定位问题...">
<meta property="og:type" content="article">
<meta property="og:title" content="[Zabbix监控]">
<meta property="og:url" content="http://yoursite.com/2019/05/24/Zabbix%E7%9B%91%E6%8E%A7/index.html">
<meta property="og:site_name" content="Lupinus">
<meta property="og:description" content="监控系统是整个运维环节，乃至整个产品生命周期中最重要的一环，事前及时预警发现故障，事后提供翔实的数据用于追查定位问题...">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/%E6%88%AA%E5%B1%8F2023-03-26%2013.35.41.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184827951.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184836414.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184918502.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184933463.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184942928.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/%E6%88%AA%E5%B1%8F2023-03-23%2018.50.56.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185011860.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185123575.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185136620.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185145541.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185202755.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185307403.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185319585.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185327755.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185403017.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185438919.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185534641.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185555823.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185753652.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190118340.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190030807.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190037922.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190135411.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190145589.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190150631.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190156600.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191705252.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191713120.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191753414.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191822357.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191829985.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191841956.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191914524.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191849876.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191929486.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191950794.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191959992.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192006404.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192200143.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192207041.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192213415.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192304091.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192309251.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192315802.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192339056.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192346364.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192417377.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192424927.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192447114.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192452878.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192501724.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192534890.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192541892.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192546666.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192604874.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192722785.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192728168.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192735423.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192745514.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192822589.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192828454.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192842454.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192858259.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192903808.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192923043.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193013139.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193017533.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193022705.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193027831.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193115833.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193109471.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193125905.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193149392.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193222292.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230254488.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230300411.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230305451.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230322170.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230326837.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230332051.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230352104.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230358107.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230402509.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230406702.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230420363.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230424729.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230430584.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230453056.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230501789.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230531241.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230723513.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230728525.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230743639.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230748084.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230752766.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230801363.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193629589.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193643276.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193648143.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193812116.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193816674.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193821139.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193829056.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193834210.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193841194.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193846541.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203220851.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203226763.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203242215.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203250464.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203255583.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203300125.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203308430.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203312586.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203336168.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203340716.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203411631.png">
<meta property="article:published_time" content="2019-05-24T08:37:44.000Z">
<meta property="article:modified_time" content="2019-05-25T07:39:24.000Z">
<meta property="article:author" content="Lupinus">
<meta property="article:tag" content="Linxu持续集成">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/%E6%88%AA%E5%B1%8F2023-03-26%2013.35.41.png">

<link rel="canonical" href="http://yoursite.com/2019/05/24/Zabbix%E7%9B%91%E6%8E%A7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[Zabbix监控] | Lupinus</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Lupinus" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lupinus</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Re：从零开始的go学习生活(｀・ω・´)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/rogerXS80" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/24/Zabbix%E7%9B%91%E6%8E%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/20160715144434_fZCsF.jpeg">
      <meta itemprop="name" content="Lupinus">
      <meta itemprop="description" content="Re：从零开始的go学习生活(｀・ω・´)">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lupinus">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Zabbix监控]
        </h1>

        <div class="post-meta">
          <!-- 置顶图标 -->
            <span class="post-meta-item">
              
              
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-24 16:37:44" itemprop="dateCreated datePublished" datetime="2019-05-24T16:37:44+08:00">2019-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-25 15:39:24" itemprop="dateModified" datetime="2019-05-25T15:39:24+08:00">2019-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SRE/" itemprop="url" rel="index"><span itemprop="name">SRE</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <div class="post-description">监控系统是整个运维环节，乃至整个产品生命周期中最重要的一环，事前及时预警发现故障，事后提供翔实的数据用于追查定位问题...</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Zabbix基础入门"><a href="#Zabbix基础入门" class="headerlink" title="Zabbix基础入门"></a>Zabbix基础入门</h1><h2 id="zabbix-快速入门安装"><a href="#zabbix-快速入门安装" class="headerlink" title="zabbix 快速入门安装"></a>zabbix 快速入门安装</h2><p><strong>C/S架构的服务</strong></p>
<ul>
<li><strong>服务端</strong>：zabbix-server</li>
<li><strong>客户端</strong>：zabbix-agent</li>
</ul>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/%E6%88%AA%E5%B1%8F2023-03-26%2013.35.41.png" alt="截屏2023-03-26 13.35.41"></p>
<p><strong>zabbix官网：</strong><a href="https://www.zabbix.com/" target="_blank" rel="noopener">https://www.zabbix.com/</a></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184827951.png" alt="image-20230323184827951"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184836414.png" alt="image-20230323184836414"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184918502.png" alt="image-20230323184918502"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.下载zabbix的yum源</span></span><br><span class="line">[root@m01 ~]<span class="comment"># rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.安装zabbix的服务端和客户端</span></span><br><span class="line">[root@m01 ~]<span class="comment"># yum install -y zabbix-server-mysql zabbix-agent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.下载zabbix前端web页面的yum源</span></span><br><span class="line">[root@m01 ~]<span class="comment"># yum install centos-release-scl -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.打开zabbix的yum源中的前端仓库</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/yum.repos.d/zabbix.repo </span></span><br><span class="line">[zabbix-frontend]</span><br><span class="line">name=Zabbix Official Repository frontend - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://repo.zabbix.com/zabbix/5.0/rhel/7/<span class="variable">$basearch</span>/frontend</span><br><span class="line">enabled=0    //  改为  1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.安装zabbix前端web页面</span></span><br><span class="line">[root@m01 ~]<span class="comment"># yum install zabbix-web-mysql-scl zabbix-nginx-conf-scl -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.初始化数据库</span></span><br><span class="line"><span class="comment">## 1）创建zabbix数据库</span></span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2）创建zabbix用户</span></span><br><span class="line">mysql&gt; grant all on zabbix.* to zabbix@<span class="string">'172.16.1.%'</span> identified by <span class="string">'123'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3）将zabbix的建表语句SQL文件发送到主库上</span></span><br><span class="line">[root@m01 ~]<span class="comment"># scp /usr/share/doc/zabbix-server-mysql-5.0.26/create.sql.gz  172.16.1.53:/tmp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 4）主库导入SQL文件</span></span><br><span class="line">[root@db01 ~]<span class="comment"># zcat /tmp/create.sql.gz |mysql -uzabbix -p123 -h172.16.1.53 zabbix</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.修改zabbix服务端配置文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/zabbix/zabbix_server.conf</span></span><br><span class="line">DBHost=172.16.1.53</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBPassword=123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.修改zabbix的nginx配置文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/opt/rh/rh-nginx116/nginx/conf.d/zabbix.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen          80;</span><br><span class="line">        server_name     zabbix.zls.com;</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.修改zabbix的php配置文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf </span></span><br><span class="line">[zabbix]</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">listen.acl_users = nginx</span><br><span class="line">php_value[date.timezone] = Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.1授权</span></span><br><span class="line">[root@m01 ~]<span class="comment"># chown -R root.nginx /var/opt/rh/rh-php72/lib/php/session/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.启动</span></span><br><span class="line">[root@m01 ~]<span class="comment"># systemctl restart zabbix-server zabbix-agent rh-nginx116-nginx rh-php72-php-fpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.查看端口</span></span><br><span class="line">[root@m01 ~]<span class="comment"># netstat -lntup|grep 10050</span></span><br><span class="line">tcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      102137/zabbix_agent </span><br><span class="line">tcp6       0      0 :::10050                :::*                    LISTEN      102137/zabbix_agent </span><br><span class="line">[root@m01 ~]<span class="comment"># netstat -lntup|grep 10051</span></span><br><span class="line">tcp        0      0 0.0.0.0:10051           0.0.0.0:*               LISTEN      102333/zabbix_serve </span><br><span class="line">tcp6       0      0 :::10051                :::*                    LISTEN      102333/zabbix_serve </span><br><span class="line"></span><br><span class="line"><span class="comment"># 12.授权</span></span><br><span class="line">[root@m01 ~]<span class="comment"># chown -R nginx.nginx /etc/zabbix/web</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184933463.png" alt="image-20230323184933463"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323184942928.png" alt="image-20230323184942928"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/%E6%88%AA%E5%B1%8F2023-03-23%2018.50.56.png" alt="截屏2023-03-23 18.50.56"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185011860.png" alt="image-20230323185011860"></p>
<h2 id="汉化zabbix"><a href="#汉化zabbix" class="headerlink" title="汉化zabbix"></a>汉化zabbix</h2><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185123575.png" alt="image-20230323185123575"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185136620.png" alt="image-20230323185136620"></p>
<h3 id="解决汉字无法显示问题"><a href="#解决汉字无法显示问题" class="headerlink" title="解决汉字无法显示问题"></a>解决汉字无法显示问题</h3><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185145541.png" alt="image-20230323185145541"></p>
<p>在windows中找到中文字体</p>
<p>C:\Windows\Fonts</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入zabbix字体路径</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cd /usr/share/zabbix/assets/fonts/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份zabbix默认字体</span></span><br><span class="line">[root@m01 fonts]<span class="comment"># mv graphfont.ttf graphfont.ttf.bak</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传电脑中的字体</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名</span></span><br><span class="line">[root@m01 fonts]<span class="comment"># mv FZSTK.TTF graphfont.ttf</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185202755.png" alt="image-20230323185202755"></p>
<h1 id="Zabbix监控入门"><a href="#Zabbix监控入门" class="headerlink" title="Zabbix监控入门"></a>Zabbix监控入门</h1><h2 id="为什么做监控"><a href="#为什么做监控" class="headerlink" title="为什么做监控"></a>为什么做监控</h2><p><strong>企业中：</strong></p>
<p>1.系统的监控:实际上是对系统不间断的实时监控<br>2.实时反馈系统当前状态:我们监控某个硬件、或者某个系统，都是需要能实时看到当前系统的状态，是正常、异常、或者故障。<br>3.保证服务可靠性安全性:我们监控的目的就是要保证系统、服务、业务正常运行<br>4.保证业务持续稳定运行:如果我们的监控做得很完善，即使出现故障，能第一时间接收到故障报警，在第一时间处理解决，从而保证业务持续性的稳定运行。（往往，第一时间知道业务宕机的都是用户）</p>
<h2 id="监控软件"><a href="#监控软件" class="headerlink" title="监控软件"></a>监控软件</h2><ul>
<li>CACTI  网络监控<ul>
<li>官网：<a href="https://www.cacti.net/" target="_blank" rel="noopener">https://www.cacti.net/</a></li>
</ul>
</li>
</ul>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185307403.png" alt="image-20230323185307403"></p>
<ul>
<li>Nagios<ul>
<li>官网：<a href="https://www.nagios.com/" target="_blank" rel="noopener">https://www.nagios.com/</a></li>
</ul>
</li>
</ul>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185319585.png" alt="image-20230323185319585"></p>
<ul>
<li>Zabbix  分布式监控系统</li>
</ul>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185327755.png" alt="image-20230323185327755"></p>
<ul>
<li>open-falcon<ul>
<li>官网：<a href="http://open-falcon.org/" target="_blank" rel="noopener">http://open-falcon.org/</a></li>
</ul>
</li>
</ul>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185403017.png" alt="image-20230323185403017"></p>
<ul>
<li><p>普罗米修斯 promtheus</p>
<ul>
<li>官网：<a href="https://prometheus.io/" target="_blank" rel="noopener">https://prometheus.io/</a></li>
</ul>
</li>
<li><p>天兔</p>
<ul>
<li>官网：<a href="https://www.lepus.cc/docs/lepus-v5/install/" target="_blank" rel="noopener">https://www.lepus.cc/docs/lepus-v5/install/</a></li>
</ul>
</li>
</ul>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185438919.png" alt="image-20230323185438919"></p>
<h2 id="面试问题"><a href="#面试问题" class="headerlink" title="面试问题"></a>面试问题</h2><p>面试官：你们公司监控是如何做的？</p>
<p>监控软件我们使用的是zabbix，我们监控在不同的维度</p>
<ul>
<li><p>硬件层面   Dell R710 R720 R730</p>
<ul>
<li><p>如果不使用dell的idrac那就使用zabbix的<code>IPMI</code>接口监控硬件</p>
<p>1）CPU温度，<br>2）风扇转速，<br>3）磁盘是否损坏，<br>4）CMOS电池电量<br>5）内存是否损坏</p>
<p>…..</p>
</li>
<li><p>云主机，不需要说硬件层，一般云主机都自带，硬件监控</p>
</li>
</ul>
</li>
<li><p>系统层面</p>
<ul>
<li>内存<ul>
<li>内存使用率</li>
<li>缓冲区</li>
<li>缓存区</li>
<li>堆</li>
<li>栈</li>
</ul>
</li>
<li>CPU<ul>
<li>CPU使用率</li>
<li>CPU的负载</li>
<li>CPU核心数线程</li>
</ul>
</li>
<li>磁盘<ul>
<li>磁盘使用率</li>
<li>磁盘大小</li>
<li>磁盘IO</li>
</ul>
</li>
</ul>
</li>
<li><p>网络层面</p>
<ul>
<li>网卡接口</li>
<li>网卡流量</li>
<li>交换机</li>
<li>路由器</li>
</ul>
</li>
<li><p>应用层面</p>
<ul>
<li>nginx<ul>
<li>进程</li>
<li>端口</li>
<li>网站访问</li>
</ul>
</li>
<li>MySQL<ul>
<li>进程</li>
<li>端口</li>
<li>主从复制</li>
<li>SQL读写速率</li>
<li>是否可以登录</li>
<li>InnoDB</li>
<li>缓存</li>
<li>表空间</li>
<li>慢查询</li>
</ul>
</li>
<li>tomcat<ul>
<li>JMX<ul>
<li>老年代</li>
<li>新生代</li>
<li>永久代</li>
</ul>
</li>
<li>垃圾回收</li>
<li>full-gc</li>
<li>进程</li>
<li>端口</li>
<li>网站是否可以访问</li>
</ul>
</li>
<li>redis<ul>
<li>进程</li>
<li>端口</li>
<li>连接状态</li>
<li>主从复制  info</li>
<li>集群状态</li>
<li>key，缓存<ul>
<li>缓存穿透</li>
<li>缓存击穿</li>
<li>缓存雪崩</li>
</ul>
</li>
</ul>
</li>
<li>NFS、GFS（集群式的NFS）、Ceph、FastDFS<ul>
<li>进程</li>
<li>挂载情况</li>
<li>数据同步</li>
</ul>
</li>
<li>PHP<ul>
<li>进程</li>
<li>端口（socket）</li>
<li>网站访问情况</li>
<li>php info</li>
<li>….</li>
</ul>
</li>
</ul>
</li>
<li><p>业务层面</p>
<ul>
<li>代码</li>
<li>接口</li>
</ul>
</li>
</ul>
<h2 id="单机监控命令"><a href="#单机监控命令" class="headerlink" title="单机监控命令"></a>单机监控命令</h2><h3 id="CPU监控命令"><a href="#CPU监控命令" class="headerlink" title="CPU监控命令"></a>CPU监控命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 负载</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># w</span></span><br><span class="line">18:50:38 up  2:03,  3 users,  load average: 0.01, 0.06, 0.06</span><br><span class="line"></span><br><span class="line"><span class="comment">## CPU</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># top -n 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 美化的top</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># yum install -y htop</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># htop</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## glances</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># yum install -y glances</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># glances</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185534641.png" alt="image-20230323185534641"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server ~]<span class="comment"># uptime</span></span><br><span class="line"> 18:59:32 up  2:12,  3 users,  load average: 0.00, 0.06, 0.06</span><br><span class="line"> </span><br><span class="line">[root@zabbix-server ~]<span class="comment"># lscpu</span></span><br><span class="line">Architecture:          x86_64</span><br><span class="line">CPU op-mode(s):        32-bit, 64-bit</span><br><span class="line">Byte Order:            Little Endian</span><br><span class="line">CPU(s):                1</span><br><span class="line">On-line CPU(s) list:   0</span><br><span class="line">Thread(s) per core:    1</span><br><span class="line">Core(s) per socket:    1</span><br><span class="line">Socket(s):             1</span><br><span class="line">NUMA node(s):          1</span><br><span class="line">Vendor ID:             GenuineIntel</span><br><span class="line">CPU family:            6</span><br><span class="line">Model:                 158</span><br><span class="line">Model name:            Intel(R) Core(TM) i5-7400 CPU @ 3.00GHz</span><br><span class="line">Stepping:              9</span><br><span class="line">CPU MHz:               3000.001</span><br><span class="line">CPU max MHz:           0.0000</span><br><span class="line">CPU min MHz:           0.0000</span><br><span class="line">BogoMIPS:              6000.00</span><br><span class="line">Hypervisor vendor:     VMware</span><br><span class="line">Virtualization <span class="built_in">type</span>:   full</span><br><span class="line">L1d cache:             32K</span><br><span class="line">L1i cache:             32K</span><br><span class="line">L2 cache:              256K</span><br><span class="line">L3 cache:              6144K</span><br><span class="line">NUMA node0 CPU(s):     0</span><br><span class="line">Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts nopl xtopology tsc_reliable nonstop_tsc aperfmperf eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch epb fsgsbase tsc_adjust bmi1 avx2 smep bmi2 invpcid rdseed adx smap xsaveopt xsavec xgetbv1 dtherm ida arat pln pts hwp hwp_notify hwp_act_window hwp_epp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># cat /proc/cpuinfo </span></span><br><span class="line">processor	: 0</span><br><span class="line">vendor_id	: GenuineIntel</span><br><span class="line">cpu family	: 6</span><br><span class="line">model		: 158</span><br><span class="line">model name	: Intel(R) Core(TM) i5-7400 CPU @ 3.00GHz</span><br><span class="line">stepping	: 9</span><br><span class="line">microcode	: 0x8e</span><br><span class="line">cpu MHz		: 3000.001</span><br><span class="line">cache size	: 6144 KB</span><br><span class="line">physical id	: 0</span><br><span class="line">siblings	: 1</span><br><span class="line">core id		: 0</span><br><span class="line">cpu cores	: 1</span><br><span class="line">apicid		: 0</span><br><span class="line">initial apicid	: 0</span><br><span class="line">fpu		: yes</span><br><span class="line">fpu_exception	: yes</span><br><span class="line">cpuid level	: 22</span><br><span class="line">wp		: yes</span><br><span class="line">flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts nopl xtopology tsc_reliable nonstop_tsc aperfmperf eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch epb fsgsbase tsc_adjust bmi1 avx2 smep bmi2 invpcid rdseed adx smap xsaveopt xsavec xgetbv1 dtherm ida arat pln pts hwp hwp_notify hwp_act_window hwp_epp</span><br><span class="line">bogomips	: 6000.00</span><br><span class="line">clflush size	: 64</span><br><span class="line">cache_alignment	: 64</span><br><span class="line">address sizes	: 42 bits physical, 48 bits virtual</span><br><span class="line">power management:</span><br></pre></td></tr></table></figure>

<p>不管用什么命令监控，查看CPU，我们都必须了解，系统的用户态和内和态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line"></span><br><span class="line">us: 用户态     跟用户的操作有关35%</span><br><span class="line">sy: 内和态     跟内核的处理有关65%</span><br><span class="line">id: CPU空闲</span><br><span class="line"></span><br><span class="line">当我们执行一个命令的时候，很快能出来结果，但是有多少人知道，这个很快，他都占用了哪些时间呢？</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># time ls</span></span><br><span class="line">anaconda-ks.cfg                      zabbix-server-mysql-4.0.0-2.el7.x86_64.rpm</span><br><span class="line">zabbix-agent-4.0.0-2.el7.x86_64.rpm  zabbix-web-mysql-4.0.0-2.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">real	0m0.032s</span><br><span class="line">user	0m0.002s</span><br><span class="line">sys	0m0.005s</span><br></pre></td></tr></table></figure>

<h3 id="监控内存"><a href="#监控内存" class="headerlink" title="监控内存"></a>监控内存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">1）free</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># free -g</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:              0           0           0           0           0           0</span><br><span class="line">Swap:             0           0           0</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># free -m</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            972         234         158           8         579         528</span><br><span class="line">Swap:          1023           0        1023</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># free -h</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           972M        234M        158M        8.4M        579M        528M</span><br><span class="line">Swap:          1.0G        264K        1.0G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2）top</span><br><span class="line">3）glances</span><br><span class="line">4）htop</span><br><span class="line"></span><br><span class="line">5）lsmem</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># lsmem</span></span><br><span class="line">RANGE                                 SIZE  STATE REMOVABLE BLOCK</span><br><span class="line">0x0000000000000000-0x000000003fffffff   1G online        no   0-7</span><br><span class="line"></span><br><span class="line">Memory block size:       128M</span><br><span class="line">Total online memory:       1G</span><br><span class="line">Total offline memory:      0B</span><br><span class="line"></span><br><span class="line">6）cat /proc/meminfo</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># cat /proc/meminfo</span></span><br><span class="line">MemTotal:         995896 kB</span><br><span class="line">MemFree:          159908 kB</span><br><span class="line">MemAvailable:     541596 kB</span><br><span class="line">Buffers:             116 kB</span><br><span class="line">Cached:           489248 kB</span><br><span class="line">SwapCached:            4 kB</span><br><span class="line">Active:           418768 kB</span><br><span class="line">Inactive:         227568 kB</span><br><span class="line">Active(anon):     137052 kB</span><br><span class="line">Inactive(anon):    28476 kB</span><br><span class="line">Active(file):     281716 kB</span><br><span class="line">Inactive(file):   199092 kB</span><br><span class="line">Unevictable:           0 kB</span><br><span class="line">Mlocked:               0 kB</span><br><span class="line">SwapTotal:       1048572 kB</span><br><span class="line">SwapFree:        1048308 kB</span><br><span class="line">Dirty:                20 kB</span><br><span class="line">Writeback:             0 kB</span><br><span class="line">AnonPages:        157000 kB</span><br><span class="line">Mapped:            33420 kB</span><br><span class="line">Shmem:              8556 kB</span><br><span class="line">Slab:             107040 kB</span><br><span class="line">SReclaimable:      57164 kB</span><br><span class="line">SUnreclaim:        49876 kB</span><br><span class="line">KernelStack:        4752 kB</span><br><span class="line">PageTables:        22648 kB</span><br><span class="line">NFS_Unstable:          0 kB</span><br><span class="line">Bounce:                0 kB</span><br><span class="line">WritebackTmp:          0 kB</span><br><span class="line">CommitLimit:     1546520 kB</span><br><span class="line">Committed_AS:     928904 kB</span><br><span class="line">VmallocTotal:   34359738367 kB</span><br><span class="line">VmallocUsed:      177304 kB</span><br><span class="line">VmallocChunk:   34359310332 kB</span><br><span class="line">HardwareCorrupted:     0 kB</span><br><span class="line">AnonHugePages:     51200 kB</span><br><span class="line">CmaTotal:              0 kB</span><br><span class="line">CmaFree:               0 kB</span><br><span class="line">HugePages_Total:       0</span><br><span class="line">HugePages_Free:        0</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">DirectMap4k:       57216 kB</span><br><span class="line">DirectMap2M:      991232 kB</span><br><span class="line">DirectMap1G:           0 kB</span><br></pre></td></tr></table></figure>

<p>如何查看单个进程占用内存？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进程占用内存公式</span></span><br><span class="line">pmem = VmRSS / MemTotal * 100</span><br><span class="line">process mem = 虚拟内存 / 总内存 * 100</span><br></pre></td></tr></table></figure>

<h3 id="python脚本获取进程使用内存情况"><a href="#python脚本获取进程使用内存情况" class="headerlink" title="python脚本获取进程使用内存情况"></a>python脚本获取进程使用内存情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server ~]<span class="comment"># cat mem.py </span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># _*_ coding:UTF-8 _*_</span></span><br><span class="line"><span class="comment"># 收集程序所占用的物理内存大小，占所有物理内存的比例</span></span><br><span class="line"><span class="comment"># Python: 2.7.6</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">from subprocess import Popen,PIPE</span><br><span class="line"></span><br><span class="line">def get_pid(program):</span><br><span class="line">    <span class="string">'获取目标程序的PID列表'</span></span><br><span class="line">    p = Popen([<span class="string">'pidof'</span>,program],stdout=PIPE,stderr=PIPE)</span><br><span class="line">    pids,stderrput = p.communicate()</span><br><span class="line"><span class="comment">#     pids = p.stdout.read()  #这种方法也是可以的</span></span><br><span class="line"><span class="comment">#     这里也可以对stderrput来进行判断</span></span><br><span class="line">    <span class="keyword">if</span> pids:</span><br><span class="line">        <span class="built_in">return</span> pids.split()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        raise ValueError</span><br><span class="line"></span><br><span class="line">def mem_calc(pids):</span><br><span class="line">    <span class="string">'计算PIDs占用的内存大小'</span></span><br><span class="line">    mem_total = 0</span><br><span class="line">    <span class="keyword">for</span> pid <span class="keyword">in</span> pids:</span><br><span class="line">        os.chdir(<span class="string">'/proc/%s'</span> % pid)</span><br><span class="line">        with open(<span class="string">'status'</span>) as fd:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> fd:</span><br><span class="line">                <span class="keyword">if</span> line.startswith(<span class="string">'VmRSS'</span>):</span><br><span class="line">                    mem = line.strip().split()[1]</span><br><span class="line">                    mem_total += int(mem)</span><br><span class="line">                    <span class="built_in">break</span></span><br><span class="line">    <span class="built_in">return</span> mem_total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def mem_percent(mem):</span><br><span class="line">    <span class="string">'计算程序内存占用物理内存的百分比'</span></span><br><span class="line">    with open(<span class="string">'/proc/meminfo'</span>) as fd:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fd:</span><br><span class="line">            <span class="keyword">if</span> line.startswith(<span class="string">'MemTotal'</span>):</span><br><span class="line">                total = line.strip().split()[1]</span><br><span class="line">        percent = (<span class="built_in">float</span>(mem)/int(total)) * 100</span><br><span class="line">    <span class="built_in">return</span> percent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    try:</span><br><span class="line">        program = sys.argv[1]</span><br><span class="line">        pids = get_pid(program)</span><br><span class="line">    except IndexError as e:</span><br><span class="line">        sys.exit(<span class="string">'%s need a Program name '</span> % __file__)</span><br><span class="line">    except ValueError as e:</span><br><span class="line">        sys.exit(<span class="string">'%s not a Process Name or not Start'</span> % program )</span><br><span class="line">    mem_total = mem_calc(pids)</span><br><span class="line">    percent = mem_percent(mem_total)</span><br><span class="line">    <span class="built_in">return</span> program,mem_total,percent</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    program,mem_total,mem_percent=main()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'进程名称:%s\n物理内存为:%s\n百分比为:%.2f%%'</span>% (program,mem_total,mem_percent))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># python mem.py  zabbix_agentd</span></span><br><span class="line">进程名称:zabbix_agentd</span><br><span class="line">物理内存为:12332</span><br><span class="line">百分比为:1.24%</span><br><span class="line"></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># python mem.py  zabbix_server</span></span><br><span class="line">进程名称:zabbix_server</span><br><span class="line">物理内存为:115300</span><br><span class="line">百分比为:11.58%</span><br><span class="line"></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># python mem.py  httpd</span></span><br><span class="line">进程名称:httpd</span><br><span class="line">物理内存为:212148</span><br><span class="line">百分比为:21.30%</span><br></pre></td></tr></table></figure>

<h3 id="监控磁盘命令"><a href="#监控磁盘命令" class="headerlink" title="监控磁盘命令"></a>监控磁盘命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1）df</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># df -i</span></span><br><span class="line">Filesystem      Inodes IUsed   IFree IUse% Mounted on</span><br><span class="line">/dev/sda3      9704960 38522 9666438    1% /</span><br><span class="line">devtmpfs        121762   377  121385    1% /dev</span><br><span class="line">tmpfs           124487     1  124486    1% /dev/shm</span><br><span class="line">tmpfs           124487   746  123741    1% /run</span><br><span class="line">tmpfs           124487    16  124471    1% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       256000   326  255674    1% /boot</span><br><span class="line">tmpfs           124487     1  124486    1% /run/user/0</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        19G  1.6G   17G   9% /</span><br><span class="line">devtmpfs        476M     0  476M   0% /dev</span><br><span class="line">tmpfs           487M     0  487M   0% /dev/shm</span><br><span class="line">tmpfs           487M  7.8M  479M   2% /run</span><br><span class="line">tmpfs           487M     0  487M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       497M  120M  378M  25% /boot</span><br><span class="line">tmpfs            98M     0   98M   0% /run/user/0</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># df -ih</span></span><br><span class="line">Filesystem     Inodes IUsed IFree IUse% Mounted on</span><br><span class="line">/dev/sda3        9.3M   38K  9.3M    1% /</span><br><span class="line">devtmpfs         119K   377  119K    1% /dev</span><br><span class="line">tmpfs            122K     1  122K    1% /dev/shm</span><br><span class="line">tmpfs            122K   746  121K    1% /run</span><br><span class="line">tmpfs            122K    16  122K    1% /sys/fs/cgroup</span><br><span class="line">/dev/sda1        250K   326  250K    1% /boot</span><br><span class="line">tmpfs            122K     1  122K    1% /run/user/0</span><br><span class="line"></span><br><span class="line">2）iotop查看进程对磁盘的使用情况，IO吞吐量情况</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># iotop </span></span><br><span class="line">Total DISK READ :	0.00 B/s | Total DISK WRITE :       0.00 B/s</span><br><span class="line">Actual DISK READ:	0.00 B/s | Actual DISK WRITE:       0.00 B/s</span><br><span class="line"></span><br><span class="line">3）查看磁盘的IO吞吐量</span><br><span class="line">-d：指定多久出一次结果 单位是秒</span><br><span class="line">-m：指定出几次结果</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># iostat -dm 1 10</span></span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (zabbix-server) 	08/23/2022 	_x86_64_	(1 CPU)</span><br><span class="line"></span><br><span class="line">Device:            tps    MB_read/s    MB_wrtn/s    MB_read    MB_wrtn</span><br><span class="line">scd0              0.00         0.00         0.00          1          0</span><br><span class="line">sda               2.17         0.03         0.07        284        607</span><br><span class="line"></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># yum install -y dstat</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># dstat -cdngy</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185555823.png" alt="image-20230323185555823"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">5）glances</span><br><span class="line">6）lsblk</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># lsblk </span></span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0   20G  0 disk </span><br><span class="line">├─sda1   8:1    0  500M  0 part /boot</span><br><span class="line">├─sda2   8:2    0    1G  0 part [SWAP]</span><br><span class="line">└─sda3   8:3    0 18.5G  0 part /</span><br><span class="line">sr0     11:0    1  4.3G  0 rom  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 磁盘开机自动挂载</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># vim /etc/fstab </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建一块新磁盘</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># dd &lt; /dev/zero &gt; /disk1 bs=1024K count=5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 格式化</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># mkfs.ext4 -i 5120 /disk1 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 挂载</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># mount -t ext4 -o loop  /disk1  /opt/cipan1/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># df -h</span></span><br><span class="line">/dev/loop0      3.9M   53K  3.5M   2% /opt/cipan1</span><br><span class="line"></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">UUID=b2503fb9-fc5e-47fc-b86a-d171a5fbf689 /opt/cipan1             ext4    defaults        0 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看一块磁盘的UUID</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># blkid /dev/sda1</span></span><br><span class="line">/dev/sda1: UUID=<span class="string">"33bce62e-082b-4647-8b36-9335a0cc6600"</span> TYPE=<span class="string">"xfs"</span> </span><br><span class="line">[root@zabbix-server ~]<span class="comment"># blkid /dev/sda3</span></span><br><span class="line">/dev/sda3: UUID=<span class="string">"9e1a4ad0-69bf-4b9e-9aa0-4820ec625963"</span> TYPE=<span class="string">"xfs"</span> </span><br><span class="line">[root@zabbix-server ~]<span class="comment"># blkid /dev/loop0</span></span><br><span class="line">/dev/loop0: UUID=<span class="string">"b2503fb9-fc5e-47fc-b86a-d171a5fbf689"</span> TYPE=<span class="string">"ext4"</span></span><br></pre></td></tr></table></figure>

<h3 id="网络监控命令"><a href="#网络监控命令" class="headerlink" title="网络监控命令"></a>网络监控命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1）glances</span><br><span class="line">NETWORK     Rx/s   Tx/s </span><br><span class="line">eth0        592b   15Kb</span><br><span class="line">eth1        17Kb   13Kb </span><br><span class="line">lo            0b     0b </span><br><span class="line"></span><br><span class="line">2）iftop</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># iftop</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323185753652.png" alt="image-20230323185753652"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">3）nethogs</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># yum install -y nethogs</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># nethogs</span></span><br><span class="line"></span><br><span class="line">4) ifconfig</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># watch ifconfig</span></span><br><span class="line"></span><br><span class="line">5）路由</span><br><span class="line">[root@zabbix-server ~]<span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.0.0.2        0.0.0.0         UG    0      0        0 eth0</span><br><span class="line">10.0.0.0        0.0.0.0         255.255.255.0   U     0      0        0 eth0</span><br><span class="line">169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0</span><br><span class="line">169.254.0.0     0.0.0.0         255.255.0.0     U     1003   0        0 eth1</span><br><span class="line">172.16.1.0      0.0.0.0         255.255.255.0   U     0      0        0 eth1</span><br></pre></td></tr></table></figure>

<h3 id="TCP11种状态监控命令"><a href="#TCP11种状态监控命令" class="headerlink" title="TCP11种状态监控命令"></a>TCP11种状态监控命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># netstat</span></span><br><span class="line"><span class="comment"># 查看当前服务器上的所有应用TCP状态</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># netstat -an</span></span><br><span class="line"></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># netstat -an|awk '/^tcp/ &#123;print $NF&#125;'|sort|uniq -c</span></span><br><span class="line">     26 ESTABLISHED</span><br><span class="line">     11 LISTEN</span><br><span class="line">     48 TIME_WAIT</span><br><span class="line"></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># netstat -an|awk '/^tcp/ &#123;++state[$NF]&#125; END &#123;for(key in state) print key," \t" ,state[key]&#125;'</span></span><br><span class="line">LISTEN  	 11</span><br><span class="line">ESTABLISHED  	 25</span><br><span class="line">FIN_WAIT2  	 1</span><br><span class="line">TIME_WAIT  	 53</span><br></pre></td></tr></table></figure>

<h2 id="生产场景需求"><a href="#生产场景需求" class="headerlink" title="生产场景需求"></a>生产场景需求</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如何每1分钟监控当前系统的内存使用状态，如果可用低于100MB则发送邮件。同时打印当前还剩余多少内存</span></span><br><span class="line">1.如何获取内存的状态信息 free -m</span><br><span class="line">2.如何获取内存的可用状态 free -m|awk <span class="string">'/Mem/&#123;print $NF&#125;'</span></span><br><span class="line">3.如何进行数字的比对，高于100MB不处理，低于100MB，发送邮件。</span><br><span class="line">4.如何每分钟执行。</span><br><span class="line"></span><br><span class="line">[root@web02 ~]<span class="comment"># vim free.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  free_av=$(free -m|awk <span class="string">'/^Mem/&#123;print $NF&#125;'</span>)</span><br><span class="line">  Hostname=$(hostname)_$(hostname -I|awk <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line">  Date=$(date +%F)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$free_av</span> -lt 100 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$Date</span>: <span class="variable">$&#123;Hostname&#125;</span>,内存低于100MB，还有<span class="variable">$&#123;free_av&#125;</span>MB内存可用"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">      sleep 2</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@web02 ~]<span class="comment"># sh free.sh</span></span><br><span class="line">2018-10-12: web02_,内存低于100MB，还有20MB内存可用</span><br><span class="line">2018-10-12: web02_,内存低于100MB，还有6MB内存可用</span><br><span class="line">2018-10-12: web02_,内存低于100MB，还有5MB内存可用</span><br></pre></td></tr></table></figure>

<h3 id="系统的oom"><a href="#系统的oom" class="headerlink" title="系统的oom"></a>系统的oom</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 关闭swap</span></span><br><span class="line">[root@zabbix-server ~]<span class="comment"># swapoff -a</span></span><br><span class="line">随着时间的推移，用户不断增多，服务消耗的内存越来越多，当系统内存不足的时候，可能会导致系统产生oom（out of memory）</span><br><span class="line"></span><br><span class="line">1.当系统内存不足时就会大量使用swap（虚拟内存）</span><br><span class="line">2.当系统大量使用swap的时候，系统会特别卡</span><br><span class="line">注意：有时可能内存还有剩余300M或者500M，但是swap依然被使用</span><br><span class="line"></span><br><span class="line">[root@web02 ~]<span class="comment"># dd &lt; /dev/zero &gt; /dev/null bs=2000M</span></span><br><span class="line"></span><br><span class="line">[root@web02 ~]<span class="comment"># tail -f /var/log/messages</span></span><br><span class="line">Out of memory: Kill process 29957 (dd) score 366 or sacrifice child</span><br><span class="line">Killed process 29957 (dd) total-vm:2532680kB, anon-rss:1416508kB, filers:0kB</span><br><span class="line"></span><br><span class="line">Aug 23 20:18:27 localhost kernel: Out of memory: Kill process 22208 (dd) score 599 or sacrifice child</span><br><span class="line">Aug 23 20:18:27 localhost kernel: Killed process 22208 (dd) total-vm:722512kB, anon-rss:614508kB, file-rss:0kB, shmem-rss:0kB</span><br></pre></td></tr></table></figure>

<h3 id="使用脚本监控nginx"><a href="#使用脚本监控nginx" class="headerlink" title="使用脚本监控nginx"></a>使用脚本监控nginx</h3><p>前面的课程中，我们学习了使用脚本+定时任务的方法自动备份并将检查结果，发到指定邮箱,那么这里，我也可以使用脚本+定时任务的方法，进行监控，并使用邮件报警</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">nginx_process=`ps -ef|grep -c [n]ginx`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$nginx_process</span> -lt 2 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"目前nginx进程数是：<span class="variable">$nginx_process</span>"</span>|mail -s <span class="string">"完犊子nginx挂了"</span> 133411023@qq.com</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h1 id="Zabbix自定义监控项"><a href="#Zabbix自定义监控项" class="headerlink" title="Zabbix自定义监控项"></a>Zabbix自定义监控项</h1><h2 id="快速监控一台主机"><a href="#快速监控一台主机" class="headerlink" title="快速监控一台主机"></a>快速监控一台主机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看服务端的版本</span></span><br><span class="line">[root@m01 fonts]<span class="comment"># zabbix_server -V</span></span><br><span class="line">zabbix_server (Zabbix) 5.0.26</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装对应版本的agent客户端</span></span><br><span class="line"><span class="comment"># 1.在其他机器上，安装zabbix的yum源</span></span><br><span class="line">[root@db03 ~]<span class="comment"># rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.安装客户端</span></span><br><span class="line">[root@db03 ~]<span class="comment"># yum install -y zabbix-agent-5.0.26</span></span><br><span class="line">[root@web01 ~]<span class="comment"># rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-agent-5.0.26-1.el7.x86_64.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.修改配置文件</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/zabbix/zabbix_agentd.conf</span></span><br><span class="line">Server=172.16.1.61</span><br><span class="line">ServerActive=172.16.1.61</span><br><span class="line">Hostname=web01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.启动服务</span></span><br><span class="line">[root@web01 ~]<span class="comment"># systemctl start zabbix-agent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.检查端口</span></span><br><span class="line">[root@web01 ~]<span class="comment"># netstat -lntup |grep 10050</span></span><br><span class="line">tcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      7681/zabbix_agentd  </span><br><span class="line">tcp6       0      0 :::10050                :::*                    LISTEN      7681/zabbix_agentd</span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190118340.png" alt="image-20230323190118340"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190030807.png" alt="image-20230323190030807"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190037922.png" alt="image-20230323190037922"></p>
<h3 id="添加基础模板"><a href="#添加基础模板" class="headerlink" title="添加基础模板"></a>添加基础模板</h3><p>zabbix3.x 和 zabbix4.x</p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190135411.png" alt="image-20230323190135411"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190145589.png" alt="image-20230323190145589"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190150631.png" alt="image-20230323190150631"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323190156600.png" alt="image-20230323190156600"></p>
<h2 id="zabbix报错排查"><a href="#zabbix报错排查" class="headerlink" title="zabbix报错排查"></a>zabbix报错排查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.检查端口</span></span><br><span class="line">[root@zabbix ~]<span class="comment"># telnet 172.16.1.7 10050</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.服务端是否能获取到客户端的监控数据</span></span><br><span class="line">[root@zabbix ~]<span class="comment"># yum install -y zabbix-get-5.0.32</span></span><br><span class="line">-s：指定主机IP地址</span><br><span class="line">-k：指定监控项名称</span><br><span class="line">[root@zabbix ~]<span class="comment"># zabbix_get -s 172.16.1.7 -k system.swap.size[,pfree]</span></span><br><span class="line">100.000000</span><br><span class="line">[root@zabbix ~]<span class="comment"># zabbix_get -s 172.16.1.7 -k system.swap.size[,free]</span></span><br><span class="line">1073737728</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.查看nginx日志</span></span><br><span class="line">[root@zabbix ~]<span class="comment"># tail -f /var/opt/rh/rh-nginx116/log/nginx/error.log</span></span><br><span class="line">[root@zabbix ~]<span class="comment"># tail -f /var/opt/rh/rh-nginx116/log/nginx/access.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.查看zabbix-server日志</span></span><br><span class="line">[root@zabbix ~]<span class="comment"># tail -f /var/log/zabbix/zabbix_server.log </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5.查看zabbix-agent日志</span></span><br><span class="line">[root@zabbix ~]<span class="comment"># tail -f /var/log/zabbix/zabbix_agentd.log</span></span><br></pre></td></tr></table></figure>

<h2 id="zabbix基础架构"><a href="#zabbix基础架构" class="headerlink" title="zabbix基础架构"></a>zabbix基础架构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">zabbix-agent：获取本机上的数据（主动上交给server）</span><br><span class="line">zabbix-server：获取所有agent上的数据，并保存到数据库中  create.sql.gz</span><br><span class="line">	- 1.systemctl stop zabbix-server</span><br><span class="line">	- 2.drop database zabbix;</span><br><span class="line">	- 3.creaete database zabbix charset utf8 collate utf8_bin;</span><br><span class="line">	- 4.zcat create.sql.gz| mysql -uzabbix -p123 zabbix</span><br><span class="line">	- 5.rm -f zabbix.conf.php</span><br><span class="line">	- 6.http://zabbix.zls.com/setup.php   // 重新进入配置页面</span><br><span class="line">zabbix-web：页面展示，从数据库中获取数据，展示到页面上</span><br></pre></td></tr></table></figure>

<h2 id="自定义zabbix监控"><a href="#自定义zabbix监控" class="headerlink" title="自定义zabbix监控"></a>自定义zabbix监控</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 监控项添加流程</span></span><br><span class="line">1.创建一个模板</span><br><span class="line">2.给模板添加监控项</span><br><span class="line">3.给监控项画图</span><br><span class="line">4.给监控项添加触发器</span><br><span class="line">5.给监控项的触发器添加告警动作</span><br><span class="line">	- 邮件</span><br><span class="line">	- 微信</span><br><span class="line">	- 钉钉</span><br></pre></td></tr></table></figure>

<h3 id="自定义监控项的格式"><a href="#自定义监控项的格式" class="headerlink" title="自定义监控项的格式"></a>自定义监控项的格式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UserParameter=监控项的key名称,获取监控项值的命令或脚本</span><br><span class="line">UserParameter=&lt;key&gt;,&lt;shell <span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取登陆用户数量</span></span><br><span class="line">UserParameter=user.count,who | wc -l</span><br><span class="line">或</span><br><span class="line">UserParameter=user.count,uptime|grep -Po <span class="string">"\d(?= user)"</span></span><br></pre></td></tr></table></figure>

<h3 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.修改配置</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/zabbix/zabbix_agentd.conf</span></span><br><span class="line">UserParameter=user.count,who | wc -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.重启zabbix-agent</span></span><br><span class="line">[root@web01 ~]<span class="comment"># systemctl restart zabbix-agent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.在服务端获取一下该监控项的数据</span></span><br><span class="line">[root@web01 ~]<span class="comment"># yum install -y zabbix-get</span></span><br><span class="line">[root@web01 ~]<span class="comment"># zabbix_get -s 172.16.1.31 -k user.count</span></span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h3 id="页面添加监控项"><a href="#页面添加监控项" class="headerlink" title="页面添加监控项"></a>页面添加监控项</h3><h4 id="自己创建一个监控模板"><a href="#自己创建一个监控模板" class="headerlink" title="自己创建一个监控模板"></a>自己创建一个监控模板</h4><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191705252.png" alt="image-20230323191705252"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191713120.png" alt="image-20230323191713120"></p>
<h4 id="给模板中添加监控项"><a href="#给模板中添加监控项" class="headerlink" title="给模板中添加监控项"></a>给模板中添加监控项</h4><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191753414.png" alt="image-20230323191753414"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191822357.png" alt="image-20230323191822357"></p>
<h4 id="将主机关联该模板"><a href="#将主机关联该模板" class="headerlink" title="将主机关联该模板"></a><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191829985.png" alt="image-20230323191829985">将主机关联该模板</h4><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191841956.png" alt="image-20230323191841956"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191914524.png" alt="image-20230323191914524"></p>
<h4 id="给监控项画图"><a href="#给监控项画图" class="headerlink" title="给监控项画图"></a>给监控项画图</h4><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191849876.png" alt="image-20230323191849876"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191929486.png" alt="image-20230323191929486"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191950794.png" alt="image-20230323191950794"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323191959992.png" alt="image-20230323191959992"></p>
<h4 id="查看监控数据"><a href="#查看监控数据" class="headerlink" title="查看监控数据"></a>查看监控数据</h4><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192006404.png" alt="image-20230323192006404"></p>
<h4 id="给监控项添加触发器"><a href="#给监控项添加触发器" class="headerlink" title="给监控项添加触发器"></a>给监控项添加触发器</h4><p>常用触发器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">and       <span class="comment">#并且</span></span><br><span class="line">or        <span class="comment">#或</span></span><br><span class="line">last()    <span class="comment">#对比最后的值</span></span><br><span class="line">avg()     <span class="comment">#平均值</span></span><br><span class="line">diff()    <span class="comment">#对比上一次文件的内容</span></span><br><span class="line">nodata()  <span class="comment">#收不到数据进行报警</span></span><br><span class="line">(5m)      <span class="comment">#表示最近五分种得到值</span></span><br><span class="line">(<span class="comment">#5)      #表示最近五次得到的值</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192200143.png" alt="image-20230323192200143"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192207041.png" alt="image-20230323192207041"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192213415.png" alt="image-20230323192213415"></p>
<h3 id="优化页面告警"><a href="#优化页面告警" class="headerlink" title="优化页面告警"></a>优化页面告警</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主机名：&#123;HOST.NAME&#125;</span><br><span class="line">IP地址：&#123;HOST.IP&#125;</span><br><span class="line">Monitor Login User Count Problem 主机名:&#123;HOST.NAME&#125; IP地址:&#123;HOST.IP&#125;</span><br></pre></td></tr></table></figure>

<h3 id="给监控项的触发器添加告警动作"><a href="#给监控项的触发器添加告警动作" class="headerlink" title="给监控项的触发器添加告警动作"></a>给监控项的触发器添加告警动作</h3><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192304091.png" alt="image-20230323192304091"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192309251.png" alt="image-20230323192309251"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192315802.png" alt="image-20230323192315802"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192339056.png" alt="image-20230323192339056"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192346364.png" alt="image-20230323192346364"></p>
<h3 id="添加邮件告警（报警媒介类型：发件人和告警方式）"><a href="#添加邮件告警（报警媒介类型：发件人和告警方式）" class="headerlink" title="添加邮件告警（报警媒介类型：发件人和告警方式）"></a>添加邮件告警（报警媒介类型：发件人和告警方式）</h3><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192417377.png" alt="image-20230323192417377"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192424927.png" alt="image-20230323192424927"></p>
<h3 id="配置收件人"><a href="#配置收件人" class="headerlink" title="配置收件人"></a>配置收件人</h3><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192447114.png" alt="image-20230323192447114"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192452878.png" alt="image-20230323192452878"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192501724.png" alt="image-20230323192501724"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192534890.png" alt="image-20230323192534890"></p>
<h3 id="添加报警媒介"><a href="#添加报警媒介" class="headerlink" title="添加报警媒介"></a>添加报警媒介</h3><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192541892.png" alt="image-20230323192541892"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192546666.png" alt="image-20230323192546666"></p>
<h3 id="告警消息添加"><a href="#告警消息添加" class="headerlink" title="告警消息添加"></a>告警消息添加</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 故障告警</span></span><br><span class="line">标题：Problem: &#123;EVENT.NAME&#125;</span><br><span class="line">内容：</span><br><span class="line">Problem started at &#123;EVENT.TIME&#125; on &#123;EVENT.DATE&#125;</span><br><span class="line">Problem name: &#123;EVENT.NAME&#125;</span><br><span class="line">Host: &#123;HOST.NAME&#125;</span><br><span class="line">Severity: &#123;EVENT.SEVERITY&#125;</span><br><span class="line"></span><br><span class="line">Original problem ID: &#123;EVENT.ID&#125;</span><br><span class="line">&#123;TRIGGER.URL&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 恢复告警</span></span><br><span class="line">标题：Resolved: &#123;EVENT.NAME&#125;</span><br><span class="line">内容：</span><br><span class="line">Problem has been resolved at &#123;EVENT.RECOVERY.TIME&#125; on &#123;EVENT.RECOVERY.DATE&#125;</span><br><span class="line">Problem name: &#123;EVENT.NAME&#125;</span><br><span class="line">Host: &#123;HOST.NAME&#125;</span><br><span class="line">Severity: &#123;EVENT.SEVERITY&#125;</span><br><span class="line"></span><br><span class="line">Original problem ID: &#123;EVENT.ID&#125;</span><br><span class="line">&#123;TRIGGER.URL&#125;</span><br></pre></td></tr></table></figure>

<p>优化告警消息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 故障告警</span></span><br><span class="line">故障&#123;TRIGGER.STATUS&#125;,服务器:&#123;HOSTNAME1&#125;发生: &#123;TRIGGER.NAME&#125;故障!</span><br><span class="line"></span><br><span class="line">告警地址:&#123;HOST.IP&#125;</span><br><span class="line"></span><br><span class="line">告警主机:&#123;HOSTNAME1&#125;</span><br><span class="line"></span><br><span class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line"></span><br><span class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</span><br><span class="line"></span><br><span class="line">告警信息: &#123;TRIGGER.NAME&#125;</span><br><span class="line"></span><br><span class="line">告警项目:&#123;TRIGGER.KEY1&#125;</span><br><span class="line"></span><br><span class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</span><br><span class="line"></span><br><span class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</span><br><span class="line"></span><br><span class="line">事件ID:&#123;EVENT.ID&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 恢复告警</span></span><br><span class="line">恢复&#123;TRIGGER.STATUS&#125;, 服务器:&#123;HOSTNAME1&#125;: &#123;TRIGGER.NAME&#125;已恢复!</span><br><span class="line"></span><br><span class="line">告警地址:&#123;HOST.IP&#125;</span><br><span class="line"></span><br><span class="line">告警主机:&#123;HOSTNAME1&#125;</span><br><span class="line"></span><br><span class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line"></span><br><span class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</span><br><span class="line"></span><br><span class="line">告警信息: &#123;TRIGGER.NAME&#125;</span><br><span class="line"></span><br><span class="line">告警项目:&#123;TRIGGER.KEY1&#125;</span><br><span class="line"></span><br><span class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</span><br><span class="line"></span><br><span class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</span><br><span class="line"></span><br><span class="line">事件ID:&#123;EVENT.ID&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192604874.png" alt="image-20230323192604874"></p>
<h1 id="Zabbix深入自定义监控"><a href="#Zabbix深入自定义监控" class="headerlink" title="Zabbix深入自定义监控"></a>Zabbix深入自定义监控</h1><h2 id="zabbix多条件触发"><a href="#zabbix多条件触发" class="headerlink" title="zabbix多条件触发"></a>zabbix多条件触发</h2><p>监控内存可用的百分比</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserParameter=mem.available,free -m|awk <span class="string">'NR==2&#123;print $NF/$2*100&#125;'</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192722785.png" alt="image-20230323192722785"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192728168.png" alt="image-20230323192728168"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192735423.png" alt="image-20230323192735423"></p>
<p>目前属于单条件触发器，因为内存低于30%就报警了，在生产中，我们应该是当内存低于30%并且占用了swap空间，然后再报警。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserParameter=swap.available,free -m|awk <span class="string">'/^Swap/&#123;print $NF/$2*100&#125;'</span></span><br><span class="line"></span><br><span class="line">[root@sb_wzj web]<span class="comment"># zabbix_get -s 172.16.1.7 -k swap.available</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192745514.png" alt="image-20230323192745514"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192822589.png" alt="image-20230323192822589"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192828454.png" alt="image-20230323192828454"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">and             <span class="comment">#并且</span></span><br><span class="line">or              <span class="comment">#或者</span></span><br><span class="line">last()          <span class="comment">#比对最新的值</span></span><br><span class="line">avg()           <span class="comment">#平均值</span></span><br><span class="line">diff()          <span class="comment">#比对上一次文件的内容</span></span><br><span class="line">nodata()        <span class="comment">#收不不到数据进行报警nodata(5m)</span></span><br><span class="line">(5m)            <span class="comment">#表示最近5分钟得到值</span></span><br><span class="line">(<span class="comment">#5)            #表示最近5次得到的值</span></span><br></pre></td></tr></table></figure>

<h3 id="zabbix-5-x以上告警"><a href="#zabbix-5-x以上告警" class="headerlink" title="zabbix 5.x以上告警"></a>zabbix 5.x以上告警</h3><p><strong>故障告警</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">table</span> <span class="selector-class">.guzhang</span> &#123;<span class="attribute">color</span>: red;&#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://blog.driverzeng.com/zenglaoshi/sos.png"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"3"</span>  <span class="attr">bordercolor</span>=<span class="string">"black"</span> <span class="attr">cellspacing</span>=<span class="string">"0px"</span> <span class="attr">cellpadding</span>=<span class="string">"4px"</span> <span class="attr">width</span>=<span class="string">"500px"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">"guzhang"</span> <span class="attr">bgcolor</span>=<span class="string">"#0C1B3D"</span> &gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">2</span>&gt;</span></span><br><span class="line">            &#123;TRIGGER.STATUS&#125; 故障！！！故障！！！ </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="symbol">&amp;#128514;</span> <span class="symbol">&amp;#128514;</span> <span class="symbol">&amp;#128514;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span> <span class="attr">width</span>=<span class="string">"20%"</span>&gt;</span>告警主机<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;HOSTNAME1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>告警别名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;HOST.NAME&#125; <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>告警地址<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;HOST.IP&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>告警时间<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>告警等级<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;TRIGGER.SEVERITY&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>告警信息<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;TRIGGER.NAME&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>告警项目<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;TRIGGER.KEY1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">'guzhang2'</span> <span class="attr">bgcolor</span>=<span class="string">"#FF3333"</span>&gt;</span>问题详情<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">'guzhang3'</span> <span class="attr">bgcolor</span>=<span class="string">"#FF3333"</span>&gt;</span>&#123;ITEM.NAME&#125;:<span class="symbol">&amp;nbsp;</span>&#123;ITEM.VALUE&#125; <span class="symbol">&amp;#128520;</span> <span class="symbol">&amp;#128520;</span> <span class="symbol">&amp;#128520;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>当前状态<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;TRIGGER.STATUS&#125;:<span class="symbol">&amp;nbsp;</span>&#123;ITEM.VALUE1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>事件ID<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#F9B602"</span>&gt;</span>&#123;EVENT.ID&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>恢复告警</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">table</span> <span class="selector-class">.guzhang</span> &#123;</span></span><br><span class="line">            color: red;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://blog.driverzeng.com/zenglaoshi/huifu.png"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>  <span class="attr">bordercolor</span>=<span class="string">"black"</span> <span class="attr">cellspacing</span>=<span class="string">"0px"</span> <span class="attr">cellpadding</span>=<span class="string">"4px"</span> <span class="attr">width</span>=<span class="string">"500px"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">bgcolor</span>=<span class="string">"#49c208"</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">2</span>&gt;</span></span><br><span class="line">        &#123;TRIGGER.STATUS&#125; 哈哈哈哈哈哈,好了 </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="symbol">&amp;#128512;</span> <span class="symbol">&amp;#128512;</span> <span class="symbol">&amp;#128512;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span> <span class="attr">width</span>=<span class="string">"20%"</span>&gt;</span>恢复主机<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;HOSTNAME1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span>&gt;</span>恢复别名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;HOST.NAME&#125; <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span>&gt;</span>恢复地址<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;HOST.IP&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span>&gt;</span>恢复时间<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;EVENT.DATE&#125; &#123;EVENT.RECOVERY.TIME&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span>&gt;</span>恢复等级<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;TRIGGER.SEVERITY&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span>&gt;</span>恢复信息<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;TRIGGER.NAME&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span>&gt;</span>恢复项目<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;TRIGGER.KEY1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#49c208"</span>&gt;</span>恢复详情<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#49c208"</span>&gt;</span>&#123;ITEM.NAME&#125;:<span class="symbol">&amp;nbsp;</span>&#123;ITEM.VALUE&#125; <span class="symbol">&amp;#9889;</span> <span class="symbol">&amp;#9889;</span> <span class="symbol">&amp;#9889;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span>&gt;</span>当前状态<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;TRIGGER.STATUS&#125;:<span class="symbol">&amp;nbsp;</span>&#123;ITEM.VALUE1&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"lightgreen"</span>&gt;</span>事件ID<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"yellow"</span>&gt;</span>&#123;EVENT.ID&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="zabbix的自愈模式"><a href="#zabbix的自愈模式" class="headerlink" title="zabbix的自愈模式"></a>zabbix的自愈模式</h2><p>有些时候，我们的服务宕机了，或者有些服务停掉了，那么我们可以先尝试让他启动，看是否能起的来，为了不影响用户的体验，先把服务起起来，然后再去排查，是什么原因故障的。</p>
<p>那么此时我们就需要用到zabbix的自愈模式，这个…叫起来很好听，说白了，就是在让zabbix-server通过远程执行命令的方式，在agent上执行命令，启动服务。</p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192842454.png" alt="image-20230323192842454"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192858259.png" alt="image-20230323192858259"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192903808.png" alt="image-20230323192903808"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">[root@web01 zabbix_agentd.d]<span class="comment"># vim /etc/zabbix/zabbix_agentd.conf</span></span><br><span class="line">EnableRemoteCommands=1</span><br></pre></td></tr></table></figure>

<h2 id="zabbix告警升级机制"><a href="#zabbix告警升级机制" class="headerlink" title="zabbix告警升级机制"></a>zabbix告警升级机制</h2><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323192923043.png" alt="image-20230323192923043"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193013139.png" alt="image-20230323193013139"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193017533.png" alt="image-20230323193017533"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193022705.png" alt="image-20230323193022705"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193027831.png" alt="image-20230323193027831"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193115833.png" alt="image-20230323193115833"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193109471.png" alt="image-20230323193109471"></p>
<p><strong>计算方式：</strong></p>
<ol>
<li>开始于 ，这个是相对一但触发监控，则立即发送消息</li>
<li>1-2步骤是给运维组发送消息，每隔5分钟发送一次，总共2个步骤，所以发送2次</li>
<li>3-4步骤是给运维经理组发送消息，每隔5分钟发送一次，总共2个步骤，所以发送2次</li>
<li>4-5步骤是给运维总监组发送消息，每隔5分钟发送一次，总共2个步骤，所以发送2次</li>
<li>每次的开始时间是如何计算的呢，第一个立即开始：<br>1-2，3-4，4-5动作时间间隔是5分钟，所以在触发告警发送时间计算是5m+5m+5m=15m</li>
</ol>
<h2 id="聚合图形"><a href="#聚合图形" class="headerlink" title="聚合图形"></a>聚合图形</h2><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193125905.png" alt="image-20230323193125905"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193149392.png" alt="image-20230323193149392"></p>
<h2 id="zabbix微信报警"><a href="#zabbix微信报警" class="headerlink" title="zabbix微信报警"></a>zabbix微信报警</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.安装python的pip</span></span><br><span class="line">[root@sb_wzj web]<span class="comment"># yum install python-pip -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.安装python requests库</span></span><br><span class="line">[root@sb_wzj ~]<span class="comment"># pip2.7 install requests==2.27 -i  https://pypi.douban.com/simple/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.进入zabbix存放告警脚本目录</span></span><br><span class="line">[root@sb_wzj ~]<span class="comment"># cd /usr/lib/zabbix/alertscripts/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.编写微信告警脚本</span></span><br><span class="line">[root@sb_wzj alertscripts]<span class="comment"># vim weixin.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json;charset=utf-8'</span>&#125;</span><br><span class="line">api_url = <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=b3f00bb1-3198-4491-9429-a9fbe5444e23"</span>   <span class="comment">#这个是企业微信机器人生成的webhook地址，修改为你的即可。</span></span><br><span class="line"></span><br><span class="line">def msg(text):</span><br><span class="line">    json_text= &#123;</span><br><span class="line">     <span class="string">"msgtype"</span>: <span class="string">"text"</span>,</span><br><span class="line">        <span class="string">"text"</span>: &#123;</span><br><span class="line">            <span class="string">"content"</span>: text</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(requests.post(api_url,json.dumps(json_text),headers=headers).content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    text = sys.argv[1]</span><br><span class="line">    msg(text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.添加执行权限</span></span><br><span class="line">[root@sb_wzj alertscripts]<span class="comment"># chmod +x weixin.py</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230323193222292.png" alt="image-20230323193222292"></p>
<h1 id="zabbix-应用监控"><a href="#zabbix-应用监控" class="headerlink" title="zabbix 应用监控"></a>zabbix 应用监控</h1><h2 id="监控nginx"><a href="#监控nginx" class="headerlink" title="监控nginx"></a>监控nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建zabbix存放脚本目录</span></span><br><span class="line">[root@web01 ~]<span class="comment"># mkdir -p /etc/zabbix/scripts</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.编写监控项脚本</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/zabbix/scripts/nginx_status.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment"># $Name:         nginx_status.sh</span></span><br><span class="line"><span class="comment"># $Version:      v1.0</span></span><br><span class="line"><span class="comment"># $Function:     Nginx Status</span></span><br><span class="line"><span class="comment"># $Author:       DriverZeng</span></span><br><span class="line"><span class="comment"># $organization: www.driverzeng.com</span></span><br><span class="line"><span class="comment"># $Create Date:  2016-06-23</span></span><br><span class="line"><span class="comment"># $Description:  Monitor Nginx Service Status</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"></span><br><span class="line">NGINX_PORT=80  <span class="comment">#如果端口不同仅需要修改脚本即可，否则修改xml很麻烦</span></span><br><span class="line">NGINX_COMMAND=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_active</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$NGINX_PORT</span><span class="string">"/nginx_status/"</span> |awk <span class="string">'/Active/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_reading</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$NGINX_PORT</span><span class="string">"/nginx_status/"</span> |awk <span class="string">'/Reading/ &#123;print $2&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_writing</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$NGINX_PORT</span><span class="string">"/nginx_status/"</span> |awk <span class="string">'/Writing/ &#123;print $4&#125;'</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_waiting</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$NGINX_PORT</span><span class="string">"/nginx_status/"</span> |awk <span class="string">'/Waiting/ &#123;print $6&#125;'</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_accepts</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$NGINX_PORT</span><span class="string">"/nginx_status/"</span> |awk <span class="string">'NR==3 &#123;print $1&#125;'</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_handled</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$NGINX_PORT</span><span class="string">"/nginx_status/"</span> |awk <span class="string">'NR==3 &#123;print $2&#125;'</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_requests</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$NGINX_PORT</span><span class="string">"/nginx_status/"</span> |awk <span class="string">'NR==3 &#123;print $3&#125;'</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$NGINX_COMMAND</span> <span class="keyword">in</span></span><br><span class="line">    active)</span><br><span class="line">        nginx_active;</span><br><span class="line">        ;;</span><br><span class="line">    reading)</span><br><span class="line">        nginx_reading;</span><br><span class="line">        ;;</span><br><span class="line">    writing)</span><br><span class="line">        nginx_writing;</span><br><span class="line">        ;;</span><br><span class="line">    waiting)</span><br><span class="line">        nginx_waiting;</span><br><span class="line">        ;;</span><br><span class="line">    accepts)</span><br><span class="line">        nginx_accepts;</span><br><span class="line">        ;;</span><br><span class="line">    handled)</span><br><span class="line">        nginx_handled;</span><br><span class="line">        ;;</span><br><span class="line">    requests)</span><br><span class="line">        nginx_requests;</span><br><span class="line">        ;;</span><br><span class="line">          *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">"USAGE:<span class="variable">$0</span> &#123;active|reading|writing|waiting|accepts|handled|requests&#125;"</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.给脚本添加执行权限</span></span><br><span class="line">[root@web01 ~]<span class="comment"># chmod +x /etc/zabbix/scripts/nginx_status.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.修改客户端配置文件</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/zabbix/zabbix_agentd.d/nginx_status.conf</span></span><br><span class="line">UserParameter=nginx_status[*],/bin/bash /etc/zabbix/scripts/nginx_status.sh <span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.重启agent</span></span><br><span class="line">[root@web01 ~]<span class="comment"># systemctl restart zabbix-agent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.检测</span></span><br><span class="line">[root@sb_wzj ~]<span class="comment"># zabbix_get -s 172.16.1.7 -k nginx_status[waiting]</span></span><br><span class="line">0</span><br><span class="line">[root@sb_wzj ~]<span class="comment"># zabbix_get -s 172.16.1.7 -k nginx_status[requests]</span></span><br><span class="line">19</span><br><span class="line">[root@sb_wzj ~]<span class="comment"># zabbix_get -s 172.16.1.7 -k nginx_status[accepts]</span></span><br><span class="line">20</span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230254488.png" alt="image-20230325230254488"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230300411.png" alt="image-20230325230300411"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230305451.png" alt="image-20230325230305451"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230322170.png" alt="image-20230325230322170"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230326837.png" alt="image-20230325230326837"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230332051.png" alt="image-20230325230332051"></p>
<h2 id="zabbix监控PHP"><a href="#zabbix监控PHP" class="headerlink" title="zabbix监控PHP"></a>zabbix监控PHP</h2><h3 id="修改php配置"><a href="#修改php配置" class="headerlink" title="修改php配置"></a>修改php配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.打开php状态模块</span></span><br><span class="line">pm.status_path = /phpfpm_status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.重启php</span></span><br><span class="line">[root@web01 ~]<span class="comment"># systemctl restart php-fpm</span></span><br></pre></td></tr></table></figure>

<h3 id="修改nginx配置"><a href="#修改nginx配置" class="headerlink" title="修改nginx配置"></a>修改nginx配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.修改nginx配置文件</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name _;</span><br><span class="line"></span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">                stub_status on;</span><br><span class="line">                allow 127.0.0.1;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ ^/(phpfpm_status)$ &#123;</span><br><span class="line">                include fastcgi_params;</span><br><span class="line">                fastcgi_pass    unix:/dev/shm/php.sock;</span><br><span class="line">                fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.重启nginx</span></span><br><span class="line">[root@web01 ~]<span class="comment"># systemctl restart nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.查看phpfpm状态页</span></span><br><span class="line">[root@web01 ~]<span class="comment"># curl http://127.0.0.1/phpfpm_status</span></span><br><span class="line">pool:                 www</span><br><span class="line">process manager:      dynamic</span><br><span class="line">start time:           26/Aug/2022:10:55:47 +0800</span><br><span class="line">start since:          165</span><br><span class="line">accepted conn:        1</span><br><span class="line">listen queue:         0</span><br><span class="line">max listen queue:     0</span><br><span class="line">listen queue len:     0</span><br><span class="line">idle processes:       4</span><br><span class="line">active processes:     1</span><br><span class="line">total processes:      5</span><br><span class="line">max active processes: 1</span><br><span class="line">max children reached: 0</span><br><span class="line">slow requests:        0</span><br><span class="line"></span><br><span class="line"><span class="comment">#PHP-FPM状态解释：</span></span><br><span class="line">pool <span class="comment">#fpm池名称,大多数为www</span></span><br><span class="line">process manager <span class="comment">#进程管理方式dynamic或者static</span></span><br><span class="line">start time <span class="comment">#启动日志,如果reload了fpm，时间会更新</span></span><br><span class="line">start since <span class="comment">#运行时间</span></span><br><span class="line">accepted conn <span class="comment">#当前池接受的请求数</span></span><br><span class="line">listen queue <span class="comment">#请求等待队列,如果这个值不为0,那么需要增加FPM的进程数量</span></span><br><span class="line">max listen queue <span class="comment">#请求等待队列最高的数量</span></span><br><span class="line">listen queue len <span class="comment">#socket等待队列长度</span></span><br><span class="line">idle processes <span class="comment">#空闲进程数量</span></span><br><span class="line">active processes <span class="comment">#活跃进程数量</span></span><br><span class="line">total processes <span class="comment">#总进程数量</span></span><br><span class="line">max active processes <span class="comment">#最大的活跃进程数量（FPM启动开始计算）</span></span><br><span class="line">max children reached <span class="comment">#进程最大数量限制的次数，如果这个数量不为0，那说明你的最大进程数量过小,可以适当调整。</span></span><br><span class="line">slow requests  <span class="comment"># 请求比较慢的数量</span></span><br></pre></td></tr></table></figure>

<h3 id="编写监控脚本"><a href="#编写监控脚本" class="headerlink" title="编写监控脚本"></a>编写监控脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.脚本内容</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/zabbix/scripts/phpfpm_status.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment"># $Name:         phpfpm_status.sh</span></span><br><span class="line"><span class="comment"># $Version:      v1.0</span></span><br><span class="line"><span class="comment"># $Function:     Nginx Status</span></span><br><span class="line"><span class="comment"># $Author:       DriverZeng</span></span><br><span class="line"><span class="comment"># $organization: www.driverzeng.com</span></span><br><span class="line"><span class="comment"># $Create Date:  2016-06-23</span></span><br><span class="line"><span class="comment"># $Description:  Monitor Nginx Service Status</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"></span><br><span class="line">PHPFPM_COMMAND=<span class="variable">$1</span></span><br><span class="line">PHPFPM_PORT=80  <span class="comment">#根据监听不同端口进行调整</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start_since</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^start since:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">accepted_conn</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^accepted conn:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">listen_queue</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^listen queue:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">max_listen_queue</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^max listen queue:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">listen_queue_len</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^listen queue len:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">idle_processes</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^idle processes:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">active_processes</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^active processes:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">total_processes</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^total processes:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">max_active_processes</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^max active processes:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">max_children_reached</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^max children reached:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">slow_requests</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">"http://127.0.0.1:"</span><span class="variable">$PHPFPM_PORT</span><span class="string">"/phpfpm_status"</span> |awk <span class="string">'/^slow requests:/ &#123;print $NF&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$PHPFPM_COMMAND</span> <span class="keyword">in</span></span><br><span class="line">    start_since)</span><br><span class="line">        start_since;</span><br><span class="line">        ;;</span><br><span class="line">    accepted_conn)</span><br><span class="line">        accepted_conn;</span><br><span class="line">        ;;</span><br><span class="line">    listen_queue)</span><br><span class="line">        listen_queue;</span><br><span class="line">        ;;</span><br><span class="line">    max_listen_queue)</span><br><span class="line">        max_listen_queue;</span><br><span class="line">        ;;</span><br><span class="line">    listen_queue_len)</span><br><span class="line">        listen_queue_len;</span><br><span class="line">        ;;</span><br><span class="line">    idle_processes)</span><br><span class="line">        idle_processes;</span><br><span class="line">        ;;</span><br><span class="line">    active_processes)</span><br><span class="line">        active_processes;</span><br><span class="line">        ;;</span><br><span class="line">        total_processes)</span><br><span class="line">                total_processes;</span><br><span class="line">                ;;</span><br><span class="line">        max_active_processes)</span><br><span class="line">                max_active_processes;</span><br><span class="line">                ;;</span><br><span class="line">        max_children_reached)</span><br><span class="line">                max_children_reached;</span><br><span class="line">                ;;</span><br><span class="line">        slow_requests)</span><br><span class="line">                slow_requests;</span><br><span class="line">                ;;</span><br><span class="line">          *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">"USAGE:<span class="variable">$0</span> &#123;start_since|accepted_conn|listen_queue|max_listen_queue|listen_queue_len|idle_processes|active_processes|total_processes|max_active_processes|max_children_reached&#125;"</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2.添加执行权限</span></span><br><span class="line">[root@web01 ~]<span class="comment"># chmod +x /etc/zabbix/scripts/phpfpm_status.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="配置zabbix客户端加监控"><a href="#配置zabbix客户端加监控" class="headerlink" title="配置zabbix客户端加监控"></a>配置zabbix客户端加监控</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]<span class="comment"># cp /etc/zabbix/zabbix_agentd.d/&#123;nginx_status.conf,phpfpm_status.conf&#125;</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/zabbix/zabbix_agentd.d/phpfpm_status.conf </span></span><br><span class="line">UserParameter=phpfpm_status[*],/bin/bash /etc/zabbix/scripts/phpfpm_status.sh <span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">[root@web01 ~]<span class="comment"># systemctl restart zabbix-agent</span></span><br><span class="line"></span><br><span class="line">[root@sb_wzj ~]<span class="comment"># zabbix_get -s 172.16.1.7 -k phpfpm_status[start_since]</span></span><br><span class="line">891</span><br><span class="line">[root@sb_wzj ~]<span class="comment"># zabbix_get -s 172.16.1.7 -k phpfpm_status[accepted_conn]</span></span><br><span class="line">3</span><br><span class="line">[root@sb_wzj ~]<span class="comment"># zabbix_get -s 172.16.1.7 -k phpfpm_status[listen_queue]</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h3 id="页面添加监控项-1"><a href="#页面添加监控项-1" class="headerlink" title="页面添加监控项"></a>页面添加监控项</h3><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230352104.png" alt="image-20230325230352104"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230358107.png" alt="image-20230325230358107"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230402509.png" alt="image-20230325230402509"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230406702.png" alt="image-20230325230406702"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230420363.png" alt="image-20230325230420363"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230424729.png" alt="image-20230325230424729"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230430584.png" alt="image-20230325230430584"></p>
<h2 id="zabbix监控MySQL"><a href="#zabbix监控MySQL" class="headerlink" title="zabbix监控MySQL"></a>zabbix监控MySQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.开启MySQL上的zabbix-agent</span></span><br><span class="line">[root@db03 ~]<span class="comment"># systemctl start zabbix-agent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.添加主机</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230453056.png" alt="image-20230325230453056"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230501789.png" alt="image-20230325230501789"></p>
<h2 id="zabbix监控redis"><a href="#zabbix监控redis" class="headerlink" title="zabbix监控redis"></a>zabbix监控redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.安装redis</span></span><br><span class="line">[root@db03 ~]<span class="comment"># yum install -y redis</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.启动redis</span></span><br><span class="line">[root@db03 ~]<span class="comment"># systemctl start redis</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230531241.png" alt="image-20230325230531241"></p>
<h2 id="Zabbix监控MySQL"><a href="#Zabbix监控MySQL" class="headerlink" title="Zabbix监控MySQL"></a>Zabbix监控MySQL</h2><p><code>percona Monitoring Plugins</code>是一个高质量的组件，为<code>MySQL</code>数据库添加企业级的监控和图表功能。但其脚本使用<code>PHP</code>实现，故而<code>Zabbix-Agent</code>需要安装<code>PHP</code>环境。</p>
<p><a href="https://www.percona.com/software/documentation" target="_blank" rel="noopener">percona工具集</a></p>
<p><strong>实践环境</strong></p>
<table>
<thead>
<tr>
<th>服务器系统</th>
<th>角色</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>CentOS 7.4 x86_64</td>
<td>Zabbix-Server</td>
<td>10.0.0.8</td>
</tr>
<tr>
<td>CentOS 7.4 x86_64</td>
<td>Zabbix-Agent</td>
<td>10.0.0.7</td>
</tr>
</tbody></table>
<p>1.在<code>Zabbix-Agent</code>端安装<code>percona Monitoring Plugins</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent ~]<span class="comment"># yum install -y http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm</span></span><br><span class="line">[root@Agent ~]<span class="comment"># yum install percona-zabbix-templates -y</span></span><br></pre></td></tr></table></figure>

<p>2.查看<code>percona</code>安装后的目录结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent percona]<span class="comment"># tree /var/lib/zabbix/percona</span></span><br><span class="line">/var/lib/zabbix/percona</span><br><span class="line">├── scripts  <span class="comment">#脚本文件路径</span></span><br><span class="line">│   ├── get_mysql_stats_wrapper.sh</span><br><span class="line">│   └── ss_get_mysql_stats.php</span><br><span class="line">└── templates</span><br><span class="line">    ├── userparameter_percona_mysql.conf  <span class="comment">#key文件位置</span></span><br><span class="line">    └── zabbix_agent_template_percona_mysql_server_ht_2.0.9-sver1.1.6.xml <span class="comment">#模板文件位置</span></span><br></pre></td></tr></table></figure>

<p>4.将自定义监控项配置文件复制至<code>/etc/zabbix_agentd.conf.d</code>目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent ~]<span class="comment"># cp /var/lib/zabbix/percona/templates/userparameter_percona_mysql.conf  /etc/zabbix/zabbix_agentd.d/percona_mysql.conf</span></span><br></pre></td></tr></table></figure>

<p>5.重启<code>zabbix-agent</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent ~]<span class="comment"># systemctl restart zabbix-agent</span></span><br></pre></td></tr></table></figure>

<p>6.修改脚本中的<code>MySQL</code>用户名和密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent scripts]<span class="comment"># vim /var/lib/zabbix/percona/scripts/ss_get_mysql_stats.php</span></span><br><span class="line"><span class="variable">$mysql_user</span> = <span class="string">'root'</span>;</span><br><span class="line"><span class="variable">$mysql_pass</span> = <span class="string">'123'</span>;</span><br><span class="line"><span class="variable">$mysql_port</span> = 3306;</span><br></pre></td></tr></table></figure>

<p>7.在<code>Zabbix-Server</code>端上使用<code>Zabbix_get</code>获取值(否则会失败)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Server ~]<span class="comment"># zabbix_get -s 10.0.0.7 -k MySQL.pool-read-requests</span></span><br><span class="line">223003813</span><br><span class="line"></span><br><span class="line">//如果获取不到值常见问题</span><br><span class="line">1.看是否是MySQL密码错误</span><br><span class="line">2.不要直接执行脚本来获取</span><br><span class="line">3.删除/tmp/localhost-mysql_cacti_stats.txt文件</span><br><span class="line">4.权限问题导致</span><br></pre></td></tr></table></figure>

<p>8.在Zabbix页面模板选项中导入Percona模板, 模板存放在<code>/var/lib/zabbix/percona/templates</code>， 最后关联主机即可。</p>
<h2 id="Zabbix监控Redis"><a href="#Zabbix监控Redis" class="headerlink" title="Zabbix监控Redis"></a>Zabbix监控Redis</h2><p><code>Redis</code>使用自带的<code>INFO</code>命令，进行状态监控。以一种易于解释且易于阅读的格式，返回关于<code>Redis</code>服务器的各种信息和统计数值。</p>
<p><strong>实践环境</strong></p>
<table>
<thead>
<tr>
<th>服务器系统</th>
<th>角色</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>CentOS 7.4 x86_64</td>
<td>Zabbix-Server</td>
<td>10.0.0.8</td>
</tr>
<tr>
<td>CentOS 7.4 x86_64</td>
<td>Zabbix-Agent</td>
<td>10.0.0.7</td>
</tr>
</tbody></table>
<p>1.编写Shell脚本</p>
<ul>
<li>脚本端口、连接redis服务地址根据具体情况进行修改</li>
<li>AUTH认证没有开启，将PASSWD修改为空即可。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent ~]<span class="comment"># mkdir -p  /etc/zabbix/scripts</span></span><br><span class="line">[root@Agent ~]<span class="comment"># vim /etc/zabbix/scripts/redis_status.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment"># $Name:         redis_status.sh</span></span><br><span class="line"><span class="comment"># $Version:      v1.0</span></span><br><span class="line"><span class="comment"># $Function:     Redis Status</span></span><br><span class="line"><span class="comment"># $Author:       DriverZeng</span></span><br><span class="line"><span class="comment"># $organization: www.driverzeng.com</span></span><br><span class="line"><span class="comment"># $Create Date:  2016-06-23</span></span><br><span class="line"><span class="comment"># $Description:  Monitor Redis Service Status</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"></span><br><span class="line">R_COMMAND=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">R_PORT=<span class="string">"6379"</span>  <span class="comment">#根据实际情况调整端口</span></span><br><span class="line">R_SERVER=<span class="string">"127.0.0.1"</span>  <span class="comment">#根据具体情况调整IP地址</span></span><br><span class="line">PASSWD=<span class="string">""</span>    <span class="comment">#如果没有设置Redis密码,为空即可</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">redis_status</span></span>()&#123;</span><br><span class="line">   (<span class="built_in">echo</span> -en <span class="string">"AUTH <span class="variable">$PASSWD</span>\r\nINFO\r\n"</span>;sleep 1;) | /usr/bin/nc <span class="string">"<span class="variable">$R_SERVER</span>"</span> <span class="string">"<span class="variable">$R_PORT</span>"</span> &gt; /tmp/redis_<span class="string">"<span class="variable">$R_PORT</span>"</span>.tmp</span><br><span class="line">      REDIS_STAT_VALUE=$(grep <span class="string">"<span class="variable">$R_COMMAND</span>:"</span> /tmp/redis_<span class="string">"<span class="variable">$R_PORT</span>"</span>.tmp | cut -d <span class="string">':'</span> -f2)</span><br><span class="line">       <span class="built_in">echo</span> <span class="string">"<span class="variable">$REDIS_STAT_VALUE</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$R_COMMAND</span> <span class="keyword">in</span></span><br><span class="line">    used_cpu_user_children)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    used_cpu_sys)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    total_commands_processed)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    role)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    lru_clock)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    latest_fork_usec)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    keyspace_misses)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    keyspace_hits)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    keys)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    expires)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    expired_keys)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    evicted_keys)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    connected_clients)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    changes_since_last_save)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    blocked_clients)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    bgsave_in_progress)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    bgrewriteaof_in_progress)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    used_memory_peak)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    used_memory)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    used_cpu_user)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    used_cpu_sys_children)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    total_connections_received)</span><br><span class="line">    redis_status <span class="string">"<span class="variable">$R_PORT</span>"</span> <span class="string">"<span class="variable">$R_COMMAND</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">    <span class="built_in">echo</span> $<span class="string">"USAGE:<span class="variable">$0</span> &#123;used_cpu_user_children|used_cpu_sys|total_commands_processed|role|lru_clock|latest_fork_usec|keyspace_misses|keyspace_hits|keys|expires|expired_keys|connected_clients|changes_since_last_save|blocked_clients|bgrewriteaof_in_progress|used_memory_peak|used_memory|used_cpu_user|used_cpu_sys_children|total_connections_received&#125;"</span></span><br><span class="line">    <span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>Redis状态参数解释：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">server : Redis 服务器信息，包含以下域：</span><br><span class="line">redis_version : Redis 服务器版本</span><br><span class="line">redis_git_sha1 : Git SHA1</span><br><span class="line">redis_git_dirty : Git dirty flag</span><br><span class="line">os : Redis 服务器的宿主操作系统</span><br><span class="line">arch_bits : 架构（32 或 64 位）</span><br><span class="line">multiplexing_api : Redis 所使用的事件处理机制</span><br><span class="line">gcc_version : 编译 Redis 时所使用的 GCC 版本</span><br><span class="line">process_id : 服务器进程的 PID</span><br><span class="line">run_id : Redis 服务器的随机标识符（用于 Sentinel 和集群）</span><br><span class="line">tcp_port : TCP/IP 监听端口</span><br><span class="line">uptime_in_seconds : 自 Redis 服务器启动以来，经过的秒数</span><br><span class="line">uptime_in_days : 自 Redis 服务器启动以来，经过的天数</span><br><span class="line">lru_clock : 以分钟为单位进行自增的时钟，用于 LRU 管理</span><br><span class="line">clients : 已连接客户端信息，包含以下域：</span><br><span class="line">connected_clients : 已连接客户端的数量（不包括通过从属服务器连接的客户端）</span><br><span class="line">client_longest_output_list : 当前连接的客户端当中，最长的输出列表</span><br><span class="line">client_longest_input_buf : 当前连接的客户端当中，最大输入缓存</span><br><span class="line">blocked_clients : 正在等待阻塞命令（BLPOP、BRPOP、BRPOPLPUSH）的客户端的数量</span><br><span class="line">memory : 内存信息，包含以下域：</span><br><span class="line">used_memory : 由 Redis 分配器分配的内存总量，以字节（byte）为单位</span><br><span class="line">used_memory_human : 以人类可读的格式返回 Redis 分配的内存总量</span><br><span class="line">used_memory_rss : 从操作系统的角度，返回 Redis 已分配的内存总量（俗称常驻集大小）。这个值和 top 、 ps 等命令的输出一致。</span><br><span class="line">used_memory_peak : Redis 的内存消耗峰值（以字节为单位）</span><br><span class="line">used_memory_peak_human : 以人类可读的格式返回 Redis 的内存消耗峰值</span><br><span class="line">used_memory_lua : Lua 引擎所使用的内存大小（以字节为单位）</span><br><span class="line">mem_fragmentation_ratio : used_memory_rss 和 used_memory 之间的比率</span><br><span class="line">persistence : RDB 和 AOF 的相关信息</span><br><span class="line">stats : 一般统计信息</span><br><span class="line">replication : 主/从复制信息</span><br><span class="line">cpu : CPU 计算量统计信息</span><br><span class="line">commandstats : Redis 命令统计信息</span><br><span class="line">cluster : Redis 集群信息</span><br><span class="line">keyspace : 数据库相关的统计信息</span><br><span class="line">参数还可以是下面这两个：</span><br><span class="line">all : 返回所有信息</span><br><span class="line">default : 返回默认选择的信息</span><br><span class="line">当不带参数直接调用 INFO 命令时，使用 default 作为默认参数。</span><br></pre></td></tr></table></figure>

<p>3.添加脚本执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent ~]<span class="comment"># chmod +x /etc/zabbix/scripts/redis_status.sh</span></span><br></pre></td></tr></table></figure>

<p>4.Zabbix权限不足处理办法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent ~]<span class="comment"># rm -f /tmp/redis_6379.tmp</span></span><br></pre></td></tr></table></figure>

<p>5.key的<code>redis_status.conf</code>的配置文件如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent ~]<span class="comment"># cat /etc/zabbix/zabbix_agentd.d/redis_status.conf</span></span><br><span class="line">UserParameter=redis_status[*],/bin/bash /etc/zabbix/scripts/redis_status.sh <span class="string">"<span class="variable">$1</span>"</span></span><br></pre></td></tr></table></figure>

<p>6.重启<code>zabbix-agent</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Agent ~]<span class="comment"># systemctl restart  zabbix-agent</span></span><br></pre></td></tr></table></figure>

<p>7.在<code>Zabbix-Server</code>使用<code>Zabbix_get</code>获取值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Server ~]<span class="comment"># zabbix_get -s 10.0.0.7 -k redis_status[used_cpu_sys]</span></span><br><span class="line">16.81</span><br></pre></td></tr></table></figure>

<h2 id="zabbix监控JVM（JAVA）"><a href="#zabbix监控JVM（JAVA）" class="headerlink" title="zabbix监控JVM（JAVA）"></a>zabbix监控JVM（JAVA）</h2><p>在Zabbix中，JMX监控数据的获取由专门的代理程序来实现,即Zabbix-Java-Gateway来负责数据的采集，Zabbix-Java-Gateway和JMX的Java程序之间通信获取数据.</p>
<h3 id="JMX在zabbix中运行的流程"><a href="#JMX在zabbix中运行的流程" class="headerlink" title="JMX在zabbix中运行的流程"></a>JMX在zabbix中运行的流程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.Zabbix-Server找Zabbix-Java-Gateway获取Java数据</span><br><span class="line">2.Zabbix-Java-Gateway找Java程序获取数据</span><br><span class="line">3.Java程序返回数据给Zabbix-Java-Gateway</span><br><span class="line">4.Zabbix-Java-Gateway返回数据给Zabbix-Server</span><br><span class="line">5.Zabbix-Server进行数据展示</span><br></pre></td></tr></table></figure>

<p><strong>JMX监控配置步骤</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.安装Zabbix-Java-Gateway。</span><br><span class="line">2.配置zabbix_java_gateway.conf参数。</span><br><span class="line">3.配置zabbix-server.conf参数。</span><br><span class="line">4.Tomcat应用开启JMX协议。</span><br><span class="line">5.ZabbixWeb配置JMX监控的Java应用。</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">zabbix-java-gateway</span><br><span class="line"><span class="comment"># 1.安装Java容器Tomcat</span></span><br><span class="line">[root@web01 ~]<span class="comment"># yum install -y tomcat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.安装zabbix-java-gateway</span></span><br><span class="line">[root@web01 ~]<span class="comment"># rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-java-gateway-5.0.26-1.el7.x86_64.rpm?spm=a2c6h.25603864.0.0.2ed62e2fPf8hxu</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.修改java-gateway配置文件</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/zabbix/zabbix_java_gateway.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.启动java-gateway</span></span><br><span class="line">[root@web01 ~]<span class="comment"># systemctl start zabbix-java-gateway.service </span></span><br><span class="line">[root@web01 ~]<span class="comment"># netstat -lntup|grep 10052</span></span><br><span class="line">tcp6       0      0 :::10052                :::*                    LISTEN      85993/java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.修改服务端配置</span></span><br><span class="line">[root@sb_wzj ~]<span class="comment"># vim /etc/zabbix/zabbix_server.conf </span></span><br><span class="line"><span class="comment">## java-gateway的地址</span></span><br><span class="line">JavaGateway=172.16.1.7</span><br><span class="line"><span class="comment">## java-gateway的端口</span></span><br><span class="line">JavaGatewayPort=10052</span><br><span class="line"><span class="comment">## java-gateway轮询</span></span><br><span class="line">StartJavaPollers=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.重启服务端</span></span><br><span class="line">[root@sb_wzj ~]<span class="comment"># systemctl restart zabbix-server</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.修改tomcat启动脚本</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /usr/libexec/tomcat/server</span></span><br><span class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$CATALINA_OPTS</span></span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.port=12345</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.authenticate=false</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=172.16.1.7"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230723513.png" alt="image-20230325230723513"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230728525.png" alt="image-20230325230728525"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230743639.png" alt="image-20230325230743639"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230748084.png" alt="image-20230325230748084"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230752766.png" alt="image-20230325230752766"></p>
<h2 id="zabbix自定义监控阶段小结"><a href="#zabbix自定义监控阶段小结" class="headerlink" title="zabbix自定义监控阶段小结"></a>zabbix自定义监控阶段小结</h2><p><strong>zabbix监控基础架构回顾</strong></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230325230801363.png" alt="image-20230325230801363"></p>
<p><strong>Zabbix监控方式：</strong></p>
<ul>
<li>agent：客户端监控</li>
<li>SNMP：监控网络设备（交换机）</li>
<li>IPMI：监控主机硬件设备（Dell R710 R720 R730 远程管理卡）</li>
<li>JMX：监控JAVA的JVM</li>
</ul>
<p><strong>Zabbix资源回顾（基于监控项基础的所有资源）</strong></p>
<h1 id="Zabbix-Web检测"><a href="#Zabbix-Web检测" class="headerlink" title="Zabbix Web检测"></a>Zabbix Web检测</h1><h2 id="什么是静态网站、动态网站"><a href="#什么是静态网站、动态网站" class="headerlink" title="什么是静态网站、动态网站"></a>什么是静态网站、动态网站</h2><p>静态网站：纯静态网站就是服务器的源代码和客户端的源代码一致。动态网站：比如: <code>&lt;?php phpinfo()?&gt;</code>每次用户访问的时候，内容都是在内存中动态生成的。动态网站支持登陆，支持用户交互，所以用户在请求动态网站时，会给客户端下发一个叫sessionID的内容，那么客户端则会将SessionID保存至浏览器的cookie中。</p>
<h2 id="session和cookie的工作流程"><a href="#session和cookie的工作流程" class="headerlink" title="session和cookie的工作流程"></a>session和cookie的工作流程</h2><p>1) 当用户首次访问动态网站时，是不会携带cookie信息，那么在服务端返回网页的时候，会给该客户端的浏览器分配一个唯一的sessionID，客户端会该sessionID存储至浏览器的Cookie中。</p>
<p>2) 当用户再次访问网站时，浏览器会在Header头信息添加Set-Cookie，Set-Cookie携带的则是该网站对应的sessionID信息，服务端接收后会进行校验</p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193629589.png" alt="image-20230327193629589"></p>
<h3 id="使用命令模拟用户登录网站"><a href="#使用命令模拟用户登录网站" class="headerlink" title="使用命令模拟用户登录网站"></a>使用命令模拟用户登录网站</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]<span class="comment"># curl -L -c cook -b cook 'http://zabbix.zls.com/index.php'</span></span><br><span class="line"><span class="comment">#-b：cookie字符串或文件读取位置，使用option来把上次的cookie信息追加到http request里面去。</span></span><br><span class="line"><span class="comment">#-c：操作结束后把cookie写入到这个文件中web01</span></span><br><span class="line"></span><br><span class="line">[root@web01 ~]<span class="comment"># curl -L -c cook -b cook -d 'name=Admin&amp;password=zabbix&amp;autologin=1&amp;enter=Sign+in' 'http://zabbix.zls.com/index.php'</span></span><br><span class="line"><span class="comment">#-d:    以POST的请方式携带头部信息请求</span></span><br><span class="line"></span><br><span class="line">[root@web01 ~]<span class="comment"># curl -L -c cook -b cook 'http://zabbix.zls.com/queue.php'</span></span><br></pre></td></tr></table></figure>

<h2 id="zabbix监控web网站"><a href="#zabbix监控web网站" class="headerlink" title="zabbix监控web网站"></a>zabbix监控web网站</h2><p>我们使用Zabbix Web 监控来监控Zabbix的Web界面。我们想知道它是否可用、是否正常工作以及响应速度。所以我们必须使用用户名和密码登录。</p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193643276.png" alt="image-20230327193643276"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193648143.png" alt="image-20230327193648143"></p>
<p>在新的场景中，我们将场景命名为”监控zabbix服务器”，并为其创建一个新的应用 (application )。</p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193812116.png" alt="image-20230327193812116"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193816674.png" alt="image-20230327193816674"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193821139.png" alt="image-20230327193821139"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## zabbix5.0版本</span></span><br><span class="line">regex:name=<span class="string">"csrf-token"</span> content=<span class="string">"([0-9a-z]&#123;16&#125;)"</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193829056.png" alt="image-20230327193829056"></p>
<p><strong>注意：一定要勾选跟随跳转</strong></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193834210.png" alt="image-20230327193834210"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193841194.png" alt="image-20230327193841194"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327193846541.png" alt="image-20230327193846541"></p>
<h1 id="Zabbix自动化监控"><a href="#Zabbix自动化监控" class="headerlink" title="Zabbix自动化监控"></a>Zabbix自动化监控</h1><h2 id="zabbix工作模式"><a href="#zabbix工作模式" class="headerlink" title="zabbix工作模式"></a>zabbix工作模式</h2><ul>
<li>主动模式：自动注册</li>
<li>被动模式：自动发现</li>
</ul>
<h2 id="自动发现"><a href="#自动发现" class="headerlink" title="自动发现"></a>自动发现</h2><p>zabbix的服务端，扫描<code>IP网段</code>，该网段上，只要安装了<code>zabbix agent</code>并且配置了服务端的IP，zabbix-server会自动将发现的主机加入到资产中。</p>
<blockquote>
<p>当网络发现正确设置后你可以：<br>1.加快Zabbix部署<br>2.简化管理<br>3.无需过多管理就能在快速变化的环境中使用Zabbix</p>
</blockquote>
<hr>
<blockquote>
<p>Zabbix网络发现基于以下信息：<br>1.IP范围<br>2.可用的外部服务（FTP，SSH，WEB，POP3，IMAP，TCP等）<br>3.来自 zabbix agent 的信息（仅支持未加密模式）<br>4.来自 snmp agent 的信息</p>
</blockquote>
<hr>
<blockquote>
<p>不支持：<br>1.发现网络拓扑</p>
</blockquote>
<h3 id="自动发现配置"><a href="#自动发现配置" class="headerlink" title="自动发现配置"></a>自动发现配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.安装zabbix客户端</span></span><br><span class="line">rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-agent-5.0.26-1.el7.x86_64.rpm?spm=a2c6h.25603864.0.0.20ba2e2fnfcAbB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.修改客户端配置文件</span></span><br><span class="line">[root@db02 ~]<span class="comment"># vim /etc/zabbix/zabbix_agentd.conf </span></span><br><span class="line">Server=172.16.1.61</span><br><span class="line">[root@db02 ~]<span class="comment"># systemctl start zabbix-agent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.配置自动发现的规则</span></span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203220851.png" alt="image-20230327203220851"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203226763.png" alt="image-20230327203226763"></p>
<p><strong>将动作和自动发现关联</strong></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203242215.png" alt="image-20230327203242215"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203250464.png" alt="image-20230327203250464"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203255583.png" alt="image-20230327203255583"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203300125.png" alt="image-20230327203300125"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">默认标题</span><br><span class="line">自动发现主机IP:&#123;DISCOVERY.DEVICE.IPADDRESS&#125;</span><br><span class="line"></span><br><span class="line">消息内容</span><br><span class="line">客户端IP:&#123;DISCOVERY.DEVICE.IPADDRESS&#125;</span><br><span class="line">客户端名称: &#123;DISCOVERY.SERVICE.NAME&#125;</span><br><span class="line">客户端端口: &#123;DISCOVERY.SERVICE.PORT&#125;</span><br><span class="line">客户端状态: &#123;DISCOVERY.SERVICE.STATUS&#125;</span><br><span class="line"></span><br><span class="line">操作动作</span><br><span class="line">添加主机,添加主机组，链接模板，发送邮件，等等</span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203308430.png" alt="image-20230327203308430"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203312586.png" alt="image-20230327203312586"></p>
<h3 id="zabbix自动发现小结"><a href="#zabbix自动发现小结" class="headerlink" title="zabbix自动发现小结"></a>zabbix自动发现小结</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.网络发现速度太慢</span><br><span class="line">2.轮询扫描网段</span><br><span class="line">3.如果网段中存在不通的主机，会出现卡顿并且造成后续新增的服务器无法加入节点</span><br><span class="line">4.会导致server性能变缓慢，影响server性能</span><br></pre></td></tr></table></figure>

<h2 id="zabbix自动注册（主动）"><a href="#zabbix自动注册（主动）" class="headerlink" title="zabbix自动注册（主动）"></a>zabbix自动注册（主动）</h2><p>Zabbix agent可以自动注册到服务器进行监控。这种方式无需在服务器上手动配置它们。自动注册官方手册</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]<span class="comment"># vim /etc/zabbix/zabbix_agentd.conf</span></span><br><span class="line">Server=172.16.1.61  		<span class="comment">## 被动模式</span></span><br><span class="line">ServerActive=172.16.1.61     <span class="comment">## 主动模式</span></span><br><span class="line">Hostname=web01</span><br><span class="line"></span><br><span class="line">Server=172.16.1.61  		<span class="comment">## 被动模式</span></span><br><span class="line">ServerActive=172.16.1.61     <span class="comment">## 主动模式</span></span><br><span class="line">Hostname=&#123;&#123; ansible.fqdn &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203336168.png" alt="image-20230327203336168"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203340716.png" alt="image-20230327203340716"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Zabbix自动注册</span><br><span class="line">主机名：&#123;HOST.HOST&#125;</span><br><span class="line">主机IP：&#123;HOST.IP&#125;</span><br><span class="line">主机端口：&#123;HOST.PORT&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/image-20230327203411631.png" alt=""></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Lupinus
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="http://yoursite.com/2019/05/24/Zabbix%E7%9B%91%E6%8E%A7/" title="[Zabbix监控]">http://yoursite.com/2019/05/24/Zabbix监控/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linxu%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" rel="tag"># Linxu持续集成</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/05/22/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="prev" title="[MySQL数据库]">
      <i class="fa fa-chevron-left"></i> [MySQL数据库]
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/06/10/%E4%BA%91%E8%AE%A1%E7%AE%97%E6%9E%B6%E6%9E%84/" rel="next" title="[云计算架构]">
      [云计算架构] <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix基础入门"><span class="nav-number">1.</span> <span class="nav-text">Zabbix基础入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix-快速入门安装"><span class="nav-number">1.1.</span> <span class="nav-text">zabbix 快速入门安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#汉化zabbix"><span class="nav-number">1.2.</span> <span class="nav-text">汉化zabbix</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#解决汉字无法显示问题"><span class="nav-number">1.2.1.</span> <span class="nav-text">解决汉字无法显示问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix监控入门"><span class="nav-number">2.</span> <span class="nav-text">Zabbix监控入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么做监控"><span class="nav-number">2.1.</span> <span class="nav-text">为什么做监控</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监控软件"><span class="nav-number">2.2.</span> <span class="nav-text">监控软件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#面试问题"><span class="nav-number">2.3.</span> <span class="nav-text">面试问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单机监控命令"><span class="nav-number">2.4.</span> <span class="nav-text">单机监控命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU监控命令"><span class="nav-number">2.4.1.</span> <span class="nav-text">CPU监控命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#监控内存"><span class="nav-number">2.4.2.</span> <span class="nav-text">监控内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python脚本获取进程使用内存情况"><span class="nav-number">2.4.3.</span> <span class="nav-text">python脚本获取进程使用内存情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#监控磁盘命令"><span class="nav-number">2.4.4.</span> <span class="nav-text">监控磁盘命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络监控命令"><span class="nav-number">2.4.5.</span> <span class="nav-text">网络监控命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP11种状态监控命令"><span class="nav-number">2.4.6.</span> <span class="nav-text">TCP11种状态监控命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生产场景需求"><span class="nav-number">2.5.</span> <span class="nav-text">生产场景需求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统的oom"><span class="nav-number">2.5.1.</span> <span class="nav-text">系统的oom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用脚本监控nginx"><span class="nav-number">2.5.2.</span> <span class="nav-text">使用脚本监控nginx</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix自定义监控项"><span class="nav-number">3.</span> <span class="nav-text">Zabbix自定义监控项</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#快速监控一台主机"><span class="nav-number">3.1.</span> <span class="nav-text">快速监控一台主机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加基础模板"><span class="nav-number">3.1.1.</span> <span class="nav-text">添加基础模板</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix报错排查"><span class="nav-number">3.2.</span> <span class="nav-text">zabbix报错排查</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix基础架构"><span class="nav-number">3.3.</span> <span class="nav-text">zabbix基础架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义zabbix监控"><span class="nav-number">3.4.</span> <span class="nav-text">自定义zabbix监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义监控项的格式"><span class="nav-number">3.4.1.</span> <span class="nav-text">自定义监控项的格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加配置文件"><span class="nav-number">3.4.2.</span> <span class="nav-text">添加配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面添加监控项"><span class="nav-number">3.4.3.</span> <span class="nav-text">页面添加监控项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#自己创建一个监控模板"><span class="nav-number">3.4.3.1.</span> <span class="nav-text">自己创建一个监控模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#给模板中添加监控项"><span class="nav-number">3.4.3.2.</span> <span class="nav-text">给模板中添加监控项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#将主机关联该模板"><span class="nav-number">3.4.3.3.</span> <span class="nav-text">将主机关联该模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#给监控项画图"><span class="nav-number">3.4.3.4.</span> <span class="nav-text">给监控项画图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看监控数据"><span class="nav-number">3.4.3.5.</span> <span class="nav-text">查看监控数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#给监控项添加触发器"><span class="nav-number">3.4.3.6.</span> <span class="nav-text">给监控项添加触发器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#优化页面告警"><span class="nav-number">3.4.4.</span> <span class="nav-text">优化页面告警</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#给监控项的触发器添加告警动作"><span class="nav-number">3.4.5.</span> <span class="nav-text">给监控项的触发器添加告警动作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加邮件告警（报警媒介类型：发件人和告警方式）"><span class="nav-number">3.4.6.</span> <span class="nav-text">添加邮件告警（报警媒介类型：发件人和告警方式）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置收件人"><span class="nav-number">3.4.7.</span> <span class="nav-text">配置收件人</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加报警媒介"><span class="nav-number">3.4.8.</span> <span class="nav-text">添加报警媒介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#告警消息添加"><span class="nav-number">3.4.9.</span> <span class="nav-text">告警消息添加</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix深入自定义监控"><span class="nav-number">4.</span> <span class="nav-text">Zabbix深入自定义监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix多条件触发"><span class="nav-number">4.1.</span> <span class="nav-text">zabbix多条件触发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#zabbix-5-x以上告警"><span class="nav-number">4.1.1.</span> <span class="nav-text">zabbix 5.x以上告警</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix的自愈模式"><span class="nav-number">4.2.</span> <span class="nav-text">zabbix的自愈模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix告警升级机制"><span class="nav-number">4.3.</span> <span class="nav-text">zabbix告警升级机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#聚合图形"><span class="nav-number">4.4.</span> <span class="nav-text">聚合图形</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix微信报警"><span class="nav-number">4.5.</span> <span class="nav-text">zabbix微信报警</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#zabbix-应用监控"><span class="nav-number">5.</span> <span class="nav-text">zabbix 应用监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#监控nginx"><span class="nav-number">5.1.</span> <span class="nav-text">监控nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix监控PHP"><span class="nav-number">5.2.</span> <span class="nav-text">zabbix监控PHP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#修改php配置"><span class="nav-number">5.2.1.</span> <span class="nav-text">修改php配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改nginx配置"><span class="nav-number">5.2.2.</span> <span class="nav-text">修改nginx配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写监控脚本"><span class="nav-number">5.2.3.</span> <span class="nav-text">编写监控脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置zabbix客户端加监控"><span class="nav-number">5.2.4.</span> <span class="nav-text">配置zabbix客户端加监控</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面添加监控项-1"><span class="nav-number">5.2.5.</span> <span class="nav-text">页面添加监控项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix监控MySQL"><span class="nav-number">5.3.</span> <span class="nav-text">zabbix监控MySQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix监控redis"><span class="nav-number">5.4.</span> <span class="nav-text">zabbix监控redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zabbix监控MySQL"><span class="nav-number">5.5.</span> <span class="nav-text">Zabbix监控MySQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zabbix监控Redis"><span class="nav-number">5.6.</span> <span class="nav-text">Zabbix监控Redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix监控JVM（JAVA）"><span class="nav-number">5.7.</span> <span class="nav-text">zabbix监控JVM（JAVA）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JMX在zabbix中运行的流程"><span class="nav-number">5.7.1.</span> <span class="nav-text">JMX在zabbix中运行的流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix自定义监控阶段小结"><span class="nav-number">5.8.</span> <span class="nav-text">zabbix自定义监控阶段小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix-Web检测"><span class="nav-number">6.</span> <span class="nav-text">Zabbix Web检测</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是静态网站、动态网站"><span class="nav-number">6.1.</span> <span class="nav-text">什么是静态网站、动态网站</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#session和cookie的工作流程"><span class="nav-number">6.2.</span> <span class="nav-text">session和cookie的工作流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用命令模拟用户登录网站"><span class="nav-number">6.2.1.</span> <span class="nav-text">使用命令模拟用户登录网站</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix监控web网站"><span class="nav-number">6.3.</span> <span class="nav-text">zabbix监控web网站</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zabbix自动化监控"><span class="nav-number">7.</span> <span class="nav-text">Zabbix自动化监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix工作模式"><span class="nav-number">7.1.</span> <span class="nav-text">zabbix工作模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动发现"><span class="nav-number">7.2.</span> <span class="nav-text">自动发现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自动发现配置"><span class="nav-number">7.2.1.</span> <span class="nav-text">自动发现配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zabbix自动发现小结"><span class="nav-number">7.2.2.</span> <span class="nav-text">zabbix自动发现小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zabbix自动注册（主动）"><span class="nav-number">7.3.</span> <span class="nav-text">zabbix自动注册（主动）</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lupinus"
      src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/20160715144434_fZCsF.jpeg">
  <p class="site-author-name" itemprop="name">Lupinus</p>
  <div class="site-description" itemprop="description">Re：从零开始的go学习生活(｀・ω・´)</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/rogerXS80/roger" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rogerXS80&#x2F;roger" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/fastsword66@gmail.com" title="E-Mail → fastsword66@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5896791111/home?wvr=5&sudaref=graph.qq.com" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5896791111&#x2F;home?wvr&#x3D;5&amp;sudaref&#x3D;graph.qq.com" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

      
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <!-- 选择合适的icon -->
              <i class="fa fa-history fa-" aria-hidden="true"></i>
          <!-- 这里对应下文主题配置文件的recent_posts_title值 -->
              最近文章
            </div>
            <ul class="links-of-blogroll-list"> 
              <!-- 设置排序规格，此处我采用按照文章更新时间排序 -->
              
              <!-- 显示三条近期文章，请自信合理配置 -->
              
                <li>
                  <a href="/2017/06/22/Git%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" title="[Git命令大全]" target="_blank">[Git命令大全]</a>
                </li>
              
                <li>
                  <a href="/2022/02/27/Vue%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" title="[Vue客户端项目搭建]" target="_blank">[Vue客户端项目搭建]</a>
                </li>
              
                <li>
                  <a href="/2022/02/26/Vue%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%EF%BC%88Vue-cli%EF%BC%89/" title="[Vue自动化工具（Vue-cli）]" target="_blank">[Vue自动化工具（Vue-cli）]</a>
                </li>
              
            </ul>
          </div>
      

      
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>




      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Roger</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div><!-- 文件位置：~/sourse/_data/footer.swig -->

<div class="weixin-box">
  <div class="weixin-menu">
    <div class="weixin-hover">
      <div class="weixin-description">微信扫一扫，订阅本博客</div>
    </div>
  </div>
</div>


        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="100" alpha="0.4" zIndex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

    </div>

<!-- 鼠标点击特效 -->
<script type="text/javascript" src="/js/fireworks.js"></script>

<!-- 点击爱心 
<script type="text/javascript" src="/js/clicklove.js"></script>
-->

</body>
</html>
