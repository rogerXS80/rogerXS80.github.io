<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="uW8bwgMGUwIA01nPfItoty1rmtmmuVkOVTeS9O0nAUg">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="SSH是一个安全协议，在进行数据传输时，会对数据包进行加密处理，加密后在进行数据传输。确保了数据传输安全。那SSH服务主要功能有哪些...">
<meta property="og:type" content="article">
<meta property="og:title" content="[ssh远程连接]">
<meta property="og:url" content="http://yoursite.com/2019/04/24/ssh%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/index.html">
<meta property="og:site_name" content="Lupinus">
<meta property="og:description" content="SSH是一个安全协议，在进行数据传输时，会对数据包进行加密处理，加密后在进行数据传输。确保了数据传输安全。那SSH服务主要功能有哪些...">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524001806812.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223210599.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223252594.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223321469.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223345276.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223415813.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223450300.png">
<meta property="og:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220525130858361.png">
<meta property="article:published_time" content="2019-04-24T12:48:15.000Z">
<meta property="article:modified_time" content="2019-04-24T12:01:27.000Z">
<meta property="article:author" content="Lupinus">
<meta property="article:tag" content="Linux架构">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524001806812.png">

<link rel="canonical" href="http://yoursite.com/2019/04/24/ssh%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[ssh远程连接] | Lupinus</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Lupinus" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lupinus</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Re：从零开始的go学习生活(｀・ω・´)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/rogerXS80" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/24/ssh%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/20160715144434_fZCsF.jpeg">
      <meta itemprop="name" content="Lupinus">
      <meta itemprop="description" content="Re：从零开始的go学习生活(｀・ω・´)">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lupinus">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [ssh远程连接]
        </h1>

        <div class="post-meta">
          <!-- 置顶图标 -->
            <span class="post-meta-item">
              
              
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-04-24 20:48:15 / Modified: 20:01:27" itemprop="dateCreated datePublished" datetime="2019-04-24T20:48:15+08:00">2019-04-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SRE/" itemprop="url" rel="index"><span itemprop="name">SRE</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <div class="post-description">SSH是一个安全协议，在进行数据传输时，会对数据包进行加密处理，加密后在进行数据传输。确保了数据传输安全。那SSH服务主要功能有哪些...</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="ssh远程管理"><a href="#ssh远程管理" class="headerlink" title="ssh远程管理"></a>ssh远程管理</h1><h2 id="远程连接"><a href="#远程连接" class="headerlink" title="远程连接"></a>远程连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Linux：</span><br><span class="line">	- ssh 端口：22 加密传输数据 </span><br><span class="line">	- telnet 端口：23 明文传输数据 </span><br><span class="line">Windows： </span><br><span class="line">	- rdp 端口：3389 remote desktop protocol</span><br></pre></td></tr></table></figure>

<h2 id="ssh相关命令及选项"><a href="#ssh相关命令及选项" class="headerlink" title="ssh相关命令及选项"></a>ssh相关命令及选项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">注意：不加用户@，默认使用当前登录的用户</span><br><span class="line"></span><br><span class="line">ssh：远程连接Linux服务器 </span><br><span class="line">-p：port指定端口 </span><br><span class="line"></span><br><span class="line"><span class="comment">#不连接上服务器，直接执行命令 </span></span><br><span class="line">ssh root@10.0.0.41 <span class="string">'ls /'</span></span><br><span class="line"></span><br><span class="line">scp：远程拷贝数据（写在前面的是源文件） </span><br><span class="line">-r：递归（远程拷贝目录） </span><br><span class="line">-p：拷贝的时候保持属性</span><br><span class="line">-P：大写p指定port</span><br><span class="line"></span><br><span class="line">推：scp sersync2.5.4 root@172.16.1.7:/root </span><br><span class="line">拉：scp root@172.16.1.7:/root/sersync2.5.4 /opt</span><br><span class="line"></span><br><span class="line"><span class="comment">#总结： </span></span><br><span class="line">1.scp通过ssh协议加密方式进行文件或目录拷贝</span><br><span class="line">2.scp连接时的用户作为为拷贝文件或目录的权限。（-p保持文件属性，-a） </span><br><span class="line">3.scp支持数据推送和拉取，每次都是全量拷贝，效率较低</span><br></pre></td></tr></table></figure>

<h2 id="ssh免密连接"><a href="#ssh免密连接" class="headerlink" title="ssh免密连接"></a>ssh免密连接</h2><p><strong>验证方式：</strong></p>
<ul>
<li><p>用户名密码验证</p>
</li>
<li><p>密钥对验证方式</p>
</li>
</ul>
<p><strong>ssh密钥对认证流程</strong></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524001806812.png" alt="image-20220524001806812"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ssh-keygen：生成密钥对 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ssh-keygen</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line"><span class="comment">#将秘钥保存到文件中，可以指定其他路径（直接回车） </span></span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Created directory <span class="string">'/root/.ssh'</span>.</span><br><span class="line"><span class="comment">#给密钥对设置密码，不需要设置（直接回车） </span></span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line"><span class="comment">#重复输入设置的密码（直接回车） </span></span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:porTOTgmfhwGF1eJeesKte03G0ZbLlPh6C3kJX0qRDw root@manage01</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|      +..        |</span></span><br><span class="line"><span class="string">|   . + o.        |</span></span><br><span class="line"><span class="string">|    o . .E .     |</span></span><br><span class="line"><span class="string">| . . . .. = .    |</span></span><br><span class="line"><span class="string">|  o . + S* * .   |</span></span><br><span class="line"><span class="string">|   + . =* O o    |</span></span><br><span class="line"><span class="string">|  ooo.+  @ +     |</span></span><br><span class="line"><span class="string">|. =++o ..o*      |</span></span><br><span class="line"><span class="string">|.+oo..  ..o      |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#生成后的密钥对 </span></span><br><span class="line"><span class="string">[root@m01 ~]# ll /root/.ssh/</span></span><br><span class="line"><span class="string">total 8</span></span><br><span class="line"><span class="string">-rw------- 1 root root 1679 May 24 08:21 id_rsa</span></span><br><span class="line"><span class="string">-rw-r--r-- 1 root root  395 May 24 08:21 id_rsa.pub</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#ssh-copy-id：发送公钥 </span></span><br><span class="line"><span class="string">-i：指定公钥位置 </span></span><br><span class="line"><span class="string">[root@m01 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.7 </span></span><br><span class="line"><span class="string">[root@m01 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.8 </span></span><br><span class="line"><span class="string">[root@m01 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.31 </span></span><br><span class="line"><span class="string">[root@m01 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.41</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#.ssh目录中的know_host作用 </span></span><br><span class="line"><span class="string">[root@m01 ~]# cat ~/.ssh/known_hosts </span></span><br><span class="line"><span class="string">记录连接过的服务器，如果没有连接过（第一次连接），需要输入yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#生成密钥对命令：ssh-keygen </span></span><br><span class="line"><span class="string">mkdir -m 700 ~/.ssh </span></span><br><span class="line"><span class="string">1.在当前用户的家目录下创建了一个隐藏目录 .ssh mkdir ~/.ssh </span></span><br><span class="line"><span class="string">2.将密钥对存放目录 .ssh 授权为 700 chmod 700 ~/.ssh </span></span><br><span class="line"><span class="string">3.将公钥内容写入 ~/.ssh/id_rsa.pub 文件中 </span></span><br><span class="line"><span class="string">4.将私钥内容写入 ~/.ssh/id_rsa 文件中 </span></span><br><span class="line"><span class="string">5.将私钥文件授权为 600 chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#发送公钥：ssh-copy-id</span></span><br><span class="line"><span class="string">[root@web01 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.5 </span></span><br><span class="line"><span class="string">输入yes </span></span><br><span class="line"><span class="string">输入密码：1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.在远端的指定用户的家目录下创建了一个隐藏目录.ssh ssh root@172.16.1.5 '</span>mkdir ~/.ssh<span class="string">' </span></span><br><span class="line"><span class="string">2.将密钥对存放目录 .ssh 授权为 700 ssh root@172.16.1.5 '</span>chmod 700 ~/.ssh<span class="string">' </span></span><br><span class="line"><span class="string">3.先在远端~/.ssh目录下创建文件authorized_keys ssh root@172.16.1.5 '</span>touch ~/.ssh/authorized_keys<span class="string">' </span></span><br><span class="line"><span class="string">4.将authorized_keys文件授权为600 ssh root@172.16.1.5 '</span>chmod 600 ~/.ssh/authorized_keys<span class="string">' </span></span><br><span class="line"><span class="string">5.将公钥内容，保存到authorized_keys文件中</span></span><br></pre></td></tr></table></figure>

<h2 id="免密使用场景"><a href="#免密使用场景" class="headerlink" title="免密使用场景"></a>免密使用场景</h2><ul>
<li><strong>批量查看服务器信息</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">[ <span class="variable">$#</span> -ne 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"请输入执行的命令"</span> &amp;&amp; <span class="built_in">exit</span> 1 </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 5 7 8 31 41 </span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"#########172.16.1.<span class="variable">$i</span>#####"</span> </span><br><span class="line">	ssh root@172.16.1.<span class="variable">$i</span> <span class="string">"<span class="variable">$1</span>"</span> </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>跳板机</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># cat jump.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line"><span class="comment">#jumpserver </span></span><br><span class="line">lb01=172.16.1.5 </span><br><span class="line">lb02=172.16.1.6 </span><br><span class="line">web01=172.16.1.7 </span><br><span class="line">web02=172.16.1.8 </span><br><span class="line">web03=172.16.1.9 </span><br><span class="line">nfs=172.16.1.31 </span><br><span class="line">backup=172.16.1.41 </span><br><span class="line">db01=172.16.1.51 </span><br><span class="line">m01=172.16.1.61 </span><br><span class="line">zabbix=172.16.1.71</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">menu</span></span>()&#123; </span><br><span class="line">	cat &lt;&lt;-EOF </span><br><span class="line">	+-------------------------+</span><br><span class="line">	1) lb01</span><br><span class="line">	2) lb02</span><br><span class="line">	3) web01</span><br><span class="line">	4) web02</span><br><span class="line">	5) web03</span><br><span class="line">	6) nfs</span><br><span class="line">	7) backup</span><br><span class="line">	8) db01</span><br><span class="line">	9) m01</span><br><span class="line">	10) zabbix</span><br><span class="line">	h) <span class="built_in">help</span></span><br><span class="line">	+-------------------------+</span><br><span class="line">	EOF </span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">#菜单函数 </span></span><br><span class="line">menu </span><br><span class="line"><span class="comment">#连接函数 </span></span><br><span class="line"><span class="function"><span class="title">connect</span></span>()&#123; </span><br><span class="line">	ping -c 1 -w 1 <span class="variable">$1</span> &amp;&gt;/dev/null </span><br><span class="line">	<span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span> </span><br><span class="line">		ssh root@<span class="variable">$1</span> </span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">"\033[5;4;40;31m 别连了,我的哥,<span class="variable">$2</span>:<span class="variable">$1</span>机器都没开!!!\033[0m"</span> </span><br><span class="line">	<span class="keyword">fi</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#控制不让输入ctrl+c,z </span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">""</span> HUP INT TSTP </span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">read</span> -p <span class="string">"请输入要连接的主机编号："</span> num </span><br><span class="line">	<span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">		1|lb01) </span><br><span class="line">			connect <span class="variable">$lb01</span> lb01 </span><br><span class="line">			;; </span><br><span class="line">		2|lb02) </span><br><span class="line">			connect <span class="variable">$lb02</span> lb02 </span><br><span class="line">			;; </span><br><span class="line">		3|web01) </span><br><span class="line">			connect <span class="variable">$web01</span> web01 </span><br><span class="line">			;; </span><br><span class="line">		4|web02) </span><br><span class="line">			connect <span class="variable">$web02</span> web02 </span><br><span class="line">			;; </span><br><span class="line">		5|web03)</span><br><span class="line">			connect <span class="variable">$web03</span> web03 </span><br><span class="line">			;; </span><br><span class="line">		6|nfs) </span><br><span class="line">			connect <span class="variable">$nfs</span> nfs </span><br><span class="line">			;; </span><br><span class="line">		7|backup) </span><br><span class="line">			connect <span class="variable">$backup</span> backup </span><br><span class="line">			;; </span><br><span class="line">		8|db01)</span><br><span class="line">			connect <span class="variable">$db01</span> db01 </span><br><span class="line">			;; </span><br><span class="line">		9|m01) </span><br><span class="line">			connect <span class="variable">$m01</span> m01 </span><br><span class="line">			;; </span><br><span class="line">		10|zabbix)</span><br><span class="line">			connect <span class="variable">$zabbix</span> zabbix </span><br><span class="line">			;; </span><br><span class="line">		h|<span class="built_in">help</span>) </span><br><span class="line">			clear</span><br><span class="line">			menu </span><br><span class="line">			;;</span><br><span class="line">		close) </span><br><span class="line">			<span class="built_in">break</span> </span><br><span class="line">			;;</span><br><span class="line">	<span class="keyword">esac</span> </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="SSH安全优化"><a href="#SSH安全优化" class="headerlink" title="SSH安全优化"></a>SSH安全优化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ssh配置文件 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ssh/sshd_config </span></span><br><span class="line">17 Port 52022  <span class="comment">#修改默认端口 </span></span><br><span class="line">115 UseDNS no  <span class="comment">#关闭反向解析 </span></span><br><span class="line">38 PermitRootLogin no  <span class="comment">#禁止root用户登录 </span></span><br><span class="line">65 PasswordAuthentication no  <span class="comment">#禁止使用密码登录 </span></span><br><span class="line">79 GSSAPIAuthentication no  <span class="comment">#关闭GSSAPI认证</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将以下内容，直接复制到文件最后一行</span></span><br><span class="line">Port 6666  <span class="comment">#变更SSH服务远程连接端口</span></span><br><span class="line">PermitRootLogin no  <span class="comment">#禁止root用户直接远程登录</span></span><br><span class="line">PasswordAuthentication no  <span class="comment">#禁止使用密码直接远程登录</span></span><br><span class="line">UseDNS no  <span class="comment">#禁止ssh进行dns反向解析，影响ssh连接效率参数</span></span><br><span class="line">GSSAPIAuthentication no  <span class="comment"># 禁止GSS认证，减少连接时产生的延迟</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启服务 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># systemctl restart sshd</span></span><br><span class="line"></span><br><span class="line">	1）在windows上生成密钥对 </span><br><span class="line">		- 使用windows的命令行执行 ssh-keygen </span><br><span class="line">		- 使用Xshell</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>如果已经优化完ssh，发现服务器上出现以下问题：</p>
<ul>
<li><p>没有普通用户 useradd roger（无法创建，进入单用户模式）</p>
</li>
<li><p>windows上秘钥没有推送 </p>
<ul>
<li><p>1）在windows上生成密钥对</p>
<ul>
<li>使用windows的命令行执行 ssh-keygen </li>
<li>使用Xshell</li>
</ul>
<p>2）使用Xshell生成密钥对</p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223210599.png" alt="image-20220524223210599"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223252594.png" alt="image-20220524223252594"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223321469.png" alt="image-20220524223321469"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223345276.png" alt="image-20220524223345276"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223415813.png" alt="image-20220524223415813"></p>
<p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220524223450300.png" alt="image-20220524223450300"></p>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[roger@m01 ~]$ mkdir .ssh </span><br><span class="line">[roger@m01 ~]$ chmod 700 .ssh/ </span><br><span class="line">[roger@m01 ~]$ vim .ssh/authorized_keys</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAuJWo9sSLut7rrATebtwxBZXAoXINN8bXot9VIwXakKZ+711pFWlE2gI52Qkke5xCBMMah72DK00GjkXYEhMm/DxoXloO5ORPkszl5q9BcSjI3k0Ru9BGkwRqtGjzvrHsrSvunJJtglMpe8sEs7KYrzOmHCNxk60h6yxQzS88l76rMMqYDOeChjyyQloGqC4xSqHQFlEF1NgdIlg2o/q69mieH8S9igOeAXbZFGH8219zNTV+WJ/U7nRQGSXtVss8f2pfK0wGLQgz+nR0u3BJUpRevpcqcF+ybxm5QZb/X8NZEW5ca2YsLInxoRCBE88tzXH5K/obwX98kJ6vqlqZJw== rsa 2048-052422</span><br><span class="line">[roger@m01 ~]$ chmod 600 .ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<h2 id="免交互生成密钥对"><a href="#免交互生成密钥对" class="headerlink" title="免交互生成密钥对"></a>免交互生成密钥对</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -P <span class="string">''</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null </span><br><span class="line">-t：指定加密类型 </span><br><span class="line">-P：空密码 </span><br><span class="line">-f：秘钥生成的位置</span><br></pre></td></tr></table></figure>

<h2 id="免交互推送公钥"><a href="#免交互推送公钥" class="headerlink" title="免交互推送公钥"></a>免交互推送公钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不循环的写法</span></span><br><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">ls -l ~/.ssh/id_rsa &amp;&gt;/dev/null || ssh-keygen -t rsa -P <span class="string">''</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.31 </span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.41 </span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.5 </span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.7 </span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.8</span><br><span class="line"></span><br><span class="line"><span class="comment">#循环的写法</span></span><br><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">ls -l ~/.ssh/id_rsa &amp;&gt;/dev/null || ssh-keygen -t rsa -P <span class="string">''</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> `cat /root/1.txt`;<span class="keyword">do</span> </span><br><span class="line">	ssh-copy-id -i ~/.ssh/id_rsa.pub root@<span class="variable">$n</span> </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解决密码交互问题</span></span><br><span class="line">1）使用expect解决 </span><br><span class="line">[root@m01 ~]<span class="comment"># yum install -y expect</span></span><br><span class="line"><span class="comment">#!/usr/bin/expect </span></span><br><span class="line"><span class="built_in">set</span> ip 172.16.1.31 </span><br><span class="line"><span class="built_in">set</span> pass 1 </span><br><span class="line"><span class="built_in">set</span> timeout 30 </span><br><span class="line"></span><br><span class="line">spawn ssh-keygen</span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">"id_rsa):"</span> &#123;send <span class="string">"\r"</span>; exp_continue&#125; </span><br><span class="line">	<span class="string">"passphrase):"</span> &#123;send <span class="string">"\r"</span>; exp_continue&#125; </span><br><span class="line">	<span class="string">"again:"</span> &#123;send <span class="string">"\r"</span>&#125; </span><br><span class="line">&#125;</span><br><span class="line">expect eof</span><br><span class="line"></span><br><span class="line">spawn ssh-copy-id -i /root/.ssh/id_rsa.pub root@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">"(yes/no)"</span> &#123;send <span class="string">"yes\r"</span>; exp_continue&#125; </span><br><span class="line">	<span class="string">"password:"</span> &#123;send <span class="string">"<span class="variable">$pass</span>\r"</span>&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#expect "root@*" &#123;send "df -h\r"&#125; </span></span><br><span class="line"><span class="comment">#expect "root@*" &#123;send "exit\r"&#125;</span></span><br><span class="line">expect eof</span><br><span class="line"></span><br><span class="line">2）使用sshpass解决</span><br><span class="line">[root@m01 ~]<span class="comment"># yum install -y sshpass</span></span><br><span class="line">-p：指定密码</span><br><span class="line">-f：从文件中取密码</span><br><span class="line">-e：从环境变量中取密码</span><br><span class="line">-P：设置密码提示</span><br><span class="line"><span class="comment">#ssh不需要输入yes的选项</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ssh -o 'StrictHostKeyChecking no' root@172.16.1.7 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># sshpass -p 1 ssh-copy-id -o 'StrictHostKeyChecking no' -i ~/.ssh/id_rsa.pub root@172.16.1.8</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat send_public_key.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">ls -l ~/.ssh/id_rsa &amp;&gt;/dev/null || ssh-keygen -t rsa -P <span class="string">''</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> `cat /root/1.txt`;<span class="keyword">do</span> </span><br><span class="line">	shpass -p 1 ssh-copy-id -o <span class="string">'StrictHostKeyChecking no'</span> -i ~/.ssh/id_rsa.pub root@<span class="variable">$ip</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># cat /root/1.txt</span></span><br><span class="line">172.16.1.31 </span><br><span class="line">172.16.1.41</span><br><span class="line">172.16.1.5 </span><br><span class="line">172.16.1.7 </span><br><span class="line">172.16.1.8</span><br><span class="line"></span><br><span class="line"><span class="comment">#每台机器密码不一致的情况</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ls -l ~/.ssh/id_rsa &amp;&gt;/dev/null || ssh-keygen -t rsa -P <span class="string">''</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> `cat /root/1.txt`;<span class="keyword">do</span> </span><br><span class="line">	pass=`<span class="built_in">echo</span> <span class="variable">$n</span>|awk -F <span class="string">':'</span> <span class="string">'&#123;print $2&#125;'</span>` </span><br><span class="line">	ip=`<span class="built_in">echo</span> <span class="variable">$n</span>|awk -F <span class="string">':'</span> <span class="string">'&#123;print $1&#125;'</span>` </span><br><span class="line">	sshpass -p <span class="variable">$pass</span> ssh-copy-id -o <span class="string">'StrictHostKeyChecking no'</span> -i ~/.ssh/id_rsa.pub root@<span class="variable">$ip</span> </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># cat /root/1.txt</span></span><br><span class="line">172.16.1.31:1 </span><br><span class="line">172.16.1.41:2 </span><br><span class="line">172.16.1.5:3 </span><br><span class="line">172.16.1.7:4 </span><br><span class="line">172.16.1.8:111</span><br><span class="line"></span><br><span class="line"><span class="comment">#优化后不使用判断的脚本</span></span><br><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">. /etc/init.d/<span class="built_in">functions</span></span><br><span class="line">ls -l ~/.ssh/id_rsa &amp;&gt;/dev/null || ssh-keygen -t rsa -P <span class="string">''</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> `cat /root/1.txt`;<span class="keyword">do</span></span><br><span class="line">	pass=`<span class="built_in">echo</span> <span class="variable">$n</span>|awk -F <span class="string">':'</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">	ip=`<span class="built_in">echo</span> <span class="variable">$n</span>|awk -F <span class="string">':'</span> <span class="string">'&#123;print $1&#125;'</span>`</span><br><span class="line">	sshpass -p <span class="variable">$pass</span> ssh-copy-id -o <span class="string">'StrictHostKeyChecking no'</span> -i ~/.ssh/id_rsa.pub root@<span class="variable">$ip</span> &amp;&gt;/dev/null &amp;&amp; \</span><br><span class="line">	action <span class="string">"<span class="variable">$ip</span> send public key "</span> /bin/<span class="literal">true</span> || \</span><br><span class="line">	action <span class="string">"<span class="variable">$ip</span> send public key "</span> /bin/<span class="literal">false</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h1 id="Google双向认证"><a href="#Google双向认证" class="headerlink" title="Google双向认证"></a>Google双向认证</h1><h2 id="Google-Authenticator介绍"><a href="#Google-Authenticator介绍" class="headerlink" title="Google Authenticator介绍"></a>Google Authenticator介绍</h2><p>通常我们直接通过ssh输入密码连接服务器，但这样很容易出现暴力破解情况，所以我们可以结合google的动态认证+ssh密码，这样能够大大的提升登陆的安全。简单来说，就是当用户通过ssh登陆系统时，先输入google的随机验证码，然后在输入服务器的ssh密码</p>
<h2 id="GoogleAuthenticator安装部署"><a href="#GoogleAuthenticator安装部署" class="headerlink" title="GoogleAuthenticator安装部署"></a>GoogleAuthenticator安装部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.安装依赖</span></span><br><span class="line">yum install -y pam-devel libpng-devel autoconf automake libtool</span><br><span class="line"><span class="comment">#2.下载Google apm插件</span></span><br><span class="line"><span class="comment">#官方下载地址</span></span><br><span class="line">wget https://github.com/google/google-authenticator-libpam/archive/1.04.tar.gz</span><br><span class="line"><span class="comment">#个人下载地址</span></span><br><span class="line">wget http://test.driverzeng.com/other/1.04.tar.gz </span><br><span class="line"><span class="comment">#3.解压插件</span></span><br><span class="line">tar xf 1.04.tar.gz</span><br><span class="line"><span class="comment">#4.构建代码</span></span><br><span class="line"><span class="comment">#进入解压开的目录 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># cd google-authenticator-libpam-1.04/</span></span><br><span class="line"><span class="comment">#执行bootstrap构建 </span></span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]<span class="comment"># ./bootstrap.sh</span></span><br><span class="line"><span class="comment">#5.生成 </span></span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]<span class="comment"># ./configure</span></span><br><span class="line"><span class="comment">#6.编译 &amp;&amp; 安装 </span></span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]<span class="comment"># make &amp;&amp; make install</span></span><br><span class="line"><span class="comment">#7.检查插件是否安装 </span></span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]<span class="comment"># ll /usr/local/lib/security/ </span></span><br><span class="line">-rwxr-xr-x 1 root root 1021 May 25 09:15 pam_google_authenticator.la </span><br><span class="line">-rwxr-xr-x 1 root root 133552 May 25 09:15 pam_google_authenticator.so</span><br><span class="line"><span class="comment"># 8.将安装好的插件，拷贝到系统库文件目录中 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># cp /usr/local/lib/security/pam_google_authenticator.so /usr/lib64/security/</span></span><br><span class="line"><span class="comment">#9.生成初始google认证识别码 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># google-authenticator</span></span><br><span class="line"><span class="comment">#认证令牌是否随时间变化 Do you want authentication tokens to be time-based (y/n) y                                                  Your new secret key is: 5HV5PHOI3HGJ6OCLTFDVV62FSY</span></span><br><span class="line">Your verification code is 262995</span><br><span class="line">Do you want me to update your <span class="string">"/root/.google_authenticator"</span> file? (y/n) y</span><br><span class="line">Do you want to disallow multiple uses of the same authentication token? This restricts you to one login about every 30s, but it increases your chances to notice or even prevent man-in-the-middle attacks (y/n) y</span><br><span class="line">By default, a new token is generated every 30 seconds by the mobile app. In order to compensate <span class="keyword">for</span> possible time-skew between the client and the server, we allow an extra token before and after the current time. This allows <span class="keyword">for</span> a time skew of up to 30 seconds between authentication server and client. If you experience problems with poor time synchronization, you can increase the window from its default size of 3 permitted codes (one previous code, the current code, the next code) to 17 permitted codes (the 8 previous codes, the current code, and the 8 next codes). This will permit <span class="keyword">for</span> a time skew of up to 4 minutes between client and server. Do you want to <span class="keyword">do</span> so? (y/n) y</span><br><span class="line">If the computer that you are logging into isn<span class="string">'t hardened against brute-force login attempts, you can enable rate-limiting for the authentication module. By default, this limits attackers to no more than 3 login attempts every 30s. Do you want to enable rate-limiting? (y/n) y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##将Google 2FA接入SSH</span></span><br><span class="line"><span class="string">#1.修改ssh认证配置 </span></span><br><span class="line"><span class="string">[root@m01 ~]# vim /etc/pam.d/sshd</span></span><br><span class="line"><span class="string">auth required pam_google_authenticator.so </span></span><br><span class="line"><span class="string">#2.修改SSH配置文件，关联Google认证 </span></span><br><span class="line"><span class="string">[root@m01 ~]# vim /etc/ssh/sshd_config</span></span><br><span class="line"><span class="string">69 ChallengeResponseAuthentication yes</span></span><br><span class="line"><span class="string">#3.重启sshd服务 </span></span><br><span class="line"><span class="string">[root@m01 ~]# systemctl restart sshd</span></span><br></pre></td></tr></table></figure>

<h2 id="使用Python脚本登录CRT"><a href="#使用Python脚本登录CRT" class="headerlink" title="使用Python脚本登录CRT"></a>使用Python脚本登录CRT</h2><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220525130858361.png" alt="image-20220525130858361"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $language = "python" </span></span><br><span class="line"><span class="comment"># $interface = "1.0" </span></span><br><span class="line"><span class="keyword">import</span> hmac, base64, struct, hashlib, time,re </span><br><span class="line"></span><br><span class="line"><span class="comment">#获取当前脚本所在的tab对象</span></span><br><span class="line">objTab = crt.GetScriptTab() </span><br><span class="line"><span class="comment">#objTab = crt.GetActiveTab() </span></span><br><span class="line">objTab.Screen.Synchronous = <span class="literal">True</span> </span><br><span class="line">objTab.Screen.IgnoreEscape = <span class="literal">True</span> </span><br><span class="line"><span class="comment">#获取终端名字 </span></span><br><span class="line">tabName=objTab.Caption </span><br><span class="line">reIp=<span class="string">r'\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;'</span> </span><br><span class="line">hostIp=re.findall(reIp,tabName)[<span class="number">0</span>] </span><br><span class="line">secretKey=<span class="string">"Your new secret key is:"</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calGoogleCode</span><span class="params">(secretKey)</span>:</span> </span><br><span class="line">    <span class="comment">#secreKey 需要是8的倍数 </span></span><br><span class="line">    t = int(time.time())//<span class="number">30</span> </span><br><span class="line">    lens = len(secretKey) </span><br><span class="line">    lenx = <span class="number">8</span> - (lens % <span class="number">4</span> <span class="keyword">if</span> lens % <span class="number">4</span> <span class="keyword">else</span> <span class="number">4</span>) </span><br><span class="line">    secretKey += lenx * <span class="string">'='</span> </span><br><span class="line">    key = base64.b32decode(secretKey) </span><br><span class="line">    msg = struct.pack(<span class="string">"&gt;Q"</span>, t)</span><br><span class="line">    googleCode = hmac.new(key, msg, hashlib.sha1).digest() </span><br><span class="line">    o = ord(str(googleCode[<span class="number">19</span>])) &amp; <span class="number">15</span> </span><br><span class="line">    googleCode = str((struct.unpack(<span class="string">"&gt;I"</span>, googleCode[o:o+<span class="number">4</span>])[<span class="number">0</span>] &amp; <span class="number">0x7fffffff</span>) % <span class="number">1000000</span>) </span><br><span class="line">    <span class="keyword">return</span> googleCode.zfill(<span class="number">6</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_string</span><span class="params">(objTab,szStart,szPrompt)</span>:</span> </span><br><span class="line">    objTab.Screen.WaitForStrings(szStart) </span><br><span class="line">    <span class="keyword">return</span> objTab.Screen.ReadString(szPrompt)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_string</span><span class="params">(objTab,waitString,strings,selfSleepTime=<span class="number">20</span>)</span>:</span> </span><br><span class="line">    objTab.Screen.WaitForStrings(waitString) </span><br><span class="line">    time.sleep(<span class="number">0.0001</span>) </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strings: </span><br><span class="line">        crt.Sleep(<span class="number">5</span>) </span><br><span class="line">        objTab.Screen.Send(i) </span><br><span class="line">    <span class="comment">#time.sleep(0.0001) </span></span><br><span class="line">    objTab.Screen.WaitForStrings(strings) </span><br><span class="line">    <span class="keyword">if</span> strings[<span class="number">-1</span>] != <span class="string">'\r'</span>: </span><br><span class="line">        objTab.Screen.Send(<span class="string">'\r'</span>)</span><br><span class="line">    <span class="comment">#msg(objTab.Screen.ReadString('[ q ]')) </span></span><br><span class="line">    <span class="comment">#time.sleep(0.0001)</span></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_pass</span><span class="params">(objTab,waitString,strings)</span>:</span> </span><br><span class="line">    objTab.Screen.WaitForStrings(waitString) </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strings: </span><br><span class="line">        crt.Sleep(<span class="number">5</span>) </span><br><span class="line">        objTab.Screen.Send(i) </span><br><span class="line">    <span class="keyword">if</span> strings[<span class="number">-1</span>] != <span class="string">'\r'</span>: </span><br><span class="line">    	objTab.Screen.Send(<span class="string">'\r'</span>) </span><br><span class="line">    time.sleep(<span class="number">0.01</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#发送2fa </span></span><br><span class="line">send_pass(objTab,<span class="string">'Verification code:'</span>,calGoogleCode(secretKey)) </span><br><span class="line"><span class="comment">#发送密码 </span></span><br><span class="line">send_pass(objTab,<span class="string">'Password: '</span>,<span class="string">'1'</span>) <span class="comment"># '1' 是服务器的密码 </span></span><br><span class="line"><span class="comment">#发送登录ip </span></span><br><span class="line">send_string(objTab,<span class="string">'Opt&gt; '</span>,hostIp)</span><br><span class="line"></span><br><span class="line"><span class="comment">#objTab.Screen.WaitForStrings("[MFA auth]: ","") </span></span><br><span class="line"><span class="comment">#if objTab.Screen.WaitForStrings("Opt&gt; ",1): </span></span><br><span class="line">	<span class="comment">#发送登录ip 克隆会话,不需要二次验证码 </span></span><br><span class="line">    <span class="comment">#send_string(objTab,'Opt&gt; ',hostIp) </span></span><br><span class="line"><span class="comment">#else: </span></span><br><span class="line">	<span class="comment">#发送2fa </span></span><br><span class="line">    <span class="comment">#send_pass(objTab,'[MFA auth]: ',calGoogleCode(secretKey)) </span></span><br><span class="line">    <span class="comment">#发送登录ip </span></span><br><span class="line">    <span class="comment">#send_string(objTab,'Opt&gt; ',hostIp)</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Lupinus
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="http://yoursite.com/2019/04/24/ssh%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/" title="[ssh远程连接]">http://yoursite.com/2019/04/24/ssh远程连接/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linux%E6%9E%B6%E6%9E%84/" rel="tag"># Linux架构</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/04/23/NFS%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8/" rel="prev" title="[NFS共享存储]">
      <i class="fa fa-chevron-left"></i> [NFS共享存储]
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/04/25/http%E5%8D%8F%E8%AE%AE/" rel="next" title="[http协议]">
      [http协议] <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ssh远程管理"><span class="nav-number">1.</span> <span class="nav-text">ssh远程管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#远程连接"><span class="nav-number">1.1.</span> <span class="nav-text">远程连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh相关命令及选项"><span class="nav-number">1.2.</span> <span class="nav-text">ssh相关命令及选项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh免密连接"><span class="nav-number">1.3.</span> <span class="nav-text">ssh免密连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#免密使用场景"><span class="nav-number">1.4.</span> <span class="nav-text">免密使用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH安全优化"><span class="nav-number">1.5.</span> <span class="nav-text">SSH安全优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解决方案"><span class="nav-number">1.6.</span> <span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#免交互生成密钥对"><span class="nav-number">1.7.</span> <span class="nav-text">免交互生成密钥对</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#免交互推送公钥"><span class="nav-number">1.8.</span> <span class="nav-text">免交互推送公钥</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Google双向认证"><span class="nav-number">2.</span> <span class="nav-text">Google双向认证</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Google-Authenticator介绍"><span class="nav-number">2.1.</span> <span class="nav-text">Google Authenticator介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GoogleAuthenticator安装部署"><span class="nav-number">2.2.</span> <span class="nav-text">GoogleAuthenticator安装部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用Python脚本登录CRT"><span class="nav-number">2.3.</span> <span class="nav-text">使用Python脚本登录CRT</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lupinus"
      src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/20160715144434_fZCsF.jpeg">
  <p class="site-author-name" itemprop="name">Lupinus</p>
  <div class="site-description" itemprop="description">Re：从零开始的go学习生活(｀・ω・´)</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/rogerXS80/roger" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rogerXS80&#x2F;roger" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/fastsword66@gmail.com" title="E-Mail → fastsword66@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5896791111/home?wvr=5&sudaref=graph.qq.com" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5896791111&#x2F;home?wvr&#x3D;5&amp;sudaref&#x3D;graph.qq.com" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

      
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <!-- 选择合适的icon -->
              <i class="fa fa-history fa-" aria-hidden="true"></i>
          <!-- 这里对应下文主题配置文件的recent_posts_title值 -->
              最近文章
            </div>
            <ul class="links-of-blogroll-list"> 
              <!-- 设置排序规格，此处我采用按照文章更新时间排序 -->
              
              <!-- 显示三条近期文章，请自信合理配置 -->
              
                <li>
                  <a href="/2017/06/22/Git%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" title="[Git命令大全]" target="_blank">[Git命令大全]</a>
                </li>
              
                <li>
                  <a href="/2022/02/27/Vue%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" title="[Vue客户端项目搭建]" target="_blank">[Vue客户端项目搭建]</a>
                </li>
              
                <li>
                  <a href="/2022/02/26/Vue%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%EF%BC%88Vue-cli%EF%BC%89/" title="[Vue自动化工具（Vue-cli）]" target="_blank">[Vue自动化工具（Vue-cli）]</a>
                </li>
              
            </ul>
          </div>
      

      
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>




      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Roger</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div><!-- 文件位置：~/sourse/_data/footer.swig -->

<div class="weixin-box">
  <div class="weixin-menu">
    <div class="weixin-hover">
      <div class="weixin-description">微信扫一扫，订阅本博客</div>
    </div>
  </div>
</div>


        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="100" alpha="0.4" zIndex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

    </div>

<!-- 鼠标点击特效 -->
<script type="text/javascript" src="/js/fireworks.js"></script>

<!-- 点击爱心 
<script type="text/javascript" src="/js/clicklove.js"></script>
-->

</body>
</html>
